"use strict";(self["webpackChunkHungHutech"]=self["webpackChunkHungHutech"]||[]).push([[5231],{1114:function(e,a,t){function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function l(e,a){if("object"!=n(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var l=t.call(e,a||"default");if("object"!=n(l))return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===a?String:Number)(e)}function r(e){var a=l(e,"string");return"symbol"==n(a)?a:a+""}function i(e,a,t){return(a=r(a))in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}t.d(a,{A:function(){return i}})},1526:function(e,a,t){var n=t(1114),l=t(4335);const r=window?.appGlobal?.baseUrl&&`${window.appGlobal.baseUrl}/api`,i=r||"http://192.168.88.50:5000/api";console.log("API Base URL:",i);class o{constructor(){(0,n.A)(this,"axiosInstance",void 0),this.axiosInstance=l.A.create({baseURL:i,headers:{"Content-Type":"application/json"}}),this.axiosInstance.interceptors.request.use(e=>{const a=localStorage.getItem("token");return a&&(e.headers.Authorization=`Bearer ${a}`),e},e=>Promise.reject(e)),this.axiosInstance.interceptors.response.use(e=>e,e=>(401===e.response?.status&&(localStorage.removeItem("token"),localStorage.removeItem("user"),window.location.href="/login"),Promise.reject(e)))}get(e,a){return this.axiosInstance.get(e,a)}post(e,a,t){return this.axiosInstance.post(e,a,t)}put(e,a,t){return this.axiosInstance.put(e,a,t)}delete(e,a){return this.axiosInstance.delete(e,a)}patch(e,a,t){return this.axiosInstance.patch(e,a,t)}}a.A=new o},5231:function(e,a,t){t.r(a),t.d(a,{default:function(){return f}});var n=t(1431),l=t(8548),r=t(163),i=t(7918),o=t(1114),s=t(1526);class u{constructor(){(0,o.A)(this,"BASE_URL","/users")}async getAll(e){const a=await s.A.get(this.BASE_URL,{params:e});return a.data}async getById(e){const a=await s.A.get(`${this.BASE_URL}/${e}`);return a.data}async create(e){const a=await s.A.post(this.BASE_URL,e);return a.data}async update(e,a){const t=await s.A.put(`${this.BASE_URL}/${e}`,a);return t.data}async delete(e){await s.A.delete(`${this.BASE_URL}/${e}`)}async changePassword(e,a,t){await s.A.put(`${this.BASE_URL}/${e}/change-password`,{oldPassword:a,newPassword:t})}}var d=new u,c=t(6604);const h={class:"orangehrm-user-list"},p={class:"orangehrm-card-header"},m={class:"orangehrm-filter-section"},v={key:0},g={class:"orangehrm-pagination"};var _=(0,n.pM)({__name:"UserList",setup(e){const a=(0,n.KR)(),t=(0,n.KR)(!1),o=(0,n.KR)(!1),s=(0,n.KR)(!1),u=(0,n.KR)(!1),_=(0,n.KR)(""),b=(0,n.KR)(""),w=(0,n.KR)(1),f=(0,n.KR)(10),y=(0,n.KR)(0),k=(0,n.KR)([]),A=(0,n.KR)([]),F=(0,n.Kh)({email:"",role:"employee",password:"",confirmPassword:"",nhan_vien_id:"",active:!0,_id:""}),V=(e,a,t)=>{u.value||a?!u.value&&a.length<6?t(new Error("Mật khẩu phải có ít nhất 6 ký tự")):t():t(new Error("Vui lòng nhập mật khẩu"))},R=(e,a,t)=>{u.value||a?u.value||a===F.password?t():t(new Error("Mật khẩu không khớp")):t(new Error("Vui lòng xác nhận mật khẩu"))},U={email:[{required:!0,message:"Vui lòng nhập email",trigger:"blur"},{type:"email",message:"Email không hợp lệ",trigger:"blur"}],role:[{required:!0,message:"Vui lòng chọn vai trò",trigger:"change"}],password:[{validator:V,trigger:"blur"}],confirmPassword:[{validator:R,trigger:"blur"}]},S=async()=>{t.value=!0;try{const e={page:w.value,limit:f.value,q:_.value};b.value&&(e.role=b.value);const a=await d.getAll(e);k.value=a.data||[],y.value=a.pagination?.total||0}catch(e){console.error("Error loading users:",e),r.nk.error(e.response?.data?.msg||"Không thể tải danh sách người dùng")}finally{t.value=!1}},E=async()=>{try{const e=await c.A.getAll({limit:1e3});A.value=e.data||[]}catch(e){console.error("Error loading employees:",e)}},C=e=>{const a={admin:"danger",manager:"warning",employee:"info"};return a[e]||"info"},K=e=>{const a={admin:"Admin",manager:"Quản lý",employee:"Nhân viên"};return a[e]||e},$=()=>{u.value=!1,F.email="",F.role="employee",F.password="",F.confirmPassword="",F.nhan_vien_id="",F.active=!0,F._id="",s.value=!0},L=e=>{u.value=!0,F.email=e.email||"",F.role=e.role||"employee",F.nhan_vien_id=e.nhan_vien_id?._id||e.nhan_vien_id||"",F.active=void 0===e.active||e.active,F._id=e._id,s.value=!0},x=async e=>{try{const a=e.nhan_vien_id?`${e.nhan_vien_id.ho_dem} ${e.nhan_vien_id.ten}`:e.email;await i.s.confirm(`Bạn có chắc chắn muốn ${e.active?"khóa":"mở khóa"} người dùng "${a}"?`,"Xác nhận",{confirmButtonText:"Xác nhận",cancelButtonText:"Hủy",type:"warning"}),await d.update(e._id,{active:!e.active}),r.nk.success((e.active?"Khóa":"Mở khóa")+" người dùng thành công"),S()}catch(a){"cancel"!==a&&r.nk.error(a.response?.data?.msg||"Không thể cập nhật trạng thái")}},B=async()=>{if(a.value)try{const e=await a.value.validate();if(!e)return;o.value=!0;const t={email:F.email,role:F.role,nhan_vien_id:F.nhan_vien_id||void 0,active:F.active};u.value||(t.password=F.password),u.value?(await d.update(F._id,t),r.nk.success("Cập nhật người dùng thành công")):(await d.create(t),r.nk.success("Thêm người dùng mới thành công")),s.value=!1,S()}catch(e){r.nk.error(e.response?.data?.msg||"Không thể lưu người dùng")}finally{o.value=!1}},I=()=>{w.value=1,S()},P=()=>{w.value=1,S()},W=()=>{S()};return(0,n.sV)(()=>{S(),E()}),(e,r)=>{const i=(0,n.g2)("el-button"),d=(0,n.g2)("el-input"),c=(0,n.g2)("el-col"),V=(0,n.g2)("el-option"),R=(0,n.g2)("el-select"),S=(0,n.g2)("el-row"),E=(0,n.g2)("el-table-column"),T=(0,n.g2)("el-tag"),X=(0,n.g2)("el-table"),z=(0,n.g2)("el-pagination"),N=(0,n.g2)("el-card"),j=(0,n.g2)("el-form-item"),q=(0,n.g2)("el-switch"),H=(0,n.g2)("el-form"),M=(0,n.g2)("el-dialog"),Q=(0,n.gN)("loading");return(0,n.uX)(),(0,n.CE)("div",h,[(0,n.bF)(N,{shadow:"never"},{header:(0,n.k6)(()=>[(0,n.Lk)("div",p,[r[13]||(r[13]=(0,n.Lk)("h2",{class:"orangehrm-card-title"},"Quản lý Người dùng",-1)),(0,n.bF)(i,{type:"primary",icon:(0,n.R1)(l.Plus),onClick:$},{default:(0,n.k6)(()=>[...r[12]||(r[12]=[(0,n.eW)(" Thêm Người dùng ",-1)])]),_:1},8,["icon"])])]),default:(0,n.k6)(()=>[(0,n.Lk)("div",m,[(0,n.bF)(S,{gutter:20},{default:(0,n.k6)(()=>[(0,n.bF)(c,{span:6},{default:(0,n.k6)(()=>[(0,n.bF)(d,{modelValue:_.value,"onUpdate:modelValue":r[0]||(r[0]=e=>_.value=e),placeholder:"Tìm kiếm người dùng...","prefix-icon":(0,n.R1)(l.Search),clearable:"",onClear:I,onKeyup:(0,n.jR)(I,["enter"])},null,8,["modelValue","prefix-icon"])]),_:1}),(0,n.bF)(c,{span:6},{default:(0,n.k6)(()=>[(0,n.bF)(R,{modelValue:b.value,"onUpdate:modelValue":r[1]||(r[1]=e=>b.value=e),placeholder:"Lọc theo vai trò",clearable:"",style:{width:"100%"},onChange:I},{default:(0,n.k6)(()=>[(0,n.bF)(V,{label:"Admin",value:"admin"}),(0,n.bF)(V,{label:"Quản lý",value:"manager"}),(0,n.bF)(V,{label:"Nhân viên",value:"employee"})]),_:1},8,["modelValue"])]),_:1}),(0,n.bF)(c,{span:4},{default:(0,n.k6)(()=>[(0,n.bF)(i,{type:"primary",icon:(0,n.R1)(l.Search),onClick:I},{default:(0,n.k6)(()=>[...r[14]||(r[14]=[(0,n.eW)(" Tìm kiếm ",-1)])]),_:1},8,["icon"])]),_:1})]),_:1})]),(0,n.bo)(((0,n.uX)(),(0,n.Wv)(X,{data:k.value,border:"",class:"orangehrm-table",style:{"margin-top":"20px"}},{default:(0,n.k6)(()=>[(0,n.bF)(E,{prop:"email",label:"Email","min-width":"200"}),(0,n.bF)(E,{label:"Nhân viên liên kết","min-width":"180"},{default:(0,n.k6)(e=>[e.row.nhan_vien_id?((0,n.uX)(),(0,n.CE)("span",v,(0,n.v_)(e.row.nhan_vien_id.ho_dem)+" "+(0,n.v_)(e.row.nhan_vien_id.ten),1)):((0,n.uX)(),(0,n.Wv)(T,{key:1,type:"info",size:"small"},{default:(0,n.k6)(()=>[...r[15]||(r[15]=[(0,n.eW)("Chưa liên kết",-1)])]),_:1}))]),_:1}),(0,n.bF)(E,{label:"Vai trò",width:"120"},{default:(0,n.k6)(e=>[(0,n.bF)(T,{type:C(e.row.role)},{default:(0,n.k6)(()=>[(0,n.eW)((0,n.v_)(K(e.row.role)),1)]),_:2},1032,["type"])]),_:1}),(0,n.bF)(E,{label:"Trạng thái",width:"120"},{default:(0,n.k6)(e=>[(0,n.bF)(T,{type:e.row.active?"success":"danger"},{default:(0,n.k6)(()=>[(0,n.eW)((0,n.v_)(e.row.active?"Hoạt động":"Khóa"),1)]),_:2},1032,["type"])]),_:1}),(0,n.bF)(E,{label:"Thao tác",width:"200",align:"center"},{default:(0,n.k6)(e=>[(0,n.bF)(i,{size:"small",icon:(0,n.R1)(l.Edit),onClick:a=>L(e.row)},{default:(0,n.k6)(()=>[...r[16]||(r[16]=[(0,n.eW)(" Sửa ",-1)])]),_:1},8,["icon","onClick"]),(0,n.bF)(i,{size:"small",type:e.row.active?"warning":"success",onClick:a=>x(e.row)},{default:(0,n.k6)(()=>[(0,n.eW)((0,n.v_)(e.row.active?"Khóa":"Mở"),1)]),_:2},1032,["type","onClick"])]),_:1})]),_:1},8,["data"])),[[Q,t.value]]),(0,n.Lk)("div",g,[(0,n.bF)(z,{"current-page":w.value,"onUpdate:currentPage":r[2]||(r[2]=e=>w.value=e),"page-size":f.value,"onUpdate:pageSize":r[3]||(r[3]=e=>f.value=e),"page-sizes":[10,20,50,100],total:y.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:P,onCurrentChange:W},null,8,["current-page","page-size","total"])])]),_:1}),(0,n.bF)(M,{modelValue:s.value,"onUpdate:modelValue":r[11]||(r[11]=e=>s.value=e),title:u.value?"Chỉnh sửa người dùng":"Thêm người dùng mới",width:"600px"},{footer:(0,n.k6)(()=>[(0,n.bF)(i,{onClick:r[10]||(r[10]=e=>s.value=!1)},{default:(0,n.k6)(()=>[...r[17]||(r[17]=[(0,n.eW)("Hủy",-1)])]),_:1}),(0,n.bF)(i,{type:"primary",loading:o.value,onClick:B},{default:(0,n.k6)(()=>[(0,n.eW)((0,n.v_)(u.value?"Cập nhật":"Thêm mới"),1)]),_:1},8,["loading"])]),default:(0,n.k6)(()=>[(0,n.bF)(H,{ref_key:"formRef",ref:a,model:F,rules:U,"label-width":"140px"},{default:(0,n.k6)(()=>[(0,n.bF)(j,{label:"Email",prop:"email",required:""},{default:(0,n.k6)(()=>[(0,n.bF)(d,{modelValue:F.email,"onUpdate:modelValue":r[4]||(r[4]=e=>F.email=e),type:"email",placeholder:"user@company.com",disabled:u.value},null,8,["modelValue","disabled"])]),_:1}),(0,n.bF)(j,{label:"Vai trò",prop:"role",required:""},{default:(0,n.k6)(()=>[(0,n.bF)(R,{modelValue:F.role,"onUpdate:modelValue":r[5]||(r[5]=e=>F.role=e),placeholder:"Chọn vai trò",style:{width:"100%"}},{default:(0,n.k6)(()=>[(0,n.bF)(V,{label:"Admin",value:"admin"}),(0,n.bF)(V,{label:"Quản lý",value:"manager"}),(0,n.bF)(V,{label:"Nhân viên",value:"employee"})]),_:1},8,["modelValue"])]),_:1}),u.value?(0,n.Q3)("",!0):((0,n.uX)(),(0,n.Wv)(j,{key:0,label:"Mật khẩu",prop:"password",required:""},{default:(0,n.k6)(()=>[(0,n.bF)(d,{modelValue:F.password,"onUpdate:modelValue":r[6]||(r[6]=e=>F.password=e),type:"password",placeholder:"Mật khẩu","show-password":""},null,8,["modelValue"])]),_:1})),u.value?(0,n.Q3)("",!0):((0,n.uX)(),(0,n.Wv)(j,{key:1,label:"Xác nhận MK",prop:"confirmPassword",required:""},{default:(0,n.k6)(()=>[(0,n.bF)(d,{modelValue:F.confirmPassword,"onUpdate:modelValue":r[7]||(r[7]=e=>F.confirmPassword=e),type:"password",placeholder:"Nhập lại mật khẩu","show-password":""},null,8,["modelValue"])]),_:1})),(0,n.bF)(j,{label:"Nhân viên",prop:"nhan_vien_id"},{default:(0,n.k6)(()=>[(0,n.bF)(R,{modelValue:F.nhan_vien_id,"onUpdate:modelValue":r[8]||(r[8]=e=>F.nhan_vien_id=e),placeholder:"Liên kết với nhân viên",filterable:"",clearable:"",style:{width:"100%"}},{default:(0,n.k6)(()=>[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(A.value,e=>((0,n.uX)(),(0,n.Wv)(V,{key:e._id,label:`${e.ho_dem} ${e.ten} (${e.ma_nhan_vien})`,value:e._id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),(0,n.bF)(j,{label:"Trạng thái",prop:"active"},{default:(0,n.k6)(()=>[(0,n.bF)(q,{modelValue:F.active,"onUpdate:modelValue":r[9]||(r[9]=e=>F.active=e),"active-text":"Hoạt động","inactive-text":"Khóa"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}}),b=t(6262);const w=(0,b.A)(_,[["__scopeId","data-v-14d2d620"]]);var f=w},6262:function(e,a){a.A=(e,a)=>{const t=e.__vccOpts||e;for(const[n,l]of a)t[n]=l;return t}},6604:function(e,a,t){var n=t(1114),l=t(1526);class r{constructor(){(0,n.A)(this,"BASE_URL","/nhanvien")}async getAll(e){const a=await l.A.get(this.BASE_URL,{params:e});return a.data}async getById(e){const a=await l.A.get(`${this.BASE_URL}/${e}`);return a.data}async create(e){const a=await l.A.post(this.BASE_URL,e);return a.data}async update(e,a){const t=await l.A.put(`${this.BASE_URL}/${e}`,a);return t.data}async delete(e){await l.A.delete(`${this.BASE_URL}/${e}`)}}a.A=new r}}]);
//# sourceMappingURL=5231.60903578.js.map