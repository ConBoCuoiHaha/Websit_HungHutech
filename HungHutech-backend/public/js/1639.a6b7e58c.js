"use strict";(self["webpackChunkHungHutech"]=self["webpackChunkHungHutech"]||[]).push([[1639],{1526:function(e,a,t){var n=t(1114),l=t(4335);const o=window?.appGlobal?.baseUrl&&`${window.appGlobal.baseUrl}/api`,i=o||"http://192.168.88.50:5000/api";console.log("API Base URL:",i);class r{constructor(){(0,n.A)(this,"axiosInstance",void 0),this.axiosInstance=l.A.create({baseURL:i,headers:{"Content-Type":"application/json"}}),this.axiosInstance.interceptors.request.use(e=>{const a=localStorage.getItem("token");return a&&(e.headers.Authorization=`Bearer ${a}`),e},e=>Promise.reject(e)),this.axiosInstance.interceptors.response.use(e=>e,e=>(401===e.response?.status&&(localStorage.removeItem("token"),localStorage.removeItem("user"),window.location.href="/login"),Promise.reject(e)))}get(e,a){return this.axiosInstance.get(e,a)}post(e,a,t){return this.axiosInstance.post(e,a,t)}put(e,a,t){return this.axiosInstance.put(e,a,t)}delete(e,a){return this.axiosInstance.delete(e,a)}patch(e,a,t){return this.axiosInstance.patch(e,a,t)}}a.A=new r},1639:function(e,a,t){t.r(a),t.d(a,{default:function(){return f}});var n=t(1431),l=t(8548),o=t(163),i=t(6593),r=t(6604);const s={class:"orangehrm-attendance-sheet-page"},u={class:"orangehrm-page-header"},c={class:"orangehrm-page-actions"},h={class:"orangehrm-day-name"},d={class:"orangehrm-time-cell"},g={key:0,class:"orangehrm-time-cell"},_={key:1,class:"orangehrm-empty-time"},m={key:1};var v=(0,n.pM)({__name:"AttendanceSheet",setup(e){const a=(0,n.KR)([]),t=(0,n.KR)([]),v=(0,n.KR)(""),p=(0,n.KR)(!1),b=(0,n.KR)(""),f=(0,n.KR)(!1),k=(0,n.KR)(!1),y=(0,n.KR)(),w=(0,n.KR)(null),F=new Date,D=new Date(F.getFullYear(),F.getMonth(),1),A=new Date(F.getFullYear(),F.getMonth()+1,0),C=(0,n.KR)(D.toISOString().split("T")[0]),R=(0,n.KR)(A.toISOString().split("T")[0]),x=(0,n.Kh)({_id:"",ngay:"",thoi_gian_vao:null,thoi_gian_ra:null,ghi_chu:""}),S={thoi_gian_vao:[{required:!0,message:"Vui lòng chọn giờ vào",trigger:"change"}]},V=async()=>{try{const e=await r.A.getAll({limit:1e3});a.value=e.data||[]}catch(e){console.error("Error loading employees:",e),o.nk.error("Không thể tải danh sách nhân viên")}},E=async()=>{if(v.value){p.value=!0,b.value="";try{const e=await i.A.getHistory({nhan_vien_id:v.value,from:C.value,to:R.value});t.value=e||[],w.value=await i.A.getSummary(v.value,C.value,R.value)}catch(e){console.error("Error loading attendance:",e),b.value=e.response?.data?.msg||"Không thể tải bảng chấm công",o.nk.error(b.value)}finally{p.value=!1}}},L=e=>{x._id=e._id,x.ngay=e.ngay,x.thoi_gian_vao=new Date(e.thoi_gian_vao),x.thoi_gian_ra=e.thoi_gian_ra?new Date(e.thoi_gian_ra):null,x.ghi_chu=e.ghi_chu||"",k.value=!0},Y=async()=>{y.value&&await y.value.validate(async e=>{if(e){f.value=!0;try{const e={ghi_chu:x.ghi_chu};if(x.thoi_gian_vao){const a=new Date(x.ngay),t=new Date(x.thoi_gian_vao);a.setHours(t.getHours(),t.getMinutes(),0,0),e.thoi_gian_vao=a.toISOString()}if(x.thoi_gian_ra){const a=new Date(x.ngay),t=new Date(x.thoi_gian_ra);a.setHours(t.getHours(),t.getMinutes(),0,0),e.thoi_gian_ra=a.toISOString()}await i.A.update(x._id,e),o.nk.success("Cập nhật bản ghi chấm công thành công"),I(),await E()}catch(a){console.error("Error updating attendance:",a),o.nk.error(a.response?.data?.msg||"Không thể cập nhật bản ghi")}finally{f.value=!1}}})},I=()=>{k.value=!1,y.value&&y.value.resetFields()},U=()=>{o.nk.info("Tính năng xuất Excel đang được phát triển")},H=e=>{if(!e.thoi_gian_ra)return 0;const a=new Date(e.thoi_gian_vao),t=new Date(e.thoi_gian_ra),n=(t.getTime()-a.getTime())/36e5;return Math.round(10*n)/10},M=e=>{const a=new Date(e.thoi_gian_vao),t=new Date(a);return t.setHours(8,30,0,0),a>t?"Đi muộn":"Đúng giờ"},T=e=>"Đi muộn"===M(e)?"warning":"success",K=e=>{const a=new Date(e);return a.toLocaleTimeString("vi-VN",{hour:"2-digit",minute:"2-digit"})},$=e=>{const a=new Date(e);return a.toLocaleDateString("vi-VN",{day:"2-digit",month:"2-digit",year:"numeric"})},W=e=>{const a=new Date(e);return a.toLocaleDateString("vi-VN",{weekday:"short"})};return(0,n.sV)(()=>{V()}),(e,o)=>{const i=(0,n.g2)("el-button"),r=(0,n.g2)("el-option"),F=(0,n.g2)("el-select"),D=(0,n.g2)("el-form-item"),A=(0,n.g2)("el-date-picker"),V=(0,n.g2)("el-form"),B=(0,n.g2)("el-card"),X=(0,n.g2)("el-icon"),N=(0,n.g2)("el-statistic"),G=(0,n.g2)("el-col"),O=(0,n.g2)("el-row"),P=(0,n.g2)("el-table-column"),z=(0,n.g2)("el-tag"),j=(0,n.g2)("el-tooltip"),q=(0,n.g2)("el-table"),Q=(0,n.g2)("el-time-picker"),J=(0,n.g2)("el-input"),Z=(0,n.g2)("el-dialog"),ee=(0,n.g2)("el-empty"),ae=(0,n.gN)("loading");return(0,n.uX)(),(0,n.CE)("div",s,[(0,n.Lk)("div",u,[o[10]||(o[10]=(0,n.Lk)("h1",{class:"orangehrm-page-title"},"Bảng chấm công",-1)),(0,n.Lk)("div",c,[(0,n.bF)(i,{icon:(0,n.R1)(l.Refresh),onClick:E},{default:(0,n.k6)(()=>[...o[8]||(o[8]=[(0,n.eW)("Tải lại",-1)])]),_:1},8,["icon"]),(0,n.bF)(i,{type:"primary",icon:(0,n.R1)(l.Download),onClick:U},{default:(0,n.k6)(()=>[...o[9]||(o[9]=[(0,n.eW)(" Xuất Excel ",-1)])]),_:1},8,["icon"])])]),(0,n.bF)(B,{class:"orangehrm-filter-card",shadow:"never"},{default:(0,n.k6)(()=>[(0,n.bF)(V,{inline:!0},{default:(0,n.k6)(()=>[(0,n.bF)(D,{label:"Nhân viên"},{default:(0,n.k6)(()=>[(0,n.bF)(F,{modelValue:v.value,"onUpdate:modelValue":o[0]||(o[0]=e=>v.value=e),placeholder:"Chọn nhân viên",filterable:"",clearable:"",style:{width:"300px"},onChange:E},{default:(0,n.k6)(()=>[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(a.value,e=>((0,n.uX)(),(0,n.Wv)(r,{key:e._id,label:`${e.ho_dem} ${e.ten} (${e.ma_nhan_vien})`,value:e._id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),(0,n.bF)(D,{label:"Từ ngày"},{default:(0,n.k6)(()=>[(0,n.bF)(A,{modelValue:C.value,"onUpdate:modelValue":o[1]||(o[1]=e=>C.value=e),type:"date",placeholder:"Chọn ngày",style:{width:"180px"},format:"DD/MM/YYYY","value-format":"YYYY-MM-DD",onChange:E},null,8,["modelValue"])]),_:1}),(0,n.bF)(D,{label:"Đến ngày"},{default:(0,n.k6)(()=>[(0,n.bF)(A,{modelValue:R.value,"onUpdate:modelValue":o[2]||(o[2]=e=>R.value=e),type:"date",placeholder:"Chọn ngày",style:{width:"180px"},format:"DD/MM/YYYY","value-format":"YYYY-MM-DD",onChange:E},null,8,["modelValue"])]),_:1}),(0,n.bF)(D,null,{default:(0,n.k6)(()=>[(0,n.bF)(i,{type:"primary",onClick:E},{default:(0,n.k6)(()=>[...o[11]||(o[11]=[(0,n.eW)("Tìm kiếm",-1)])]),_:1})]),_:1})]),_:1})]),_:1}),v.value&&w.value?((0,n.uX)(),(0,n.Wv)(O,{key:0,gutter:16,class:"orangehrm-summary-row"},{default:(0,n.k6)(()=>[(0,n.bF)(G,{xs:12,sm:6},{default:(0,n.k6)(()=>[(0,n.bF)(B,{class:"orangehrm-stat-card",shadow:"hover"},{default:(0,n.k6)(()=>[(0,n.bF)(N,{title:"Tổng số ngày",value:w.value.total_days},{prefix:(0,n.k6)(()=>[(0,n.bF)(X,{color:"#4A90E2"},{default:(0,n.k6)(()=>[(0,n.bF)((0,n.R1)(l.Calendar))]),_:1})]),_:1},8,["value"])]),_:1})]),_:1}),(0,n.bF)(G,{xs:12,sm:6},{default:(0,n.k6)(()=>[(0,n.bF)(B,{class:"orangehrm-stat-card",shadow:"hover"},{default:(0,n.k6)(()=>[(0,n.bF)(N,{title:"Ngày đi làm",value:w.value.present_days},{prefix:(0,n.k6)(()=>[(0,n.bF)(X,{color:"#67C23A"},{default:(0,n.k6)(()=>[(0,n.bF)((0,n.R1)(l.CircleCheck))]),_:1})]),_:1},8,["value"])]),_:1})]),_:1}),(0,n.bF)(G,{xs:12,sm:6},{default:(0,n.k6)(()=>[(0,n.bF)(B,{class:"orangehrm-stat-card",shadow:"hover"},{default:(0,n.k6)(()=>[(0,n.bF)(N,{title:"Ngày vắng",value:w.value.absent_days},{prefix:(0,n.k6)(()=>[(0,n.bF)(X,{color:"#F56C6C"},{default:(0,n.k6)(()=>[(0,n.bF)((0,n.R1)(l.CircleClose))]),_:1})]),_:1},8,["value"])]),_:1})]),_:1}),(0,n.bF)(G,{xs:12,sm:6},{default:(0,n.k6)(()=>[(0,n.bF)(B,{class:"orangehrm-stat-card",shadow:"hover"},{default:(0,n.k6)(()=>[(0,n.bF)(N,{title:"Tổng giờ làm",value:w.value.total_hours},{prefix:(0,n.k6)(()=>[(0,n.bF)(X,{color:"#E6A23C"},{default:(0,n.k6)(()=>[(0,n.bF)((0,n.R1)(l.Clock))]),_:1})]),suffix:(0,n.k6)(()=>[...o[12]||(o[12]=[(0,n.eW)("giờ",-1)])]),_:1},8,["value"])]),_:1})]),_:1})]),_:1})):(0,n.Q3)("",!0),(0,n.bF)(B,{class:"orangehrm-table-card",shadow:"never"},{default:(0,n.k6)(()=>[(0,n.bo)(((0,n.uX)(),(0,n.Wv)(q,{data:t.value,style:{width:"100%"},stripe:"","empty-text":b.value||"Không có dữ liệu"},{default:(0,n.k6)(()=>[(0,n.bF)(P,{type:"index",label:"STT",width:"60"}),(0,n.bF)(P,{prop:"ngay",label:"Ngày",width:"150"},{default:(0,n.k6)(({row:e})=>[(0,n.Lk)("strong",null,(0,n.v_)($(e.ngay)),1),o[13]||(o[13]=(0,n.Lk)("br",null,null,-1)),(0,n.Lk)("span",h,(0,n.v_)(W(e.ngay)),1)]),_:1}),(0,n.bF)(P,{label:"Giờ vào",width:"120"},{default:(0,n.k6)(({row:e})=>[(0,n.Lk)("div",d,[(0,n.bF)(X,{color:"#67C23A"},{default:(0,n.k6)(()=>[(0,n.bF)((0,n.R1)(l.VideoPlay))]),_:1}),(0,n.Lk)("strong",null,(0,n.v_)(K(e.thoi_gian_vao)),1)])]),_:1}),(0,n.bF)(P,{label:"Giờ ra",width:"120"},{default:(0,n.k6)(({row:e})=>[e.thoi_gian_ra?((0,n.uX)(),(0,n.CE)("div",g,[(0,n.bF)(X,{color:"#E6A23C"},{default:(0,n.k6)(()=>[(0,n.bF)((0,n.R1)(l.VideoPause))]),_:1}),(0,n.Lk)("strong",null,(0,n.v_)(K(e.thoi_gian_ra)),1)])):((0,n.uX)(),(0,n.CE)("span",_,"-"))]),_:1}),(0,n.bF)(P,{label:"Số giờ",width:"100"},{default:(0,n.k6)(({row:e})=>[(0,n.bF)(z,{type:"info"},{default:(0,n.k6)(()=>[(0,n.eW)((0,n.v_)(H(e))+" giờ",1)]),_:2},1024)]),_:1}),(0,n.bF)(P,{label:"Trạng thái",width:"120"},{default:(0,n.k6)(({row:e})=>[(0,n.bF)(z,{type:T(e),size:"small"},{default:(0,n.k6)(()=>[(0,n.eW)((0,n.v_)(M(e)),1)]),_:2},1032,["type"])]),_:1}),(0,n.bF)(P,{label:"Ghi chú","min-width":"200"},{default:(0,n.k6)(({row:e})=>[e.ghi_chu&&e.ghi_chu.length>50?((0,n.uX)(),(0,n.Wv)(j,{key:0,content:e.ghi_chu,placement:"top"},{default:(0,n.k6)(()=>[(0,n.Lk)("span",null,(0,n.v_)(e.ghi_chu.substring(0,50))+"...",1)]),_:2},1032,["content"])):((0,n.uX)(),(0,n.CE)("span",m,(0,n.v_)(e.ghi_chu||"-"),1))]),_:1}),(0,n.bF)(P,{label:"Hành động",width:"150",fixed:"right"},{default:(0,n.k6)(({row:e})=>[(0,n.bF)(i,{size:"small",icon:(0,n.R1)(l.Edit),onClick:a=>L(e)},{default:(0,n.k6)(()=>[...o[14]||(o[14]=[(0,n.eW)(" Sửa ",-1)])]),_:1},8,["icon","onClick"])]),_:1})]),_:1},8,["data","empty-text"])),[[ae,p.value]])]),_:1}),(0,n.bF)(Z,{modelValue:k.value,"onUpdate:modelValue":o[7]||(o[7]=e=>k.value=e),title:"Chỉnh sửa bản ghi chấm công",width:"600px","close-on-click-modal":!1},{footer:(0,n.k6)(()=>[(0,n.bF)(i,{onClick:I},{default:(0,n.k6)(()=>[...o[15]||(o[15]=[(0,n.eW)("Hủy",-1)])]),_:1}),(0,n.bF)(i,{type:"primary",loading:f.value,onClick:Y},{default:(0,n.k6)(()=>[...o[16]||(o[16]=[(0,n.eW)(" Cập nhật ",-1)])]),_:1},8,["loading"])]),default:(0,n.k6)(()=>[(0,n.bF)(V,{ref_key:"editFormRef",ref:y,model:x,rules:S,"label-width":"140px","label-position":"left"},{default:(0,n.k6)(()=>[(0,n.bF)(D,{label:"Ngày",prop:"ngay"},{default:(0,n.k6)(()=>[(0,n.bF)(A,{modelValue:x.ngay,"onUpdate:modelValue":o[3]||(o[3]=e=>x.ngay=e),type:"date",placeholder:"Chọn ngày",style:{width:"100%"},format:"DD/MM/YYYY","value-format":"YYYY-MM-DD",disabled:""},null,8,["modelValue"])]),_:1}),(0,n.bF)(D,{label:"Giờ vào",prop:"thoi_gian_vao",required:""},{default:(0,n.k6)(()=>[(0,n.bF)(Q,{modelValue:x.thoi_gian_vao,"onUpdate:modelValue":o[4]||(o[4]=e=>x.thoi_gian_vao=e),placeholder:"Chọn giờ vào",style:{width:"100%"},format:"HH:mm"},null,8,["modelValue"])]),_:1}),(0,n.bF)(D,{label:"Giờ ra",prop:"thoi_gian_ra"},{default:(0,n.k6)(()=>[(0,n.bF)(Q,{modelValue:x.thoi_gian_ra,"onUpdate:modelValue":o[5]||(o[5]=e=>x.thoi_gian_ra=e),placeholder:"Chọn giờ ra",style:{width:"100%"},format:"HH:mm"},null,8,["modelValue"])]),_:1}),(0,n.bF)(D,{label:"Ghi chú",prop:"ghi_chu"},{default:(0,n.k6)(()=>[(0,n.bF)(J,{modelValue:x.ghi_chu,"onUpdate:modelValue":o[6]||(o[6]=e=>x.ghi_chu=e),type:"textarea",rows:4,placeholder:"Nhập ghi chú..."},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),v.value||p.value?(0,n.Q3)("",!0):((0,n.uX)(),(0,n.Wv)(ee,{key:1,description:"Vui lòng chọn nhân viên để xem bảng chấm công","image-size":200}))])}}}),p=t(6262);const b=(0,p.A)(v,[["__scopeId","data-v-660c98d2"]]);var f=b},6593:function(e,a,t){var n=t(1114),l=(t(8111),t(7588),t(1526));class o{constructor(){(0,n.A)(this,"BASE_URL","/chamcong")}async clockIn(e){const a=await l.A.post(`${this.BASE_URL}/clock-in`,e);return a.data}async clockOut(e){const a=await l.A.post(`${this.BASE_URL}/clock-out`,e);return a.data}async getHistory(e){const{nhan_vien_id:a,from:t,to:n}=e,o=await l.A.get(`${this.BASE_URL}/history/${a}`,{params:{from:t,to:n}});return o.data?.data||[]}async update(e,a){const t=await l.A.put(`${this.BASE_URL}/${e}`,a);return t.data}async getSummary(e,a,t){const n=await this.getHistory({nhan_vien_id:e,from:a,to:t}),l=this.calculateWorkDays(a,t),o=n.length,i=l-o;let r=0,s=0;return n.forEach(e=>{const a=new Date(e.thoi_gian_vao),t=new Date(a);if(t.setHours(8,30,0,0),a>t&&r++,e.thoi_gian_ra){const a=new Date(e.thoi_gian_vao),t=new Date(e.thoi_gian_ra),n=(t.getTime()-a.getTime())/36e5;s+=n}}),{total_days:l,present_days:o,absent_days:i,late_days:r,total_hours:Math.round(10*s)/10}}calculateWorkDays(e,a){const t=new Date(e),n=new Date(a);let l=0;const o=new Date(t);while(o<=n){const e=o.getDay();0!==e&&6!==e&&l++,o.setDate(o.getDate()+1)}return l}}a.A=new o},6604:function(e,a,t){var n=t(1114),l=t(1526);class o{constructor(){(0,n.A)(this,"BASE_URL","/nhanvien")}async getAll(e){const a=await l.A.get(this.BASE_URL,{params:e});return a.data}async getById(e){const a=await l.A.get(`${this.BASE_URL}/${e}`);return a.data}async create(e){const a=await l.A.post(this.BASE_URL,e);return a.data}async update(e,a){const t=await l.A.put(`${this.BASE_URL}/${e}`,a);return t.data}async delete(e){await l.A.delete(`${this.BASE_URL}/${e}`)}}a.A=new o},7588:function(e,a,t){var n=t(6518),l=t(9565),o=t(2652),i=t(9306),r=t(8551),s=t(1767),u=t(9539),c=t(4549),h=c("forEach",TypeError);n({target:"Iterator",proto:!0,real:!0,forced:h},{forEach:function(e){r(this);try{i(e)}catch(n){u(this,"throw",n)}if(h)return l(h,this,e);var a=s(this),t=0;o(a,function(a){e(a,t++)},{IS_RECORD:!0})}})}}]);
//# sourceMappingURL=1639.a6b7e58c.js.map