"use strict";(self["webpackChunkHungHutech"]=self["webpackChunkHungHutech"]||[]).push([[1481],{1114:function(e,a,t){function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function l(e,a){if("object"!=n(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var l=t.call(e,a||"default");if("object"!=n(l))return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===a?String:Number)(e)}function i(e){var a=l(e,"string");return"symbol"==n(a)?a:a+""}function o(e,a,t){return(a=i(a))in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}t.d(a,{A:function(){return o}})},1481:function(e,a,t){t.r(a),t.d(a,{default:function(){return w}});var n=t(1431),l=t(163),i=t(4353),o=t.n(i),r=t(8548),s=t(1114),c=t(1526);class u{constructor(){(0,s.A)(this,"BASE_URL","/shift-assignments")}async getAll(e){const a=await c.A.get(this.BASE_URL,{params:e});return a.data}async bulkAssign(e){await c.A.post(this.BASE_URL,e)}async delete(e){await c.A.delete(`${this.BASE_URL}/${e}`)}}var d=new u,h=t(6604),_=t(3510);const g={class:"shift-assignment-page"},p={class:"page-header"},m={class:"card-header"},v={class:"card-filters"},f={class:"shift-cell"},b={class:"table-pagination"};var k=(0,n.pM)({__name:"ShiftAssignmentPage",setup(e){const a=(0,n.KR)([]),t=(0,n.KR)([]),i=(0,n.KR)([]),s=(0,n.KR)(!1),c=(0,n.KR)(!1),u=(0,n.KR)(),k=(0,n.Kh)({nhan_vien_ids:[],ca_lam_viec_id:"",dateRange:[],ghi_chu:""}),y={nhan_vien_ids:[{required:!0,message:"Chọn ít nhất 1 nhân viên",trigger:"change"}],ca_lam_viec_id:[{required:!0,message:"Chọn ca làm việc",trigger:"change"}],dateRange:[{type:"array",required:!0,message:"Chọn khoảng ngày",trigger:"change"}]},A=(0,n.Kh)({nhan_vien_id:"",dates:[o()().startOf("week").format("YYYY-MM-DD"),o()().endOf("week").format("YYYY-MM-DD")]}),w=(0,n.Kh)({page:1,limit:20,total:0}),R=e=>e?o()(e).format("DD/MM/YYYY"):"--",F=async()=>{try{const e=await h.A.getAll({limit:200});a.value=e.data||[]}catch{a.value=[]}},L=async()=>{try{const e=await _.A.getAll({limit:200});t.value=e.data||e.items||[]}catch{t.value=[]}},S=async()=>{c.value=!0;try{const e={page:w.page,limit:w.limit};A.nhan_vien_id&&(e.nhan_vien_id=A.nhan_vien_id),2===A.dates?.length&&(e.from=A.dates[0],e.to=A.dates[1]);const a=await d.getAll(e);i.value=a.data||[],w.total=a.pagination.total}catch(e){console.error("loadAssignments error",e),l.nk.error(e.response?.data?.msg||"Không thể tải phân ca")}finally{c.value=!1}},Y=async()=>{if(u.value){try{await u.value.validate()}catch{return}s.value=!0;try{await d.bulkAssign({nhan_vien_ids:k.nhan_vien_ids,ca_lam_viec_id:k.ca_lam_viec_id,from_date:k.dateRange[0],to_date:k.dateRange[1],ghi_chu:k.ghi_chu||void 0}),l.nk.success("Đã gán ca thành công"),$(),S()}catch(e){console.error("handleAssign error",e),l.nk.error(e.response?.data?.msg||"Không thể gán ca")}finally{s.value=!1}}},$=()=>{u.value&&u.value.resetFields(),k.nhan_vien_ids=[],k.ca_lam_viec_id="",k.dateRange=[],k.ghi_chu=""},U=()=>{w.page=1,S()},C=e=>{w.page=e,S()},E=async e=>{try{await d.delete(e),l.nk.success("Đã xóa phân ca"),S()}catch(a){l.nk.error(a.response?.data?.msg||"Không thể xóa phân ca")}};return(0,n.sV)(()=>{F(),L(),S()}),(e,l)=>{const o=(0,n.g2)("el-button"),d=(0,n.g2)("el-option"),h=(0,n.g2)("el-select"),_=(0,n.g2)("el-form-item"),F=(0,n.g2)("el-col"),L=(0,n.g2)("el-row"),x=(0,n.g2)("el-date-picker"),B=(0,n.g2)("el-input"),V=(0,n.g2)("el-form"),I=(0,n.g2)("el-card"),D=(0,n.g2)("el-table-column"),K=(0,n.g2)("el-popconfirm"),M=(0,n.g2)("el-table"),W=(0,n.g2)("el-pagination"),X=(0,n.gN)("loading");return(0,n.uX)(),(0,n.CE)("div",g,[(0,n.Lk)("div",p,[l[7]||(l[7]=(0,n.Lk)("div",null,[(0,n.Lk)("h2",null,"Phân ca linh hoạt"),(0,n.Lk)("p",null,"Gán ca làm việc chi tiết theo từng ngày và nhân viên.")],-1)),(0,n.bF)(o,{icon:(0,n.R1)(r.Refresh),onClick:S},{default:(0,n.k6)(()=>[...l[6]||(l[6]=[(0,n.eW)("Tải lại",-1)])]),_:1},8,["icon"])]),(0,n.bF)(I,{shadow:"never"},{header:(0,n.k6)(()=>[...l[8]||(l[8]=[(0,n.Lk)("div",{class:"card-header"},[(0,n.Lk)("h3",null,"Phân ca nhanh"),(0,n.Lk)("small",null,"Áp dụng tối đa 62 ngày cho nhiều nhân viên.")],-1)])]),default:(0,n.k6)(()=>[(0,n.bF)(V,{ref_key:"formRef",ref:u,model:k,rules:y,"label-width":"160px","label-position":"left"},{default:(0,n.k6)(()=>[(0,n.bF)(L,{gutter:20},{default:(0,n.k6)(()=>[(0,n.bF)(F,{md:12,xs:24},{default:(0,n.k6)(()=>[(0,n.bF)(_,{label:"Nhân viên",prop:"nhan_vien_ids"},{default:(0,n.k6)(()=>[(0,n.bF)(h,{modelValue:k.nhan_vien_ids,"onUpdate:modelValue":l[0]||(l[0]=e=>k.nhan_vien_ids=e),multiple:"",filterable:"",placeholder:"Chọn nhân viên"},{default:(0,n.k6)(()=>[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(a.value,e=>((0,n.uX)(),(0,n.Wv)(d,{key:e._id,label:`${e.ma_nhan_vien} - ${e.ho_dem||""} ${e.ten||""}`,value:e._id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),(0,n.bF)(F,{md:12,xs:24},{default:(0,n.k6)(()=>[(0,n.bF)(_,{label:"Ca làm việc",prop:"ca_lam_viec_id"},{default:(0,n.k6)(()=>[(0,n.bF)(h,{modelValue:k.ca_lam_viec_id,"onUpdate:modelValue":l[1]||(l[1]=e=>k.ca_lam_viec_id=e),placeholder:"Chọn ca"},{default:(0,n.k6)(()=>[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(t.value,e=>((0,n.uX)(),(0,n.Wv)(d,{key:e._id,label:`${e.ten_ca} (${e.gio_bat_dau} - ${e.gio_ket_thuc})`,value:e._id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),(0,n.bF)(L,{gutter:20},{default:(0,n.k6)(()=>[(0,n.bF)(F,{md:12,xs:24},{default:(0,n.k6)(()=>[(0,n.bF)(_,{label:"Khoảng áp dụng",prop:"dateRange"},{default:(0,n.k6)(()=>[(0,n.bF)(x,{modelValue:k.dateRange,"onUpdate:modelValue":l[2]||(l[2]=e=>k.dateRange=e),type:"daterange","unlink-panels":"","start-placeholder":"Từ ngày","end-placeholder":"Đến ngày","value-format":"YYYY-MM-DD",format:"DD/MM/YYYY",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),(0,n.bF)(F,{md:12,xs:24},{default:(0,n.k6)(()=>[(0,n.bF)(_,{label:"Ghi chú"},{default:(0,n.k6)(()=>[(0,n.bF)(B,{modelValue:k.ghi_chu,"onUpdate:modelValue":l[3]||(l[3]=e=>k.ghi_chu=e),placeholder:"Ví dụ: Luân phiên lễ tết"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),(0,n.bF)(_,null,{default:(0,n.k6)(()=>[(0,n.bF)(o,{type:"primary",icon:(0,n.R1)(r.Opportunity),loading:s.value,onClick:Y},{default:(0,n.k6)(()=>[...l[9]||(l[9]=[(0,n.eW)(" Gán ca ",-1)])]),_:1},8,["icon","loading"]),(0,n.bF)(o,{onClick:$},{default:(0,n.k6)(()=>[...l[10]||(l[10]=[(0,n.eW)("Nhập lại",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),(0,n.bF)(I,{shadow:"never"},{header:(0,n.k6)(()=>[(0,n.Lk)("div",m,[l[12]||(l[12]=(0,n.Lk)("h3",null,"Danh sách phân ca",-1)),(0,n.Lk)("div",v,[(0,n.bF)(h,{modelValue:A.nhan_vien_id,"onUpdate:modelValue":l[4]||(l[4]=e=>A.nhan_vien_id=e),clearable:"",placeholder:"Lọc theo nhân viên",size:"small"},{default:(0,n.k6)(()=>[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(a.value,e=>((0,n.uX)(),(0,n.Wv)(d,{key:e._id,label:`${e.ma_nhan_vien} - ${e.ho_dem||""} ${e.ten||""}`,value:e._id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),(0,n.bF)(x,{modelValue:A.dates,"onUpdate:modelValue":l[5]||(l[5]=e=>A.dates=e),type:"daterange","unlink-panels":"","start-placeholder":"Từ ngày","end-placeholder":"Đến ngày","value-format":"YYYY-MM-DD",format:"DD/MM/YYYY",size:"small"},null,8,["modelValue"]),(0,n.bF)(o,{size:"small",icon:(0,n.R1)(r.Search),onClick:U},{default:(0,n.k6)(()=>[...l[11]||(l[11]=[(0,n.eW)(" Lọc ",-1)])]),_:1},8,["icon"])])])]),default:(0,n.k6)(()=>[(0,n.bo)(((0,n.uX)(),(0,n.Wv)(M,{data:i.value,"empty-text":c.value?"Đang tải...":"Chưa có dữ liệu"},{default:(0,n.k6)(()=>[(0,n.bF)(D,{label:"Ngày",width:"140"},{default:(0,n.k6)(({row:e})=>[(0,n.eW)((0,n.v_)(R(e.ngay)),1)]),_:1}),(0,n.bF)(D,{label:"Nhân viên","min-width":"200"},{default:(0,n.k6)(({row:e})=>[(0,n.eW)((0,n.v_)("object"===typeof e.nhan_vien_id?`${e.nhan_vien_id?.ho_dem||""} ${e.nhan_vien_id?.ten||""}`:e.nhan_vien_id),1)]),_:1}),(0,n.bF)(D,{label:"Ca","min-width":"180"},{default:(0,n.k6)(({row:e})=>[(0,n.Lk)("div",f,[(0,n.Lk)("span",null,(0,n.v_)(e.shift_snapshot?.ten_ca||"---"),1),(0,n.Lk)("small",null,(0,n.v_)(e.shift_snapshot?.gio_bat_dau||"--:--")+" - "+(0,n.v_)(e.shift_snapshot?.gio_ket_thuc||"--:--"),1)])]),_:1}),(0,n.bF)(D,{prop:"ghi_chu",label:"Ghi chú","min-width":"180"}),(0,n.bF)(D,{label:"Hành động",width:"130",fixed:"right"},{default:(0,n.k6)(({row:e})=>[(0,n.bF)(K,{width:"220",title:"Xóa phân ca ngày này?",onConfirm:a=>E(e._id)},{reference:(0,n.k6)(()=>[(0,n.bF)(o,{size:"small",type:"danger",icon:(0,n.R1)(r.Delete),link:""},{default:(0,n.k6)(()=>[...l[13]||(l[13]=[(0,n.eW)(" Xóa ",-1)])]),_:1},8,["icon"])]),_:1},8,["onConfirm"])]),_:1})]),_:1},8,["data","empty-text"])),[[X,c.value]]),(0,n.Lk)("div",b,[(0,n.bF)(W,{background:"",layout:"total, prev, pager, next",total:w.total,"current-page":w.page,"page-size":w.limit,onCurrentChange:C},null,8,["total","current-page","page-size"])])]),_:1})])}}}),y=t(6262);const A=(0,y.A)(k,[["__scopeId","data-v-6932b990"]]);var w=A},1526:function(e,a,t){var n=t(1114),l=t(4335);const i=window?.appGlobal?.baseUrl&&`${window.appGlobal.baseUrl}/api`,o=i||"http://192.168.88.50:5000/api";console.log("API Base URL:",o);class r{constructor(){(0,n.A)(this,"axiosInstance",void 0),this.axiosInstance=l.A.create({baseURL:o,headers:{"Content-Type":"application/json"}}),this.axiosInstance.interceptors.request.use(e=>{const a=localStorage.getItem("token");return a&&(e.headers.Authorization=`Bearer ${a}`),e},e=>Promise.reject(e)),this.axiosInstance.interceptors.response.use(e=>e,e=>(401===e.response?.status&&(localStorage.removeItem("token"),localStorage.removeItem("user"),window.location.href="/login"),Promise.reject(e)))}get(e,a){return this.axiosInstance.get(e,a)}post(e,a,t){return this.axiosInstance.post(e,a,t)}put(e,a,t){return this.axiosInstance.put(e,a,t)}delete(e,a){return this.axiosInstance.delete(e,a)}patch(e,a,t){return this.axiosInstance.patch(e,a,t)}}a.A=new r},3510:function(e,a,t){var n=t(1114),l=t(1526);class i{constructor(){(0,n.A)(this,"BASE_URL","/calamviec")}async getAll(e){const a=await l.A.get(this.BASE_URL,{params:e});return a.data}async getById(e){const a=await l.A.get(`${this.BASE_URL}/${e}`);return a.data}async create(e){const a=await l.A.post(this.BASE_URL,e);return a.data}async update(e,a){const t=await l.A.put(`${this.BASE_URL}/${e}`,a);return t.data}async delete(e){await l.A.delete(`${this.BASE_URL}/${e}`)}}a.A=new i},6262:function(e,a){a.A=(e,a)=>{const t=e.__vccOpts||e;for(const[n,l]of a)t[n]=l;return t}},6604:function(e,a,t){var n=t(1114),l=t(1526);class i{constructor(){(0,n.A)(this,"BASE_URL","/nhanvien")}async getAll(e){const a=await l.A.get(this.BASE_URL,{params:e});return a.data}async getById(e){const a=await l.A.get(`${this.BASE_URL}/${e}`);return a.data}async create(e){const a=await l.A.post(this.BASE_URL,e);return a.data}async update(e,a){const t=await l.A.put(`${this.BASE_URL}/${e}`,a);return t.data}async delete(e){await l.A.delete(`${this.BASE_URL}/${e}`)}}a.A=new i}}]);
//# sourceMappingURL=1481.261911cd.js.map