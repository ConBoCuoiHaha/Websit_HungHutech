"use strict";(self["webpackChunkHungHutech"]=self["webpackChunkHungHutech"]||[]).push([[991],{991:function(e,a,l){l.r(a),l.d(a,{default:function(){return k}});l(8111),l(1701);var t=l(1431),n=l(163),i=l(8548),u=l(9372),d=l(6604);const o={class:"page-container"},s={class:"page-header"},r={class:"sub"},c={class:"pagination"},h={key:0},v={class:"task-actions"},b={class:"task-buttons"};var g=(0,t.pM)({__name:"OffboardingList",setup(e){const a=(0,t.KR)(!1),l=(0,t.KR)([]),g=(0,t.Kh)({page:1,limit:10,total:0}),p=(0,t.Kh)({status:""}),_=(0,t.KR)(!1),k=(0,t.KR)(null),m=(0,t.KR)(""),f=(0,t.KR)(!1),y=(0,t.KR)(!1),F=(0,t.Kh)({nhan_vien_id:"",last_working_day:"",reason:""}),w=(0,t.KR)(!1),C=(0,t.KR)([]),V=(0,t.KR)(!1),A=async()=>{a.value=!0;try{const e=await u.A.getAll({page:g.page,limit:g.limit,status:p.status||void 0});l.value=e.items,g.total=e.total}catch(e){n.nk.error(e.response?.data?.msg||"Không thể tải danh sách")}finally{a.value=!1}},L=e=>{g.page=e,A()},K=e=>e&&"object"===typeof e?`${e.ho_dem||""} ${e.ten||""}`.trim():"---",R=e=>e&&"object"===typeof e&&e.ma_nhan_vien||"",W=e=>e?new Date(e).toLocaleDateString("vi-VN"):"---",N=e=>"Completed"===e?"success":"InProgress"===e?"warning":"info",U=e=>{switch(e){case"Pending":return"Chờ xử lý";case"InProgress":return"Đang thực hiện";case"Completed":return"Đã hoàn tất";default:return e}},T=e=>{k.value={...e,tasks:e.tasks.map(e=>({...e,tempNote:e.note}))},_.value=!0,m.value=""},$=(0,t.EW)(()=>k.value?`Checklist - ${K(k.value.nhan_vien_id)}`:""),P=async()=>{if(k.value&&m.value)try{const e=await u.A.updateStatus(k.value._id,m.value);k.value={...e,tasks:e.tasks.map(e=>({...e,tempNote:e.note}))},A(),n.nk.success("Đã cập nhật trạng thái")}catch(e){n.nk.error(e.response?.data?.msg||"Không cập nhật được trạng thái")}},E=async(e,a)=>{if(k.value){f.value=!0;try{const l=await u.A.updateTask(k.value._id,e._id,{status:a,note:e.tempNote});k.value={...l,tasks:l.tasks.map(e=>({...e,tempNote:e.note}))},A(),n.nk.success("Đã cập nhật tác vụ")}catch(l){n.nk.error(l.response?.data?.msg||"Không thể cập nhật tác vụ")}finally{f.value=!1}}},H=async()=>{if(y.value=!0,0===C.value.length){V.value=!0;try{const e=await d.A.getAll({page:1,limit:200});C.value=e.items}catch(e){n.nk.error("Không thể tải danh sách nhân viên")}finally{V.value=!1}}},x=async()=>{if(F.nhan_vien_id){w.value=!0;try{await u.A.create(F),n.nk.success("Đã tạo yêu cầu offboarding"),y.value=!1,F.nhan_vien_id="",F.last_working_day="",F.reason="",A()}catch(e){n.nk.error(e.response?.data?.msg||"Không thể tạo yêu cầu")}finally{w.value=!1}}else n.nk.warning("Vui lòng chọn nhân viên")};return A(),(e,n)=>{const u=(0,t.g2)("el-button"),d=(0,t.g2)("el-option"),z=(0,t.g2)("el-select"),B=(0,t.g2)("el-form-item"),I=(0,t.g2)("el-form"),S=(0,t.g2)("el-card"),M=(0,t.g2)("el-table-column"),X=(0,t.g2)("el-tag"),D=(0,t.g2)("el-table"),Y=(0,t.g2)("el-pagination"),j=(0,t.g2)("el-descriptions-item"),G=(0,t.g2)("el-descriptions"),O=(0,t.g2)("el-input"),Q=(0,t.g2)("el-drawer"),q=(0,t.g2)("el-date-picker"),J=(0,t.g2)("el-dialog"),Z=(0,t.gN)("loading");return(0,t.uX)(),(0,t.CE)("div",o,[(0,t.Lk)("div",s,[n[9]||(n[9]=(0,t.Lk)("div",null,[(0,t.Lk)("h2",null,"Offboarding - Quản lý nghỉ việc"),(0,t.Lk)("p",null,"Theo dõi quy trình bàn giao và checklist khi nhân viên rời công ty.")],-1)),(0,t.bF)(u,{type:"primary",icon:(0,t.R1)(i.Plus),onClick:H},{default:(0,t.k6)(()=>[...n[8]||(n[8]=[(0,t.eW)(" Tạo yêu cầu ",-1)])]),_:1},8,["icon"])]),(0,t.bF)(S,{shadow:"never",class:"mb-lg"},{default:(0,t.k6)(()=>[(0,t.bF)(I,{inline:!0,model:p},{default:(0,t.k6)(()=>[(0,t.bF)(B,{label:"Trạng thái"},{default:(0,t.k6)(()=>[(0,t.bF)(z,{modelValue:p.status,"onUpdate:modelValue":n[0]||(n[0]=e=>p.status=e),placeholder:"Tất cả",onChange:A},{default:(0,t.k6)(()=>[(0,t.bF)(d,{label:"Tất cả",value:""}),(0,t.bF)(d,{label:"Chờ xử lý",value:"Pending"}),(0,t.bF)(d,{label:"Đang thực hiện",value:"InProgress"}),(0,t.bF)(d,{label:"Hoàn thành",value:"Completed"})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1}),(0,t.bF)(S,{shadow:"never"},{default:(0,t.k6)(()=>[(0,t.bo)(((0,t.uX)(),(0,t.Wv)(D,{data:l.value,border:"",onRowClick:T},{default:(0,t.k6)(()=>[(0,t.bF)(M,{type:"index",label:"#",width:"60"}),(0,t.bF)(M,{label:"Nhân viên","min-width":"200"},{default:(0,t.k6)(({row:e})=>[(0,t.Lk)("div",null,[(0,t.Lk)("strong",null,(0,t.v_)(K(e.nhan_vien_id)),1),(0,t.Lk)("div",r,"Mã NV: "+(0,t.v_)(R(e.nhan_vien_id)),1)])]),_:1}),(0,t.bF)(M,{label:"Ngày làm việc cuối",width:"160"},{default:(0,t.k6)(({row:e})=>[(0,t.eW)((0,t.v_)(W(e.last_working_day)),1)]),_:1}),(0,t.bF)(M,{prop:"reason",label:"Lý do","min-width":"200","show-overflow-tooltip":""}),(0,t.bF)(M,{label:"Trạng thái",width:"140"},{default:(0,t.k6)(({row:e})=>[(0,t.bF)(X,{type:N(e.status)},{default:(0,t.k6)(()=>[(0,t.eW)((0,t.v_)(U(e.status)),1)]),_:2},1032,["type"])]),_:1})]),_:1},8,["data"])),[[Z,a.value]]),(0,t.Lk)("div",c,[(0,t.bF)(Y,{background:"",layout:"total, prev, pager, next",total:g.total,"current-page":g.page,"page-size":g.limit,onCurrentChange:L},null,8,["total","current-page","page-size"])])]),_:1}),(0,t.bF)(Q,{modelValue:_.value,"onUpdate:modelValue":n[2]||(n[2]=e=>_.value=e),size:"50%",title:$.value},{default:(0,t.k6)(()=>[k.value?((0,t.uX)(),(0,t.CE)("div",h,[(0,t.bF)(G,{column:1,border:"",class:"mb-lg"},{default:(0,t.k6)(()=>[(0,t.bF)(j,{label:"Nhân viên"},{default:(0,t.k6)(()=>[(0,t.eW)((0,t.v_)(K(k.value.nhan_vien_id)),1)]),_:1}),(0,t.bF)(j,{label:"Mã nhân viên"},{default:(0,t.k6)(()=>[(0,t.eW)((0,t.v_)(R(k.value.nhan_vien_id)),1)]),_:1}),(0,t.bF)(j,{label:"Ngày làm việc cuối"},{default:(0,t.k6)(()=>[(0,t.eW)((0,t.v_)(W(k.value.last_working_day)),1)]),_:1}),(0,t.bF)(j,{label:"Lý do"},{default:(0,t.k6)(()=>[(0,t.eW)((0,t.v_)(k.value.reason||"---"),1)]),_:1}),(0,t.bF)(j,{label:"Trạng thái"},{default:(0,t.k6)(()=>[(0,t.bF)(X,{type:N(k.value.status)},{default:(0,t.k6)(()=>[(0,t.eW)((0,t.v_)(U(k.value.status)),1)]),_:1},8,["type"])]),_:1})]),_:1}),(0,t.Lk)("div",v,[(0,t.bF)(z,{modelValue:m.value,"onUpdate:modelValue":n[1]||(n[1]=e=>m.value=e),placeholder:"Cập nhật trạng thái",size:"small"},{default:(0,t.k6)(()=>[(0,t.bF)(d,{label:"Chờ xử lý",value:"Pending"}),(0,t.bF)(d,{label:"Đang thực hiện",value:"InProgress"}),(0,t.bF)(d,{label:"Hoàn thành",value:"Completed"})]),_:1},8,["modelValue"]),(0,t.bF)(u,{type:"primary",size:"small",onClick:P,disabled:!m.value},{default:(0,t.k6)(()=>[...n[10]||(n[10]=[(0,t.eW)(" Cập nhật ",-1)])]),_:1},8,["disabled"])]),n[14]||(n[14]=(0,t.Lk)("h3",null,"Checklist tác vụ",-1)),(0,t.bF)(D,{data:k.value.tasks,border:""},{default:(0,t.k6)(()=>[(0,t.bF)(M,{label:"Tác vụ","min-width":"220",prop:"name"}),(0,t.bF)(M,{label:"Bộ phận","min-width":"160",prop:"department"}),(0,t.bF)(M,{label:"Hạn hoàn thành",width:"150"},{default:(0,t.k6)(({row:e})=>[(0,t.eW)((0,t.v_)(W(e.due_date)),1)]),_:1}),(0,t.bF)(M,{label:"Trạng thái",width:"150"},{default:(0,t.k6)(({row:e})=>[(0,t.bF)(X,{type:N(e.status)},{default:(0,t.k6)(()=>[(0,t.eW)((0,t.v_)(U(e.status)),1)]),_:2},1032,["type"])]),_:1}),(0,t.bF)(M,{label:"Ghi chú","min-width":"200"},{default:(0,t.k6)(({row:e})=>[(0,t.bF)(O,{modelValue:e.tempNote,"onUpdate:modelValue":a=>e.tempNote=a,type:"textarea",rows:2,placeholder:e.note||"Nhập ghi chú",disabled:f.value},null,8,["modelValue","onUpdate:modelValue","placeholder","disabled"]),(0,t.Lk)("div",b,[(0,t.bF)(u,{size:"small",onClick:a=>E(e,"Pending"),disabled:f.value},{default:(0,t.k6)(()=>[...n[11]||(n[11]=[(0,t.eW)("Pending",-1)])]),_:1},8,["onClick","disabled"]),(0,t.bF)(u,{size:"small",type:"warning",onClick:a=>E(e,"InProgress"),disabled:f.value},{default:(0,t.k6)(()=>[...n[12]||(n[12]=[(0,t.eW)("Đang thực hiện",-1)])]),_:1},8,["onClick","disabled"]),(0,t.bF)(u,{size:"small",type:"success",onClick:a=>E(e,"Completed"),disabled:f.value},{default:(0,t.k6)(()=>[...n[13]||(n[13]=[(0,t.eW)("Hoàn thành",-1)])]),_:1},8,["onClick","disabled"])])]),_:1})]),_:1},8,["data"])])):(0,t.Q3)("",!0)]),_:1},8,["modelValue","title"]),(0,t.bF)(J,{modelValue:y.value,"onUpdate:modelValue":n[7]||(n[7]=e=>y.value=e),title:"Tạo yêu cầu nghỉ việc",width:"500px"},{footer:(0,t.k6)(()=>[(0,t.bF)(u,{onClick:n[6]||(n[6]=e=>y.value=!1)},{default:(0,t.k6)(()=>[...n[15]||(n[15]=[(0,t.eW)("Hủy",-1)])]),_:1}),(0,t.bF)(u,{type:"primary",loading:w.value,onClick:x},{default:(0,t.k6)(()=>[...n[16]||(n[16]=[(0,t.eW)(" Tạo yêu cầu ",-1)])]),_:1},8,["loading"])]),default:(0,t.k6)(()=>[(0,t.bF)(I,{model:F,"label-width":"160px"},{default:(0,t.k6)(()=>[(0,t.bF)(B,{label:"Nhân viên"},{default:(0,t.k6)(()=>[(0,t.bF)(z,{modelValue:F.nhan_vien_id,"onUpdate:modelValue":n[3]||(n[3]=e=>F.nhan_vien_id=e),filterable:"",placeholder:"Chọn nhân viên",loading:V.value},{default:(0,t.k6)(()=>[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(C.value,e=>((0,t.uX)(),(0,t.Wv)(d,{key:e._id,label:`${e.ma_nhan_vien} - ${e.ho_dem} ${e.ten}`,value:e._id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"])]),_:1}),(0,t.bF)(B,{label:"Ngày làm việc cuối"},{default:(0,t.k6)(()=>[(0,t.bF)(q,{modelValue:F.last_working_day,"onUpdate:modelValue":n[4]||(n[4]=e=>F.last_working_day=e),type:"date",placeholder:"Chọn ngày","value-format":"YYYY-MM-DD",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),(0,t.bF)(B,{label:"Lý do"},{default:(0,t.k6)(()=>[(0,t.bF)(O,{modelValue:F.reason,"onUpdate:modelValue":n[5]||(n[5]=e=>F.reason=e),type:"textarea",rows:3,placeholder:"Ghi chú cho HR"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}}),p=l(6262);const _=(0,p.A)(g,[["__scopeId","data-v-5042c2c4"]]);var k=_},6604:function(e,a,l){var t=l(1114),n=l(1526);class i{constructor(){(0,t.A)(this,"BASE_URL","/nhanvien")}async getAll(e){const a=await n.A.get(this.BASE_URL,{params:e});return a.data}async getById(e){const a=await n.A.get(`${this.BASE_URL}/${e}`);return a.data}async create(e){const a=await n.A.post(this.BASE_URL,e);return a.data}async update(e,a){const l=await n.A.put(`${this.BASE_URL}/${e}`,a);return l.data}async delete(e){await n.A.delete(`${this.BASE_URL}/${e}`)}}a.A=new i}}]);
//# sourceMappingURL=991.4eb7bd0e.js.map