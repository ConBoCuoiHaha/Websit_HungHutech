"use strict";(self["webpackChunkHungHutech"]=self["webpackChunkHungHutech"]||[]).push([[2257],{590:function(e,t,a){var n=a(1114),r=a(1526);class l{constructor(){(0,n.A)(this,"BASE_URL","/activities")}async getAll(e){const t=await r.A.get(this.BASE_URL,{params:e});return t.data}async getById(e){const t=await r.A.get(`${this.BASE_URL}/${e}`);return t.data}async create(e){const t=await r.A.post(this.BASE_URL,e);return t.data}async update(e,t){const a=await r.A.put(`${this.BASE_URL}/${e}`,t);return a.data}async delete(e){await r.A.delete(`${this.BASE_URL}/${e}`)}}t.A=new l},731:function(e,t,a){var n=a(1114),r=a(1526);class l{constructor(){(0,n.A)(this,"BASE_URL","/timesheets")}async getAll(e){const t=await r.A.get(this.BASE_URL,{params:e});return t.data}async getById(e){const t=await r.A.get(`${this.BASE_URL}/${e}`);return t.data}async create(e){const t=await r.A.post(this.BASE_URL,e);return t.data}async update(e,t){const a=await r.A.put(`${this.BASE_URL}/${e}`,t);return a.data}async updateStatus(e,t){const a=await r.A.put(`${this.BASE_URL}/${e}/status`,t);return a.data}async approve(e,t){const a=await r.A.put(`${this.BASE_URL}/${e}/approve`,t);return a.data}async delete(e){await r.A.delete(`${this.BASE_URL}/${e}`)}}t.A=new l},1526:function(e,t,a){var n=a(1114),r=a(4335);const l=window?.appGlobal?.baseUrl&&`${window.appGlobal.baseUrl}/api`,o=l||"http://192.168.88.50:5000/api";console.log("API Base URL:",o);class s{constructor(){(0,n.A)(this,"axiosInstance",void 0),this.axiosInstance=r.A.create({baseURL:o,headers:{"Content-Type":"application/json"}}),this.axiosInstance.interceptors.request.use(e=>{const t=localStorage.getItem("token");return t&&(e.headers.Authorization=`Bearer ${t}`),e},e=>Promise.reject(e)),this.axiosInstance.interceptors.response.use(e=>e,e=>(401===e.response?.status&&(localStorage.removeItem("token"),localStorage.removeItem("user"),window.location.href="/login"),Promise.reject(e)))}get(e,t){return this.axiosInstance.get(e,t)}post(e,t,a){return this.axiosInstance.post(e,t,a)}put(e,t,a){return this.axiosInstance.put(e,t,a)}delete(e,t){return this.axiosInstance.delete(e,t)}patch(e,t,a){return this.axiosInstance.patch(e,t,a)}}t.A=new s},2257:function(e,t,a){a.r(t),a.d(t,{default:function(){return Y}});a(4114),a(8111),a(7588),a(8237);var n=a(1431),r=a(8548),l=a(163),o=a(731),s=a(3028),i=a(590),u=a(4353),c=a.n(u),d=a(8134),h=a.n(d);const p={class:"orangehrm-timesheet-employee"},g={class:"orangehrm-card-header"},v={class:"header-actions"},y={class:"timesheet-info"},f={class:"info-item"},m={class:"value"},_={class:"info-item"},w={class:"info-item"},A={class:"value total-hours"},k={class:"table-actions"},b={key:0,class:"timesheet-status"};var E=(0,n.pM)({__name:"TimesheetEmployee",setup(e){c().extend(h());const t=(0,n.KR)(!1),a=(0,n.KR)(!1),u=(0,n.KR)(new Date),d=(0,n.KR)(""),E=(0,n.KR)(null),R=(0,n.KR)([]),L=(0,n.KR)([]),Y=(0,n.KR)([]),U=(0,n.EW)(()=>{const e=c()(u.value).startOf("week");return Array.from({length:7},(t,a)=>{const n=e.add(a,"day");return{date:n.format("YYYY-MM-DD"),label:n.format("dd DD/MM"),dayIndex:a}})}),x=(0,n.EW)(()=>{const e=c()(u.value).startOf("week"),t=e.add(6,"day");return`${e.format("DD/MM/YYYY")} - ${t.format("DD/MM/YYYY")}`}),$=(0,n.EW)(()=>Y.value.reduce((e,t)=>e+C(t),0).toFixed(1)),C=e=>e.days.reduce((e,t)=>e+(t||0),0),I=e=>{const{columns:t,data:a}=e,n=[];return t.forEach((e,r)=>{if(0===r)return void(n[r]="Tổng");if(r===t.length-1||r===t.length-2)return void(n[r]="");const l=r-1,o=a.reduce((e,t)=>e+(t.days[l]||0),0);n[r]=`${o.toFixed(1)}h`}),n},B=async()=>{try{const e=await s.A.getAll({limit:1e3});R.value=e.data||[],R.value.length>0&&!d.value&&(d.value=R.value[0]._id)}catch(e){console.error("Error loading projects:",e)}},S=async()=>{try{const e=await i.A.getAll({limit:1e3});L.value=e.data||[]}catch(e){console.error("Error loading activities:",e)}},F=async()=>{t.value=!0;try{const e=c()(u.value).startOf("week"),t=e.add(6,"day"),a=await o.A.getAll({ngay_bat_dau:e.format("YYYY-MM-DD"),ngay_ket_thuc:t.format("YYYY-MM-DD"),limit:1});a.data&&a.data.length>0?(E.value=a.data[0],Y.value=E.value.chi_tiet_timesheet||[]):(E.value=null,Y.value=[],T())}catch(e){console.error("Error loading timesheet:",e),l.nk.error("Không thể tải timesheet")}finally{t.value=!1}},D=()=>{F()},T=()=>{Y.value.push({hoat_dong_id:"",days:[0,0,0,0,0,0,0]})},M=e=>{Y.value.splice(e,1)},V=async()=>{if(d.value)if(0!==Y.value.length){a.value=!0;try{const e=c()(u.value).startOf("week"),t=e.add(6,"day"),a={du_an_id:d.value,ngay_bat_dau:e.format("YYYY-MM-DD"),ngay_ket_thuc:t.format("YYYY-MM-DD"),chi_tiet_timesheet:Y.value,tong_gio:parseFloat($.value),trang_thai:"Chưa gửi"};E.value?(await o.A.update(E.value._id,a),l.nk.success("Cập nhật timesheet thành công")):(await o.A.create(a),l.nk.success("Tạo timesheet thành công")),F()}catch(e){l.nk.error(e.response?.data?.msg||"Không thể lưu timesheet")}finally{a.value=!1}}else l.nk.warning("Vui lòng thêm ít nhất một hoạt động");else l.nk.warning("Vui lòng chọn dự án")},K=e=>{const t={"Chưa gửi":"Chưa gửi","Chờ duyệt":"Chờ duyệt","Đã duyệt":"Đã duyệt","Từ chối":"Từ chối"};return t[e]||e},O=e=>{const t={"Chưa gửi":"info","Chờ duyệt":"warning","Đã duyệt":"success","Từ chối":"error"};return t[e]||"info"};return(0,n.sV)(()=>{B(),S(),F()}),(e,l)=>{const o=(0,n.g2)("el-date-picker"),s=(0,n.g2)("el-button"),i=(0,n.g2)("el-col"),c=(0,n.g2)("el-option"),h=(0,n.g2)("el-select"),B=(0,n.g2)("el-row"),S=(0,n.g2)("el-table-column"),F=(0,n.g2)("el-input-number"),W=(0,n.g2)("el-tag"),j=(0,n.g2)("el-table"),X=(0,n.g2)("el-alert"),P=(0,n.g2)("el-card"),H=(0,n.gN)("loading");return(0,n.uX)(),(0,n.CE)("div",p,[(0,n.bF)(P,{shadow:"never"},{header:(0,n.k6)(()=>[(0,n.Lk)("div",g,[l[3]||(l[3]=(0,n.Lk)("h2",{class:"orangehrm-card-title"},"Bảng chấm công của tôi",-1)),(0,n.Lk)("div",v,[(0,n.bF)(o,{modelValue:u.value,"onUpdate:modelValue":l[0]||(l[0]=e=>u.value=e),type:"week",format:"[Tuần] ww - YYYY",placeholder:"Chọn tuần",style:{"margin-right":"12px"},onChange:D},null,8,["modelValue"]),(0,n.bF)(s,{type:"primary",loading:a.value,icon:(0,n.R1)(r.Check),onClick:V},{default:(0,n.k6)(()=>[...l[2]||(l[2]=[(0,n.eW)(" Lưu Timesheet ",-1)])]),_:1},8,["loading","icon"])])])]),default:(0,n.k6)(()=>[(0,n.Lk)("div",y,[(0,n.bF)(B,{gutter:20},{default:(0,n.k6)(()=>[(0,n.bF)(i,{span:8},{default:(0,n.k6)(()=>[(0,n.Lk)("div",f,[l[4]||(l[4]=(0,n.Lk)("span",{class:"label"},"Tuần:",-1)),(0,n.Lk)("span",m,(0,n.v_)(x.value),1)])]),_:1}),(0,n.bF)(i,{span:8},{default:(0,n.k6)(()=>[(0,n.Lk)("div",_,[l[5]||(l[5]=(0,n.Lk)("span",{class:"label"},"Dự án:",-1)),(0,n.bF)(h,{modelValue:d.value,"onUpdate:modelValue":l[1]||(l[1]=e=>d.value=e),placeholder:"Chọn dự án",style:{width:"100%"}},{default:(0,n.k6)(()=>[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(R.value,e=>((0,n.uX)(),(0,n.Wv)(c,{key:e._id,label:e.ten,value:e._id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])]),_:1}),(0,n.bF)(i,{span:8},{default:(0,n.k6)(()=>[(0,n.Lk)("div",w,[l[6]||(l[6]=(0,n.Lk)("span",{class:"label"},"Tổng giờ:",-1)),(0,n.Lk)("span",A,(0,n.v_)($.value)+" giờ",1)])]),_:1})]),_:1})]),(0,n.bo)(((0,n.uX)(),(0,n.Wv)(j,{data:Y.value,border:"",class:"orangehrm-timesheet-table",style:{"margin-top":"20px"},"summary-method":I,"show-summary":""},{default:(0,n.k6)(()=>[(0,n.bF)(S,{label:"Hoạt động","min-width":"200",fixed:""},{default:(0,n.k6)(e=>[(0,n.bF)(h,{modelValue:e.row.hoat_dong_id,"onUpdate:modelValue":t=>e.row.hoat_dong_id=t,placeholder:"Chọn hoạt động",filterable:"",style:{width:"100%"}},{default:(0,n.k6)(()=>[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(L.value,e=>((0,n.uX)(),(0,n.Wv)(c,{key:e._id,label:e.ten,value:e._id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onUpdate:modelValue"])]),_:1}),((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(U.value,e=>((0,n.uX)(),(0,n.Wv)(S,{key:e.date,label:e.label,width:"100",align:"center"},{default:(0,n.k6)(t=>[(0,n.bF)(F,{modelValue:t.row.days[e.dayIndex],"onUpdate:modelValue":a=>t.row.days[e.dayIndex]=a,min:0,max:24,step:.5,precision:1,"controls-position":"right",size:"small",style:{width:"90px"}},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"]))),128)),(0,n.bF)(S,{label:"Tổng",width:"100",align:"center"},{default:(0,n.k6)(e=>[(0,n.bF)(W,{type:"info"},{default:(0,n.k6)(()=>[(0,n.eW)((0,n.v_)(C(e.row))+"h",1)]),_:2},1024)]),_:1}),(0,n.bF)(S,{label:"Thao tác",width:"80",align:"center",fixed:"right"},{default:(0,n.k6)(e=>[(0,n.bF)(s,{size:"small",type:"danger",icon:(0,n.R1)(r.Delete),onClick:t=>M(e.$index)},null,8,["icon","onClick"])]),_:1})]),_:1},8,["data"])),[[H,t.value]]),(0,n.Lk)("div",k,[(0,n.bF)(s,{icon:(0,n.R1)(r.Plus),onClick:T},{default:(0,n.k6)(()=>[...l[7]||(l[7]=[(0,n.eW)("Thêm hoạt động",-1)])]),_:1},8,["icon"])]),E.value?((0,n.uX)(),(0,n.CE)("div",b,[(0,n.bF)(X,{title:`Trạng thái: ${K(E.value.trang_thai)}`,type:O(E.value.trang_thai),closable:!1},null,8,["title","type"])])):(0,n.Q3)("",!0)]),_:1})])}}}),R=a(6262);const L=(0,R.A)(E,[["__scopeId","data-v-676e1ea6"]]);var Y=L},3028:function(e,t,a){var n=a(1114),r=a(1526);class l{constructor(){(0,n.A)(this,"BASE_URL","/projects")}async getAll(e){const t=await r.A.get(this.BASE_URL,{params:e});return t.data}async getById(e){const t=await r.A.get(`${this.BASE_URL}/${e}`);return t.data}async create(e){const t=await r.A.post(this.BASE_URL,e);return t.data}async update(e,t){const a=await r.A.put(`${this.BASE_URL}/${e}`,t);return a.data}async delete(e){await r.A.delete(`${this.BASE_URL}/${e}`)}}t.A=new l},4114:function(e,t,a){var n=a(6518),r=a(8981),l=a(6198),o=a(4527),s=a(6837),i=a(9039),u=i(function(){return 4294967297!==[].push.call({length:4294967296},1)}),c=function(){try{Object.defineProperty([],"length",{writable:!1}).push()}catch(e){return e instanceof TypeError}},d=u||!c();n({target:"Array",proto:!0,arity:1,forced:d},{push:function(e){var t=r(this),a=l(t),n=arguments.length;s(a+n);for(var i=0;i<n;i++)t[a]=arguments[i],a++;return o(t,a),a}})},4376:function(e,t,a){var n=a(2195);e.exports=Array.isArray||function(e){return"Array"===n(e)}},4527:function(e,t,a){var n=a(3724),r=a(4376),l=TypeError,o=Object.getOwnPropertyDescriptor,s=n&&!function(){if(void 0!==this)return!0;try{Object.defineProperty([],"length",{writable:!1}).length=1}catch(e){return e instanceof TypeError}}();e.exports=s?function(e,t){if(r(e)&&!o(e,"length").writable)throw new l("Cannot set read only .length");return e.length=t}:function(e,t){return e.length=t}},6837:function(e){var t=TypeError,a=9007199254740991;e.exports=function(e){if(e>a)throw t("Maximum allowed index exceeded");return e}},7588:function(e,t,a){var n=a(6518),r=a(9565),l=a(2652),o=a(9306),s=a(8551),i=a(1767),u=a(9539),c=a(4549),d=c("forEach",TypeError);n({target:"Iterator",proto:!0,real:!0,forced:d},{forEach:function(e){s(this);try{o(e)}catch(n){u(this,"throw",n)}if(d)return r(d,this,e);var t=i(this),a=0;l(t,function(t){e(t,a++)},{IS_RECORD:!0})}})},8237:function(e,t,a){var n=a(6518),r=a(2652),l=a(9306),o=a(8551),s=a(1767),i=a(9539),u=a(4549),c=a(8745),d=a(9039),h=TypeError,p=d(function(){[].keys().reduce(function(){},void 0)}),g=!p&&u("reduce",h);n({target:"Iterator",proto:!0,real:!0,forced:p||g},{reduce:function(e){o(this);try{l(e)}catch(d){i(this,"throw",d)}var t=arguments.length<2,a=t?void 0:arguments[1];if(g)return c(g,this,t?[e]:[e,a]);var n=s(this),u=0;if(r(n,function(n){t?(t=!1,a=n):a=e(a,n,u),u++},{IS_RECORD:!0}),t)throw new h("Reduce of empty iterator with no initial value");return a}})},8745:function(e,t,a){var n=a(616),r=Function.prototype,l=r.apply,o=r.call;e.exports="object"==typeof Reflect&&Reflect.apply||(n?o.bind(l):function(){return o.apply(l,arguments)})}}]);
//# sourceMappingURL=2257.85fdd536.js.map