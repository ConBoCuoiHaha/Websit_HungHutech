"use strict";(self["webpackChunkHungHutech"]=self["webpackChunkHungHutech"]||[]).push([[3137],{116:function(e,a,l){var t=l(6518),n=l(9565),o=l(2652),i=l(9306),u=l(8551),r=l(1767),c=l(9539),h=l(4549),s=h("find",TypeError);t({target:"Iterator",proto:!0,real:!0,forced:s},{find:function(e){u(this);try{i(e)}catch(t){c(this,"throw",t)}if(s)return n(s,this,e);var a=r(this),l=0;return o(a,function(a,t){if(e(a,l++))return t(a)},{IS_RECORD:!0,INTERRUPTED:!0}).result}})},1526:function(e,a,l){var t=l(1114),n=l(4335);const o=window?.appGlobal?.baseUrl&&`${window.appGlobal.baseUrl}/api`,i=o||"http://192.168.88.50:5000/api";console.log("API Base URL:",i);class u{constructor(){(0,t.A)(this,"axiosInstance",void 0),this.axiosInstance=n.A.create({baseURL:i,headers:{"Content-Type":"application/json"}}),this.axiosInstance.interceptors.request.use(e=>{const a=localStorage.getItem("token");return a&&(e.headers.Authorization=`Bearer ${a}`),e},e=>Promise.reject(e)),this.axiosInstance.interceptors.response.use(e=>e,e=>(401===e.response?.status&&(localStorage.removeItem("token"),localStorage.removeItem("user"),window.location.href="/login"),Promise.reject(e)))}get(e,a){return this.axiosInstance.get(e,a)}post(e,a,l){return this.axiosInstance.post(e,a,l)}put(e,a,l){return this.axiosInstance.put(e,a,l)}delete(e,a){return this.axiosInstance.delete(e,a)}patch(e,a,l){return this.axiosInstance.patch(e,a,l)}}a.A=new u},3137:function(e,a,l){l.r(a),l.d(a,{default:function(){return I}});l(4114),l(8111),l(116);var t=l(1431),n=l(5220),o=l(8548),i=l(163),u=l(3439);const r={class:"report-builder-page"},c={class:"page-header"},h={class:"page-title"},s={class:"page-actions"},d={class:"step-content"},_={class:"step-panel"},b={class:"step-panel"},p={class:"step-panel"},v={class:"filter-header"},g={key:0,class:"empty-state"},k={key:1,class:"criteria-list"},m={class:"criteria-content"},f={class:"step-panel"},y={class:"preview-section"},w={class:"preview-header"},F={key:0,class:"preview-table"},x={class:"preview-info"},C={key:1,class:"preview-loading"},L={key:2,class:"preview-empty"},E={class:"step-navigation"};var T=(0,t.pM)({__name:"ReportBuilder",setup(e){const a=(0,n.rd)(),l=(0,n.lq)(),T=(0,t.KR)(0),V=(0,t.KR)(!1),A=(0,t.KR)(!1),I=(0,t.KR)([]),N=(0,t.KR)(0),U=(0,t.EW)(()=>!!l.params.id),R=(0,t.Kh)({ten_bao_cao:"",loai_bao_cao:"Nhan vien",tieu_chi:[],cot_hien_thi:[],sap_xep:{truong:"",thu_tu:"asc"}}),W={"Nhan vien":[{label:"Mã nhân viên",value:"ma_nhan_vien"},{label:"Họ đệm",value:"ho_dem"},{label:"Tên",value:"ten"},{label:"Email",value:"lien_he.email_cong_viec"},{label:"Ngày sinh",value:"ngay_sinh"},{label:"Giới tính",value:"gioi_tinh"},{label:"Phòng ban",value:"thong_tin_cong_viec.phong_ban_id"},{label:"Chức danh",value:"thong_tin_cong_viec.chuc_danh_id"},{label:"Ngày vào làm",value:"thong_tin_cong_viec.ngay_vao_lam"},{label:"Trạng thái lao động",value:"thong_tin_cong_viec.trang_thai_lao_dong_id"}],"Cham cong":[{label:"Nhân viên",value:"nhan_vien_id"},{label:"Ngày",value:"ngay"},{label:"Thời gian vào",value:"thoi_gian_vao"},{label:"Thời gian ra",value:"thoi_gian_ra"},{label:"Ghi chú",value:"ghi_chu"}],"Nghi phep":[{label:"Nhân viên",value:"nhan_vien_id"},{label:"Loại ngày nghỉ",value:"loai_ngay_nghi_id"},{label:"Ngày bắt đầu",value:"ngay_bat_dau"},{label:"Ngày kết thúc",value:"ngay_ket_thuc"},{label:"Số ngày",value:"so_ngay"},{label:"Trạng thái",value:"trang_thai"},{label:"Lý do",value:"ly_do"}],"Boi hoan":[{label:"Nhân viên",value:"nhan_vien_id"},{label:"Trạng thái",value:"trang_thai"},{label:"Tổng tiền",value:"tong_tien"},{label:"Ngày tạo",value:"ngay_tao"}],Luong:[{label:"Nhân viên",value:"nhan_vien_id"},{label:"Tháng",value:"thang"},{label:"Lương cơ bản",value:"luong_co_ban"},{label:"Phụ cấp",value:"phu_cap"},{label:"Thưởng",value:"thuong"},{label:"Khấu trừ",value:"khau_tru"},{label:"Thực lãnh",value:"thuc_lanh"}],"Hieu suat":[{label:"Nhân viên",value:"nhan_vien_id"},{label:"Người đánh giá",value:"nguoi_danh_gia_id"},{label:"Từ ngày",value:"tu_ngay"},{label:"Đến ngày",value:"den_ngay"},{label:"Điểm tổng",value:"diem_tong"},{label:"Trạng thái",value:"trang_thai"}]},X=(0,t.EW)(()=>W[R.loai_bao_cao||"Nhan vien"]||[]),B=()=>{R.cot_hien_thi=[],R.tieu_chi=[],R.sap_xep={truong:"",thu_tu:"asc"},I.value=[],N.value=0},K=()=>{R.tieu_chi?.push({truong:"",dieu_kien:"=",gia_tri:""})},S=e=>{R.tieu_chi?.splice(e,1)},$=()=>{if(0===T.value){if(!R.ten_bao_cao)return void i.nk.warning("Vui lòng nhập tên báo cáo");if(!R.loai_bao_cao)return void i.nk.warning("Vui lòng chọn loại báo cáo")}1!==T.value||R.cot_hien_thi&&0!==R.cot_hien_thi.length?T.value<3&&T.value++:i.nk.warning("Vui lòng chọn ít nhất một cột để hiển thị")},G=()=>{T.value>0&&T.value--},H=async()=>{if(R.loai_bao_cao){A.value=!0;try{const e=await u.A.generate({loai_bao_cao:R.loai_bao_cao,tieu_chi:R.tieu_chi,cot_hien_thi:R.cot_hien_thi,sap_xep:R.sap_xep,page:1,limit:10});I.value=e.data,N.value=e.total,i.nk.success(`Tìm thấy ${e.total} bản ghi`)}catch(e){console.error("Error previewing report:",e),i.nk.error("Không thể tạo xem trước báo cáo")}finally{A.value=!1}}else i.nk.warning("Vui lòng chọn loại báo cáo")},P=async()=>{if(R.ten_bao_cao)if(R.loai_bao_cao){V.value=!0;try{U.value?(await u.A.update(l.params.id,R),i.nk.success("Cập nhật báo cáo thành công")):(await u.A.create(R),i.nk.success("Tạo báo cáo thành công")),a.push("/bao-cao")}catch(e){console.error("Error saving report:",e),i.nk.error(e.response?.data?.msg||"Không thể lưu báo cáo")}finally{V.value=!1}}else i.nk.warning("Vui lòng chọn loại báo cáo");else i.nk.warning("Vui lòng nhập tên báo cáo")},j=()=>{a.push("/bao-cao")},q=e=>{const a=X.value.find(a=>a.value===e);return a?a.label:e},O=e=>null===e||void 0===e?"-":"object"===typeof e?e.ten?e.ten:e.ten_chuc_danh?e.ten_chuc_danh:e.ho_dem&&e.ten?`${e.ho_dem} ${e.ten}`:JSON.stringify(e):"boolean"===typeof e?e?"Có":"Không":String(e);return(0,t.sV)(async()=>{if(U.value)try{const e=await u.A.getById(l.params.id);R.ten_bao_cao=e.ten_bao_cao,R.loai_bao_cao=e.loai_bao_cao,R.tieu_chi=e.tieu_chi||[],R.cot_hien_thi=e.cot_hien_thi||[],R.sap_xep=e.sap_xep||{truong:"",thu_tu:"asc"}}catch(e){console.error("Error loading report:",e),i.nk.error("Không thể tải báo cáo"),a.push("/bao-cao")}}),(e,a)=>{const l=(0,t.g2)("el-button"),n=(0,t.g2)("el-step"),i=(0,t.g2)("el-steps"),u=(0,t.g2)("el-input"),W=(0,t.g2)("el-form-item"),D=(0,t.g2)("el-option"),M=(0,t.g2)("el-select"),Q=(0,t.g2)("el-form"),z=(0,t.g2)("el-checkbox"),J=(0,t.g2)("el-checkbox-group"),Y=(0,t.g2)("el-col"),Z=(0,t.g2)("el-row"),ee=(0,t.g2)("el-card"),ae=(0,t.g2)("el-radio"),le=(0,t.g2)("el-radio-group"),te=(0,t.g2)("el-divider"),ne=(0,t.g2)("el-table-column"),oe=(0,t.g2)("el-table"),ie=(0,t.g2)("el-text");return(0,t.uX)(),(0,t.CE)("div",r,[(0,t.Lk)("div",c,[(0,t.Lk)("h1",h,(0,t.v_)(U.value?"Chỉnh sửa Báo cáo":"Tạo Báo cáo mới"),1),(0,t.Lk)("div",s,[(0,t.bF)(l,{onClick:j},{default:(0,t.k6)(()=>[...a[5]||(a[5]=[(0,t.eW)("Hủy",-1)])]),_:1}),(0,t.bF)(l,{type:"primary",loading:V.value,onClick:P},{default:(0,t.k6)(()=>[(0,t.eW)((0,t.v_)(U.value?"Cập nhật":"Lưu báo cáo"),1)]),_:1},8,["loading"])])]),(0,t.bF)(ee,{shadow:"never"},{default:(0,t.k6)(()=>[(0,t.bF)(i,{active:T.value,"finish-status":"success",class:"steps-container"},{default:(0,t.k6)(()=>[(0,t.bF)(n,{title:"Thông tin cơ bản"}),(0,t.bF)(n,{title:"Chọn cột hiển thị"}),(0,t.bF)(n,{title:"Thiết lập bộ lọc"}),(0,t.bF)(n,{title:"Sắp xếp & Xem trước"})]),_:1},8,["active"]),(0,t.Lk)("div",d,[(0,t.bo)((0,t.Lk)("div",_,[(0,t.bF)(Q,{model:R,"label-width":"150px","label-position":"left"},{default:(0,t.k6)(()=>[(0,t.bF)(W,{label:"Tên báo cáo",required:""},{default:(0,t.k6)(()=>[(0,t.bF)(u,{modelValue:R.ten_bao_cao,"onUpdate:modelValue":a[0]||(a[0]=e=>R.ten_bao_cao=e),placeholder:"Nhập tên báo cáo",maxlength:"100","show-word-limit":""},null,8,["modelValue"])]),_:1}),(0,t.bF)(W,{label:"Loại báo cáo",required:""},{default:(0,t.k6)(()=>[(0,t.bF)(M,{modelValue:R.loai_bao_cao,"onUpdate:modelValue":a[1]||(a[1]=e=>R.loai_bao_cao=e),placeholder:"Chọn loại báo cáo",style:{width:"100%"},onChange:B},{default:(0,t.k6)(()=>[(0,t.bF)(D,{label:"Nhân viên",value:"Nhan vien"}),(0,t.bF)(D,{label:"Chấm công",value:"Cham cong"}),(0,t.bF)(D,{label:"Nghỉ phép",value:"Nghi phep"}),(0,t.bF)(D,{label:"Bồi hoàn",value:"Boi hoan"}),(0,t.bF)(D,{label:"Lương",value:"Luong"}),(0,t.bF)(D,{label:"Hiệu suất",value:"Hieu suat"})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])],512),[[t.aG,0===T.value]]),(0,t.bo)((0,t.Lk)("div",b,[a[6]||(a[6]=(0,t.Lk)("h3",null,"Chọn các cột muốn hiển thị trong báo cáo",-1)),(0,t.bF)(J,{modelValue:R.cot_hien_thi,"onUpdate:modelValue":a[2]||(a[2]=e=>R.cot_hien_thi=e),class:"column-checkboxes"},{default:(0,t.k6)(()=>[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(X.value,e=>((0,t.uX)(),(0,t.Wv)(z,{key:e.value,label:e.value,border:""},{default:(0,t.k6)(()=>[(0,t.eW)((0,t.v_)(e.label),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])],512),[[t.aG,1===T.value]]),(0,t.bo)((0,t.Lk)("div",p,[(0,t.Lk)("div",v,[a[8]||(a[8]=(0,t.Lk)("h3",null,"Thiết lập bộ lọc",-1)),(0,t.bF)(l,{type:"primary",icon:(0,t.R1)(o.Plus),onClick:K},{default:(0,t.k6)(()=>[...a[7]||(a[7]=[(0,t.eW)(" Thêm tiêu chí ",-1)])]),_:1},8,["icon"])]),0===R.tieu_chi.length?((0,t.uX)(),(0,t.CE)("div",g,[...a[9]||(a[9]=[(0,t.Lk)("p",null,'Chưa có tiêu chí lọc nào. Nhấn "Thêm tiêu chí" để bắt đầu.',-1)])])):((0,t.uX)(),(0,t.CE)("div",k,[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(R.tieu_chi,(e,a)=>((0,t.uX)(),(0,t.Wv)(ee,{key:a,class:"criteria-card",shadow:"hover"},{default:(0,t.k6)(()=>[(0,t.Lk)("div",m,[(0,t.bF)(Z,{gutter:16},{default:(0,t.k6)(()=>[(0,t.bF)(Y,{span:7},{default:(0,t.k6)(()=>[(0,t.bF)(M,{modelValue:e.truong,"onUpdate:modelValue":a=>e.truong=a,placeholder:"Chọn trường",style:{width:"100%"}},{default:(0,t.k6)(()=>[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(X.value,e=>((0,t.uX)(),(0,t.Wv)(D,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onUpdate:modelValue"])]),_:2},1024),(0,t.bF)(Y,{span:5},{default:(0,t.k6)(()=>[(0,t.bF)(M,{modelValue:e.dieu_kien,"onUpdate:modelValue":a=>e.dieu_kien=a,placeholder:"Điều kiện",style:{width:"100%"}},{default:(0,t.k6)(()=>[(0,t.bF)(D,{label:"Bằng (=)",value:"="}),(0,t.bF)(D,{label:"Khác (!=)",value:"!="}),(0,t.bF)(D,{label:"Lớn hơn (>)",value:">"}),(0,t.bF)(D,{label:"Nhỏ hơn (<)",value:"<"}),(0,t.bF)(D,{label:"Lớn hơn hoặc bằng (>=)",value:">="}),(0,t.bF)(D,{label:"Nhỏ hơn hoặc bằng (<=)",value:"<="}),(0,t.bF)(D,{label:"Chứa (LIKE)",value:"LIKE"}),(0,t.bF)(D,{label:"Trong (IN)",value:"IN"})]),_:1},8,["modelValue","onUpdate:modelValue"])]),_:2},1024),(0,t.bF)(Y,{span:10},{default:(0,t.k6)(()=>[(0,t.bF)(u,{modelValue:e.gia_tri,"onUpdate:modelValue":a=>e.gia_tri=a,placeholder:"Giá trị"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),(0,t.bF)(Y,{span:2},{default:(0,t.k6)(()=>[(0,t.bF)(l,{type:"danger",icon:(0,t.R1)(o.Delete),circle:"",onClick:e=>S(a)},null,8,["icon","onClick"])]),_:2},1024)]),_:2},1024)])]),_:2},1024))),128))]))],512),[[t.aG,2===T.value]]),(0,t.bo)((0,t.Lk)("div",f,[a[16]||(a[16]=(0,t.Lk)("h3",null,"Thiết lập sắp xếp",-1)),(0,t.bF)(Q,{model:R,"label-width":"150px","label-position":"left"},{default:(0,t.k6)(()=>[(0,t.bF)(W,{label:"Sắp xếp theo"},{default:(0,t.k6)(()=>[(0,t.bF)(M,{modelValue:R.sap_xep.truong,"onUpdate:modelValue":a[3]||(a[3]=e=>R.sap_xep.truong=e),placeholder:"Chọn trường sắp xếp",clearable:"",style:{width:"100%"}},{default:(0,t.k6)(()=>[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(X.value,e=>((0,t.uX)(),(0,t.Wv)(D,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),(0,t.bF)(W,{label:"Thứ tự"},{default:(0,t.k6)(()=>[(0,t.bF)(le,{modelValue:R.sap_xep.thu_tu,"onUpdate:modelValue":a[4]||(a[4]=e=>R.sap_xep.thu_tu=e)},{default:(0,t.k6)(()=>[(0,t.bF)(ae,{label:"asc"},{default:(0,t.k6)(()=>[...a[10]||(a[10]=[(0,t.eW)("Tăng dần",-1)])]),_:1}),(0,t.bF)(ae,{label:"desc"},{default:(0,t.k6)(()=>[...a[11]||(a[11]=[(0,t.eW)("Giảm dần",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"]),(0,t.bF)(te),(0,t.Lk)("div",y,[(0,t.Lk)("div",w,[a[13]||(a[13]=(0,t.Lk)("h3",null,"Xem trước kết quả",-1)),(0,t.bF)(l,{type:"primary",loading:A.value,onClick:H},{default:(0,t.k6)(()=>[...a[12]||(a[12]=[(0,t.eW)(" Tạo xem trước ",-1)])]),_:1},8,["loading"])]),I.value.length>0?((0,t.uX)(),(0,t.CE)("div",F,[(0,t.bF)(oe,{data:I.value,stripe:"",border:"","max-height":"400"},{default:(0,t.k6)(()=>[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(R.cot_hien_thi,e=>((0,t.uX)(),(0,t.Wv)(ne,{key:e,prop:e,label:q(e),"min-width":"120"},{default:(0,t.k6)(({row:a})=>[(0,t.eW)((0,t.v_)(O(a[e])),1)]),_:2},1032,["prop","label"]))),128))]),_:1},8,["data"]),(0,t.Lk)("div",x,[(0,t.bF)(ie,{type:"info"},{default:(0,t.k6)(()=>[(0,t.eW)(" Hiển thị "+(0,t.v_)(I.value.length)+" / "+(0,t.v_)(N.value)+" bản ghi ",1)]),_:1})])])):A.value?((0,t.uX)(),(0,t.CE)("div",C,[(0,t.bF)(ie,null,{default:(0,t.k6)(()=>[...a[14]||(a[14]=[(0,t.eW)("Đang tải dữ liệu...",-1)])]),_:1})])):((0,t.uX)(),(0,t.CE)("div",L,[(0,t.bF)(ie,{type:"info"},{default:(0,t.k6)(()=>[...a[15]||(a[15]=[(0,t.eW)('Nhấn "Tạo xem trước" để xem kết quả',-1)])]),_:1})]))])],512),[[t.aG,3===T.value]])]),(0,t.Lk)("div",E,[T.value>0?((0,t.uX)(),(0,t.Wv)(l,{key:0,onClick:G},{default:(0,t.k6)(()=>[...a[17]||(a[17]=[(0,t.eW)(" Quay lại ",-1)])]),_:1})):(0,t.Q3)("",!0),T.value<3?((0,t.uX)(),(0,t.Wv)(l,{key:1,type:"primary",onClick:$},{default:(0,t.k6)(()=>[...a[18]||(a[18]=[(0,t.eW)(" Tiếp theo ",-1)])]),_:1})):(0,t.Q3)("",!0)])]),_:1})])}}}),V=l(6262);const A=(0,V.A)(T,[["__scopeId","data-v-e40d300c"]]);var I=A},3439:function(e,a,l){var t=l(1114),n=l(1526);class o{constructor(){(0,t.A)(this,"BASE_URL","/reports")}async getAll(e){const a=await n.A.get(this.BASE_URL,{params:e});return a.data}async getById(e){const a=await n.A.get(`${this.BASE_URL}/${e}`);return a.data}async create(e){const a=await n.A.post(this.BASE_URL,e);return a.data}async update(e,a){const l=await n.A.put(`${this.BASE_URL}/${e}`,a);return l.data}async delete(e){await n.A.delete(`${this.BASE_URL}/${e}`)}async generate(e){const a=await n.A.post(`${this.BASE_URL}/generate`,e);return a.data}getExportUrl(e){const a=localStorage.getItem("token");return`http://localhost:5000/api${this.BASE_URL}/export/${e}?token=${a}`}downloadExport(e){const a=this.getExportUrl(e),l=document.createElement("a");l.href=a,l.download=`report-${e}.csv`,document.body.appendChild(l),l.click(),document.body.removeChild(l)}}a.A=new o},4114:function(e,a,l){var t=l(6518),n=l(8981),o=l(6198),i=l(4527),u=l(6837),r=l(9039),c=r(function(){return 4294967297!==[].push.call({length:4294967296},1)}),h=function(){try{Object.defineProperty([],"length",{writable:!1}).push()}catch(e){return e instanceof TypeError}},s=c||!h();t({target:"Array",proto:!0,arity:1,forced:s},{push:function(e){var a=n(this),l=o(a),t=arguments.length;u(l+t);for(var r=0;r<t;r++)a[l]=arguments[r],l++;return i(a,l),l}})},4376:function(e,a,l){var t=l(2195);e.exports=Array.isArray||function(e){return"Array"===t(e)}},4527:function(e,a,l){var t=l(3724),n=l(4376),o=TypeError,i=Object.getOwnPropertyDescriptor,u=t&&!function(){if(void 0!==this)return!0;try{Object.defineProperty([],"length",{writable:!1}).length=1}catch(e){return e instanceof TypeError}}();e.exports=u?function(e,a){if(n(e)&&!i(e,"length").writable)throw new o("Cannot set read only .length");return e.length=a}:function(e,a){return e.length=a}},6837:function(e){var a=TypeError,l=9007199254740991;e.exports=function(e){if(e>l)throw a("Maximum allowed index exceeded");return e}}}]);
//# sourceMappingURL=3137.39474ae0.js.map