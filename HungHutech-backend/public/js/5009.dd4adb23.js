"use strict";(self["webpackChunkHungHutech"]=self["webpackChunkHungHutech"]||[]).push([[5009],{1114:function(e,a,t){function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function l(e,a){if("object"!=n(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var l=t.call(e,a||"default");if("object"!=n(l))return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===a?String:Number)(e)}function i(e){var a=l(e,"string");return"symbol"==n(a)?a:a+""}function o(e,a,t){return(a=i(a))in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}t.d(a,{A:function(){return o}})},1526:function(e,a,t){var n=t(1114),l=t(4335);const i=window?.appGlobal?.baseUrl&&`${window.appGlobal.baseUrl}/api`,o=i||"http://192.168.88.50:5000/api";console.log("API Base URL:",o);class r{constructor(){(0,n.A)(this,"axiosInstance",void 0),this.axiosInstance=l.A.create({baseURL:o,headers:{"Content-Type":"application/json"}}),this.axiosInstance.interceptors.request.use(e=>{const a=localStorage.getItem("token");return a&&(e.headers.Authorization=`Bearer ${a}`),e},e=>Promise.reject(e)),this.axiosInstance.interceptors.response.use(e=>e,e=>(401===e.response?.status&&(localStorage.removeItem("token"),localStorage.removeItem("user"),window.location.href="/login"),Promise.reject(e)))}get(e,a){return this.axiosInstance.get(e,a)}post(e,a,t){return this.axiosInstance.post(e,a,t)}put(e,a,t){return this.axiosInstance.put(e,a,t)}delete(e,a){return this.axiosInstance.delete(e,a)}patch(e,a,t){return this.axiosInstance.patch(e,a,t)}}a.A=new r},5009:function(e,a,t){t.r(a),t.d(a,{default:function(){return L}});var n=t(1431),l=t(4353),i=t.n(l),o=t(163),r=t(7918),s=t(8548),u=t(9088),c=t(6604),d=t(5916);const h={class:"time-rule-page"},_={class:"page-header"},g={class:"page-actions"},p={class:"violation-card__header"},v={class:"table-header"},b={class:"employee-cell"},m={class:"shift-cell"},f={class:"time-pair"},k={class:"table-pagination"};var y=(0,n.pM)({__name:"TimeRuleEngine",setup(e){const a=(0,n.KR)([]),t=(0,n.KR)([]),l=(0,n.KR)([]),y=(0,n.KR)([]),w=(0,n.KR)(!1),A=(0,n.KR)(!1),L=(0,n.Kh)({page:1,limit:20,total:0}),F=(0,n.Kh)({dates:[i()().startOf("month").format("YYYY-MM-DD"),i()().format("YYYY-MM-DD")],trang_thai:"",nhan_vien_id:"",phong_ban_id:""}),R=[{label:"Tất cả",value:""},{label:"Đúng giờ",value:"OnTime"},{label:"Đi trễ",value:"Late"},{label:"Về sớm",value:"EarlyOut"},{label:"Đi trễ & Về sớm",value:"LateEarly"},{label:"Nghỉ phép",value:"Leave"},{label:"Vắng mặt",value:"Absent"},{label:"Thiếu check-in",value:"MissingCheckin"},{label:"Thiếu check-out",value:"MissingCheckout"}],S=e=>{const a=R.find(a=>a.value===e);return a?.label||e||"---"},Y=e=>{switch(e){case"OnTime":return"success";case"Leave":return"info";case"Late":case"LateEarly":return"warning";case"EarlyOut":return"warning";case"MissingCheckin":case"MissingCheckout":case"Absent":return"danger";default:return"info"}},E=(0,n.EW)(()=>y.value.slice(0,4)),$=(0,n.EW)(()=>{if(!a.value.length)return"---";const e=a.value[0].ngay_cap_nhat||a.value[0].ngay;return e?i()(e).format("DD/MM/YYYY HH:mm"):"---"}),U=e=>e?i()(e).format("DD/MM/YYYY"):"--",x=e=>e?i()(e).format("HH:mm"):"--:--",B=e=>e?e>=60?`${(e/60).toFixed(1)} giờ`:`${e} phút`:"0 phút",M=e=>e?`${e.toFixed(2)}h`:"0h",C=()=>{const[e,a]=F.dates||[];return{page:L.page,limit:L.limit,from:e,to:a,trang_thai:F.trang_thai||void 0,nhan_vien_id:F.nhan_vien_id||void 0,phong_ban_id:F.phong_ban_id||void 0}},I=async()=>{w.value=!0;try{const e=await u.A.getDailySummaries(C());a.value=e.data||[],L.total=e.pagination.total}catch(e){console.error("loadSummaries error",e),o.nk.error(e.response?.data?.msg||"Không thể tải dữ liệu rule engine")}finally{w.value=!1}},V=async()=>{try{const[e,a]=F.dates||[];y.value=await u.A.getViolations({from:e,to:a})}catch(e){console.error("loadViolations error",e)}},D=async()=>{try{const e=await c.A.getAll({limit:200,page:1});t.value=e.data||[]}catch(e){t.value=[]}},T=async()=>{try{const e=await d.A.getAll({limit:200});l.value=e.items||e.data||[]}catch{l.value=[]}},K=()=>{L.page=1,I(),V()},W=()=>{F.dates=[i()().startOf("month").format("YYYY-MM-DD"),i()().format("YYYY-MM-DD")],F.trang_thai="",F.nhan_vien_id="",F.phong_ban_id="",K()},X=e=>{L.page=e,I()},O=()=>{I(),V()},j=async()=>{const[e,a]=F.dates||[];if(e){try{await r.s.confirm("Rule engine sẽ tái tính dữ liệu trong khoảng đã chọn. Bạn chắc chắn tiếp tục?","Xác nhận",{type:"warning"})}catch{return}A.value=!0;try{await u.A.recalculate({from_date:e,to_date:a,nhan_vien_ids:F.nhan_vien_id?[F.nhan_vien_id]:void 0,phong_ban_id:F.phong_ban_id||void 0}),o.nk.success("Đã gửi yêu cầu tính lại"),O()}catch(t){console.error("handleRecalculate error",t),o.nk.error(t.response?.data?.msg||"Không thể tính lại rule engine")}finally{A.value=!1}}else o.nk.warning("Vui lòng chọn khoảng thời gian trước khi tính lại")};return(0,n.sV)(()=>{D(),T(),O()}),(e,i)=>{const o=(0,n.g2)("el-button"),r=(0,n.g2)("el-date-picker"),u=(0,n.g2)("el-form-item"),c=(0,n.g2)("el-col"),d=(0,n.g2)("el-option"),y=(0,n.g2)("el-select"),C=(0,n.g2)("el-row"),I=(0,n.g2)("el-space"),V=(0,n.g2)("el-form"),D=(0,n.g2)("el-card"),T=(0,n.g2)("el-tag"),H=(0,n.g2)("el-table-column"),P=(0,n.g2)("el-table"),N=(0,n.g2)("el-pagination"),z=(0,n.gN)("loading");return(0,n.uX)(),(0,n.CE)("div",h,[(0,n.Lk)("div",_,[i[6]||(i[6]=(0,n.Lk)("div",null,[(0,n.Lk)("h2",null,"Rule Engine Time/Leave/OT"),(0,n.Lk)("p",null," Theo dõi trạng thái chấm công - nghỉ phép - tăng ca theo ca làm việc, tự động cảnh báo khi sai phạm. ")],-1)),(0,n.Lk)("div",g,[(0,n.bF)(o,{icon:(0,n.R1)(s.Refresh),onClick:O},{default:(0,n.k6)(()=>[...i[4]||(i[4]=[(0,n.eW)("Tải lại",-1)])]),_:1},8,["icon"]),(0,n.bF)(o,{type:"primary",loading:A.value,icon:(0,n.R1)(s.DataAnalysis),onClick:j},{default:(0,n.k6)(()=>[...i[5]||(i[5]=[(0,n.eW)(" Tính lại ",-1)])]),_:1},8,["loading","icon"])])]),(0,n.bF)(D,{shadow:"never"},{default:(0,n.k6)(()=>[(0,n.bF)(V,{model:F,"label-width":"140px","label-position":"left",class:"filter-form"},{default:(0,n.k6)(()=>[(0,n.bF)(C,{gutter:20},{default:(0,n.k6)(()=>[(0,n.bF)(c,{md:12,xs:24},{default:(0,n.k6)(()=>[(0,n.bF)(u,{label:"Khoảng thời gian"},{default:(0,n.k6)(()=>[(0,n.bF)(r,{modelValue:F.dates,"onUpdate:modelValue":i[0]||(i[0]=e=>F.dates=e),type:"daterange","unlink-panels":"","start-placeholder":"Từ ngày","end-placeholder":"Đến ngày","value-format":"YYYY-MM-DD",format:"DD/MM/YYYY",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),(0,n.bF)(c,{md:6,xs:24},{default:(0,n.k6)(()=>[(0,n.bF)(u,{label:"Nhân viên"},{default:(0,n.k6)(()=>[(0,n.bF)(y,{modelValue:F.nhan_vien_id,"onUpdate:modelValue":i[1]||(i[1]=e=>F.nhan_vien_id=e),filterable:"",clearable:"",placeholder:"Chọn nhân viên"},{default:(0,n.k6)(()=>[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(t.value,e=>((0,n.uX)(),(0,n.Wv)(d,{key:e._id,label:`${e.ma_nhan_vien} - ${e.ho_dem||""} ${e.ten||""}`,value:e._id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),(0,n.bF)(c,{md:6,xs:24},{default:(0,n.k6)(()=>[(0,n.bF)(u,{label:"Phòng ban"},{default:(0,n.k6)(()=>[(0,n.bF)(y,{modelValue:F.phong_ban_id,"onUpdate:modelValue":i[2]||(i[2]=e=>F.phong_ban_id=e),clearable:"",placeholder:"Tất cả"},{default:(0,n.k6)(()=>[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(l.value,e=>((0,n.uX)(),(0,n.Wv)(d,{key:e._id,label:e.ten,value:e._id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),(0,n.bF)(C,{gutter:20},{default:(0,n.k6)(()=>[(0,n.bF)(c,{md:6,xs:24},{default:(0,n.k6)(()=>[(0,n.bF)(u,{label:"Trạng thái"},{default:(0,n.k6)(()=>[(0,n.bF)(y,{modelValue:F.trang_thai,"onUpdate:modelValue":i[3]||(i[3]=e=>F.trang_thai=e),placeholder:"Tất cả",clearable:""},{default:(0,n.k6)(()=>[((0,n.uX)(),(0,n.CE)(n.FK,null,(0,n.pI)(R,e=>(0,n.bF)(d,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1})]),_:1}),(0,n.bF)(c,{md:6,xs:24},{default:(0,n.k6)(()=>[(0,n.bF)(u,{label:" "},{default:(0,n.k6)(()=>[(0,n.bF)(I,null,{default:(0,n.k6)(()=>[(0,n.bF)(o,{type:"primary",icon:(0,n.R1)(s.Search),onClick:K},{default:(0,n.k6)(()=>[...i[7]||(i[7]=[(0,n.eW)(" Lọc ",-1)])]),_:1},8,["icon"]),(0,n.bF)(o,{onClick:W},{default:(0,n.k6)(()=>[...i[8]||(i[8]=[(0,n.eW)("Xóa lọc",-1)])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),(0,n.bF)(C,{gutter:20,class:"violation-cards"},{default:(0,n.k6)(()=>[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(E.value,e=>((0,n.uX)(),(0,n.Wv)(c,{key:e.status,xs:24,sm:12,md:6},{default:(0,n.k6)(()=>[(0,n.bF)(D,{class:"violation-card",shadow:"hover"},{default:(0,n.k6)(()=>[(0,n.Lk)("div",p,[(0,n.Lk)("span",null,(0,n.v_)(S(e.status)),1),(0,n.bF)(T,{type:Y(e.status),effect:"dark"},{default:(0,n.k6)(()=>[(0,n.eW)((0,n.v_)((e.count/(L.total||1)*100).toFixed(1))+"% ",1)]),_:2},1032,["type"])]),(0,n.Lk)("p",null,(0,n.v_)(e.count)+" bản ghi",1)]),_:2},1024)]),_:2},1024))),128))]),_:1}),(0,n.bF)(D,{shadow:"never"},{default:(0,n.k6)(()=>[(0,n.Lk)("div",v,[(0,n.Lk)("div",null,[i[9]||(i[9]=(0,n.Lk)("h3",null,"Kết quả rule engine",-1)),(0,n.Lk)("p",null,(0,n.v_)(L.total)+" dòng - cập nhật lần cuối: "+(0,n.v_)($.value),1)])]),(0,n.bo)(((0,n.uX)(),(0,n.Wv)(P,{data:a.value,"empty-text":w.value?"Đang tải...":"Không có dữ liệu"},{default:(0,n.k6)(()=>[(0,n.bF)(H,{label:"Ngày",width:"130"},{default:(0,n.k6)(({row:e})=>[(0,n.eW)((0,n.v_)(U(e.ngay)),1)]),_:1}),(0,n.bF)(H,{label:"Nhân viên","min-width":"200"},{default:(0,n.k6)(({row:e})=>[(0,n.Lk)("div",b,[(0,n.Lk)("strong",null,(0,n.v_)("object"===typeof e.nhan_vien_id?`${e.nhan_vien_id?.ho_dem||""} ${e.nhan_vien_id?.ten||""}`:e.nhan_vien_id),1),(0,n.Lk)("span",null,(0,n.v_)("object"===typeof e.nhan_vien_id?e.nhan_vien_id?.ma_nhan_vien:""),1)])]),_:1}),(0,n.bF)(H,{label:"Ca","min-width":"160"},{default:(0,n.k6)(({row:e})=>[(0,n.Lk)("div",m,[(0,n.eW)((0,n.v_)(e.shift_snapshot?.ten_ca||"---")+" ",1),(0,n.Lk)("small",null,(0,n.v_)(e.shift_snapshot?.gio_bat_dau||"--:--")+" - "+(0,n.v_)(e.shift_snapshot?.gio_ket_thuc||"--:--"),1)])]),_:1}),(0,n.bF)(H,{label:"Check-in/out","min-width":"180"},{default:(0,n.k6)(({row:e})=>[(0,n.Lk)("div",f,[(0,n.Lk)("span",null,(0,n.v_)(x(e.check_in)),1),(0,n.Lk)("span",null,(0,n.v_)(x(e.check_out)),1)])]),_:1}),(0,n.bF)(H,{label:"Làm việc",width:"110",prop:"work_minutes"},{default:(0,n.k6)(({row:e})=>[(0,n.eW)((0,n.v_)(B(e.work_minutes)),1)]),_:1}),(0,n.bF)(H,{label:"OT",width:"90",prop:"ot_hours"},{default:(0,n.k6)(({row:e})=>[(0,n.eW)((0,n.v_)(M(e.ot_hours)),1)]),_:1}),(0,n.bF)(H,{label:"Trạng thái",width:"150"},{default:(0,n.k6)(({row:e})=>[(0,n.bF)(T,{type:Y(e.status)},{default:(0,n.k6)(()=>[(0,n.eW)((0,n.v_)(S(e.status)),1)]),_:2},1032,["type"])]),_:1}),(0,n.bF)(H,{prop:"notes",label:"Ghi chú","min-width":"250"})]),_:1},8,["data","empty-text"])),[[z,w.value]]),(0,n.Lk)("div",k,[(0,n.bF)(N,{background:"",layout:"total, prev, pager, next",total:L.total,"current-page":L.page,"page-size":L.limit,onCurrentChange:X},null,8,["total","current-page","page-size"])])]),_:1})])}}}),w=t(6262);const A=(0,w.A)(y,[["__scopeId","data-v-5442ff73"]]);var L=A},5916:function(e,a,t){var n=t(1114),l=t(1526);class i{constructor(){(0,n.A)(this,"BASE_URL","/phongban")}async getAll(e){const a=await l.A.get(this.BASE_URL,{params:e});return a.data}async getById(e){const a=await l.A.get(`${this.BASE_URL}/${e}`);return a.data}async create(e){const a=await l.A.post(this.BASE_URL,e);return a.data}async update(e,a){const t=await l.A.put(`${this.BASE_URL}/${e}`,a);return t.data}async delete(e){await l.A.delete(`${this.BASE_URL}/${e}`)}}a.A=new i},6262:function(e,a){a.A=(e,a)=>{const t=e.__vccOpts||e;for(const[n,l]of a)t[n]=l;return t}},6604:function(e,a,t){var n=t(1114),l=t(1526);class i{constructor(){(0,n.A)(this,"BASE_URL","/nhanvien")}async getAll(e){const a=await l.A.get(this.BASE_URL,{params:e});return a.data}async getById(e){const a=await l.A.get(`${this.BASE_URL}/${e}`);return a.data}async create(e){const a=await l.A.post(this.BASE_URL,e);return a.data}async update(e,a){const t=await l.A.put(`${this.BASE_URL}/${e}`,a);return t.data}async delete(e){await l.A.delete(`${this.BASE_URL}/${e}`)}}a.A=new i},9088:function(e,a,t){var n=t(1114),l=t(1526);class i{constructor(){(0,n.A)(this,"BASE_URL","/time-rules")}async getDailySummaries(e){const a=await l.A.get(`${this.BASE_URL}/daily`,{params:e});return a.data}async getMySummaries(e){const a=await l.A.get(`${this.BASE_URL}/my`,{params:e});return a.data}async recalculate(e){await l.A.post(`${this.BASE_URL}/recalculate`,e)}async getViolations(e){const a=await l.A.get(`${this.BASE_URL}/violations`,{params:e});return a.data.data||[]}}a.A=new i}}]);
//# sourceMappingURL=5009.dd4adb23.js.map