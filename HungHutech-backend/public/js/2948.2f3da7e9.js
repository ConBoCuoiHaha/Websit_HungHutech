"use strict";(self["webpackChunkHungHutech"]=self["webpackChunkHungHutech"]||[]).push([[2948],{1114:function(e,t,a){function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function l(e,t){if("object"!=n(e)||!e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var l=a.call(e,t||"default");if("object"!=n(l))return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function i(e){var t=l(e,"string");return"symbol"==n(t)?t:t+""}function r(e,t,a){return(t=i(t))in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}a.d(t,{A:function(){return r}})},1526:function(e,t,a){var n=a(1114),l=a(4335);const i=window?.appGlobal?.baseUrl&&`${window.appGlobal.baseUrl}/api`,r=i||"http://192.168.88.50:5000/api";console.log("API Base URL:",r);class o{constructor(){(0,n.A)(this,"axiosInstance",void 0),this.axiosInstance=l.A.create({baseURL:r,headers:{"Content-Type":"application/json"}}),this.axiosInstance.interceptors.request.use(e=>{const t=localStorage.getItem("token");return t&&(e.headers.Authorization=`Bearer ${t}`),e},e=>Promise.reject(e)),this.axiosInstance.interceptors.response.use(e=>e,e=>(401===e.response?.status&&(localStorage.removeItem("token"),localStorage.removeItem("user"),window.location.href="/login"),Promise.reject(e)))}get(e,t){return this.axiosInstance.get(e,t)}post(e,t,a){return this.axiosInstance.post(e,t,a)}put(e,t,a){return this.axiosInstance.put(e,t,a)}delete(e,t){return this.axiosInstance.delete(e,t)}patch(e,t,a){return this.axiosInstance.patch(e,t,a)}}t.A=new o},2435:function(e,t,a){var n=a(1114),l=a(1526);class i{constructor(){(0,n.A)(this,"BASE_URL","/claims")}async getAll(e){const t=await l.A.get(this.BASE_URL,{params:e});return t.data}async getById(e){const t=await l.A.get(`${this.BASE_URL}/${e}`);return t.data}async getByNhanVienId(e,t){const a=await l.A.get(this.BASE_URL,{params:{...t,nhan_vien_id:e}});return a.data}async create(e){const t=await l.A.post(this.BASE_URL,e);return t.data}async update(e,t){const a=await l.A.put(`${this.BASE_URL}/${e}`,t);return a.data}async updateStatus(e,t,a){const n=await l.A.put(`${this.BASE_URL}/${e}`,{trang_thai:t,ghi_chu:a});return n.data}async delete(e){await l.A.delete(`${this.BASE_URL}/${e}`)}}t.A=new i},2948:function(e,t,a){a.r(t),a.d(t,{default:function(){return k}});var n=a(1431),l=a(8548),i=a(163),r=a(7918),o=a(2435),u=a(6604);const c={class:"orangehrm-claim-approval-page"},s={class:"orangehrm-page-header"},d={key:0},h={class:"orangehrm-text-muted"},g={class:"orangehrm-amount"},_={class:"orangehrm-pagination"},p={key:0,class:"orangehrm-claim-details"},v={key:0},b={class:"orangehrm-amount"};var m=(0,n.pM)({__name:"ClaimApproval",setup(e){const t=(0,n.KR)([]),a=(0,n.KR)([]),m=(0,n.KR)(!1),y=(0,n.KR)(""),f=(0,n.KR)(!1),k=(0,n.KR)(!1),w=(0,n.KR)(!1),F=(0,n.KR)(null),A=(0,n.KR)(""),S=(0,n.Kh)({pending:0,approved:0,rejected:0}),R=(0,n.Kh)({currentPage:1,limit:10,total:0}),C=(0,n.Kh)({trang_thai:"Submitted",nhan_vien_id:""}),x=async()=>{m.value=!0,y.value="";try{const e={page:R.currentPage,limit:R.limit};C.trang_thai&&(e.trang_thai=C.trang_thai),C.nhan_vien_id&&(e.nhan_vien_id=C.nhan_vien_id);const a=await o.A.getAll(e);t.value=a.data||[],R.total=a.pagination?.total||0,await W()}catch(e){console.error("Error loading claims:",e),y.value=e.response?.data?.msg||"Không thể tải danh sách bồi hoàn",i.nk.error(y.value)}finally{m.value=!1}},W=async()=>{try{const[e,t,a]=await Promise.all([o.A.getAll({limit:1,trang_thai:"Submitted"}),o.A.getAll({limit:1,trang_thai:"Approved"}),o.A.getAll({limit:1,trang_thai:"Rejected"})]);S.pending=e.pagination?.total||0,S.approved=t.pagination?.total||0,S.rejected=a.pagination?.total||0}catch(e){console.error("Error loading stats:",e)}},L=async()=>{try{const e=await u.A.getAll({limit:1e3});a.value=e.data||[]}catch(e){console.error("Error loading employees:",e)}},B=()=>{R.currentPage=1,x()},E=e=>{R.currentPage=e,x()},U=e=>{R.limit=e,R.currentPage=1,x()},P=e=>{F.value=e,k.value=!0},V=async e=>{try{await r.s.confirm(`Bạn có chắc chắn muốn phê duyệt yêu cầu bồi hoàn này với số tiền ${N(e.tong_tien)}?`,"Xác nhận phê duyệt",{confirmButtonText:"Phê duyệt",cancelButtonText:"Hủy",type:"success"}),await o.A.updateStatus(e._id,"Approved"),i.nk.success("Phê duyệt yêu cầu bồi hoàn thành công"),await x()}catch(t){"cancel"!==t&&(console.error("Error approving claim:",t),i.nk.error(t.response?.data?.msg||"Không thể phê duyệt yêu cầu"))}},$=async()=>{F.value&&(await V(F.value),k.value=!1)},T=e=>{F.value=e,A.value="",w.value=!0},I=()=>{k.value=!1,F.value&&(A.value="",w.value=!0)},j=async()=>{if(A.value.trim()){if(F.value){f.value=!0;try{await o.A.updateStatus(F.value._id,"Rejected",A.value),i.nk.success("Từ chối yêu cầu bồi hoàn thành công"),w.value=!1,await x()}catch(e){console.error("Error rejecting claim:",e),i.nk.error(e.response?.data?.msg||"Không thể từ chối yêu cầu")}finally{f.value=!1}}}else i.nk.warning("Vui lòng nhập lý do từ chối")},K=e=>{if(!e)return"-";const t=new Date(e);return t.toLocaleDateString("vi-VN")},N=e=>new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND"}).format(e),X=e=>{const t={Submitted:"warning",Approved:"success",Rejected:"danger",Paid:"info"};return t[e]||"info"},z=e=>{const t={Submitted:"Đã nộp",Approved:"Đã duyệt",Rejected:"Bị từ chối",Paid:"Đã thanh toán"};return t[e]||e};return(0,n.sV)(()=>{x(),L()}),(e,i)=>{const r=(0,n.g2)("el-button"),o=(0,n.g2)("el-statistic"),u=(0,n.g2)("el-card"),W=(0,n.g2)("el-col"),L=(0,n.g2)("el-row"),H=(0,n.g2)("el-option"),D=(0,n.g2)("el-select"),Q=(0,n.g2)("el-form-item"),q=(0,n.g2)("el-form"),G=(0,n.g2)("el-table-column"),M=(0,n.g2)("el-tag"),O=(0,n.g2)("el-space"),J=(0,n.g2)("el-table"),Y=(0,n.g2)("el-pagination"),Z=(0,n.g2)("el-descriptions-item"),ee=(0,n.g2)("el-descriptions"),te=(0,n.g2)("el-divider"),ae=(0,n.g2)("el-dialog"),ne=(0,n.g2)("el-input"),le=(0,n.gN)("loading");return(0,n.uX)(),(0,n.CE)("div",c,[(0,n.Lk)("div",s,[i[10]||(i[10]=(0,n.Lk)("h1",{class:"orangehrm-page-title"},"Phê duyệt bồi hoàn chi phí",-1)),(0,n.bF)(r,{icon:(0,n.R1)(l.Refresh),onClick:x},{default:(0,n.k6)(()=>[...i[9]||(i[9]=[(0,n.eW)("Tải lại",-1)])]),_:1},8,["icon"])]),(0,n.bF)(L,{gutter:20,class:"orangehrm-stats-row"},{default:(0,n.k6)(()=>[(0,n.bF)(W,{xs:24,sm:8},{default:(0,n.k6)(()=>[(0,n.bF)(u,{shadow:"hover",class:"orangehrm-stat-card orangehrm-stat-card--warning"},{default:(0,n.k6)(()=>[(0,n.bF)(o,{title:"Chờ phê duyệt",value:S.pending},{suffix:(0,n.k6)(()=>[...i[11]||(i[11]=[(0,n.eW)("yêu cầu",-1)])]),_:1},8,["value"])]),_:1})]),_:1}),(0,n.bF)(W,{xs:24,sm:8},{default:(0,n.k6)(()=>[(0,n.bF)(u,{shadow:"hover",class:"orangehrm-stat-card orangehrm-stat-card--success"},{default:(0,n.k6)(()=>[(0,n.bF)(o,{title:"Đã phê duyệt",value:S.approved},{suffix:(0,n.k6)(()=>[...i[12]||(i[12]=[(0,n.eW)("yêu cầu",-1)])]),_:1},8,["value"])]),_:1})]),_:1}),(0,n.bF)(W,{xs:24,sm:8},{default:(0,n.k6)(()=>[(0,n.bF)(u,{shadow:"hover",class:"orangehrm-stat-card orangehrm-stat-card--danger"},{default:(0,n.k6)(()=>[(0,n.bF)(o,{title:"Bị từ chối",value:S.rejected},{suffix:(0,n.k6)(()=>[...i[13]||(i[13]=[(0,n.eW)("yêu cầu",-1)])]),_:1},8,["value"])]),_:1})]),_:1})]),_:1}),(0,n.bF)(u,{class:"orangehrm-filter-card",shadow:"never"},{default:(0,n.k6)(()=>[(0,n.bF)(q,{inline:!0,onSubmit:(0,n.D$)(x,["prevent"])},{default:(0,n.k6)(()=>[(0,n.bF)(Q,{label:"Trạng thái"},{default:(0,n.k6)(()=>[(0,n.bF)(D,{modelValue:C.trang_thai,"onUpdate:modelValue":i[0]||(i[0]=e=>C.trang_thai=e),placeholder:"Tất cả",clearable:"",style:{width:"180px"},onChange:B},{default:(0,n.k6)(()=>[(0,n.bF)(H,{label:"Đã nộp",value:"Submitted"}),(0,n.bF)(H,{label:"Đã duyệt",value:"Approved"}),(0,n.bF)(H,{label:"Bị từ chối",value:"Rejected"}),(0,n.bF)(H,{label:"Đã thanh toán",value:"Paid"})]),_:1},8,["modelValue"])]),_:1}),(0,n.bF)(Q,{label:"Nhân viên"},{default:(0,n.k6)(()=>[(0,n.bF)(D,{modelValue:C.nhan_vien_id,"onUpdate:modelValue":i[1]||(i[1]=e=>C.nhan_vien_id=e),placeholder:"Tất cả",clearable:"",filterable:"",style:{width:"220px"},onChange:B},{default:(0,n.k6)(()=>[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(a.value,e=>((0,n.uX)(),(0,n.Wv)(H,{key:e._id,label:`${e.ma_nhan_vien} - ${e.ho_dem} ${e.ten}`,value:e._id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),(0,n.bF)(u,{class:"orangehrm-table-card",shadow:"never"},{default:(0,n.k6)(()=>[(0,n.bo)(((0,n.uX)(),(0,n.Wv)(J,{data:t.value,style:{width:"100%"},stripe:"","empty-text":y.value||"Không có dữ liệu"},{default:(0,n.k6)(()=>[(0,n.bF)(G,{type:"index",label:"STT",width:"60"}),(0,n.bF)(G,{prop:"nhan_vien_id",label:"Nhân viên","min-width":"200"},{default:(0,n.k6)(({row:e})=>["object"===typeof e.nhan_vien_id&&e.nhan_vien_id?((0,n.uX)(),(0,n.CE)("div",d,[(0,n.Lk)("strong",null,(0,n.v_)(e.nhan_vien_id.ma_nhan_vien),1),(0,n.Lk)("div",h,(0,n.v_)(e.nhan_vien_id.ho_dem)+" "+(0,n.v_)(e.nhan_vien_id.ten),1)])):(0,n.Q3)("",!0)]),_:1}),(0,n.bF)(G,{prop:"tong_tien",label:"Tổng tiền",width:"150",align:"right"},{default:(0,n.k6)(({row:e})=>[(0,n.Lk)("strong",g,(0,n.v_)(N(e.tong_tien)),1)]),_:1}),(0,n.bF)(G,{prop:"items",label:"Số khoản",width:"100",align:"center"},{default:(0,n.k6)(({row:e})=>[(0,n.eW)((0,n.v_)(e.items?.length||0)+" khoản ",1)]),_:1}),(0,n.bF)(G,{label:"Trạng thái",width:"140"},{default:(0,n.k6)(({row:e})=>[(0,n.bF)(M,{type:X(e.trang_thai),size:"small"},{default:(0,n.k6)(()=>[(0,n.eW)((0,n.v_)(z(e.trang_thai)),1)]),_:2},1032,["type"])]),_:1}),(0,n.bF)(G,{label:"Ngày tạo",width:"150"},{default:(0,n.k6)(({row:e})=>[(0,n.eW)((0,n.v_)(K(e.ngay_tao)),1)]),_:1}),(0,n.bF)(G,{label:"Hành động",width:"260",fixed:"right"},{default:(0,n.k6)(({row:e})=>[(0,n.bF)(O,null,{default:(0,n.k6)(()=>[(0,n.bF)(r,{size:"small",icon:(0,n.R1)(l.View),onClick:t=>P(e)},{default:(0,n.k6)(()=>[...i[14]||(i[14]=[(0,n.eW)(" Xem ",-1)])]),_:1},8,["icon","onClick"]),"Submitted"===e.trang_thai?((0,n.uX)(),(0,n.Wv)(r,{key:0,size:"small",type:"success",icon:(0,n.R1)(l.Check),onClick:t=>V(e)},{default:(0,n.k6)(()=>[...i[15]||(i[15]=[(0,n.eW)(" Duyệt ",-1)])]),_:1},8,["icon","onClick"])):(0,n.Q3)("",!0),"Submitted"===e.trang_thai?((0,n.uX)(),(0,n.Wv)(r,{key:1,size:"small",type:"danger",icon:(0,n.R1)(l.Close),onClick:t=>T(e)},{default:(0,n.k6)(()=>[...i[16]||(i[16]=[(0,n.eW)(" Từ chối ",-1)])]),_:1},8,["icon","onClick"])):(0,n.Q3)("",!0)]),_:2},1024)]),_:1})]),_:1},8,["data","empty-text"])),[[le,m.value]]),(0,n.Lk)("div",_,[(0,n.bF)(Y,{"current-page":R.currentPage,"onUpdate:currentPage":i[2]||(i[2]=e=>R.currentPage=e),"page-size":R.limit,"onUpdate:pageSize":i[3]||(i[3]=e=>R.limit=e),"page-sizes":[10,20,50,100],total:R.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:U,onCurrentChange:E},null,8,["current-page","page-size","total"])])]),_:1}),(0,n.bF)(ae,{modelValue:k.value,"onUpdate:modelValue":i[5]||(i[5]=e=>k.value=e),title:"Chi tiết yêu cầu bồi hoàn",width:"700px"},(0,n.eX)({default:(0,n.k6)(()=>[F.value?((0,n.uX)(),(0,n.CE)("div",p,[(0,n.bF)(ee,{column:2,border:""},{default:(0,n.k6)(()=>[(0,n.bF)(Z,{label:"Nhân viên"},{default:(0,n.k6)(()=>["object"===typeof F.value.nhan_vien_id&&F.value.nhan_vien_id?((0,n.uX)(),(0,n.CE)("div",v,[(0,n.Lk)("strong",null,(0,n.v_)(F.value.nhan_vien_id.ma_nhan_vien),1),(0,n.Lk)("div",null,(0,n.v_)(F.value.nhan_vien_id.ho_dem)+" "+(0,n.v_)(F.value.nhan_vien_id.ten),1)])):(0,n.Q3)("",!0)]),_:1}),(0,n.bF)(Z,{label:"Trạng thái"},{default:(0,n.k6)(()=>[(0,n.bF)(M,{type:X(F.value.trang_thai)},{default:(0,n.k6)(()=>[(0,n.eW)((0,n.v_)(z(F.value.trang_thai)),1)]),_:1},8,["type"])]),_:1}),(0,n.bF)(Z,{label:"Tổng tiền"},{default:(0,n.k6)(()=>[(0,n.Lk)("strong",b,(0,n.v_)(N(F.value.tong_tien)),1)]),_:1}),(0,n.bF)(Z,{label:"Số khoản"},{default:(0,n.k6)(()=>[(0,n.eW)((0,n.v_)(F.value.items?.length||0)+" khoản ",1)]),_:1}),(0,n.bF)(Z,{label:"Ngày tạo"},{default:(0,n.k6)(()=>[(0,n.eW)((0,n.v_)(K(F.value.ngay_tao)),1)]),_:1}),(0,n.bF)(Z,{label:"Cập nhật cuối"},{default:(0,n.k6)(()=>[(0,n.eW)((0,n.v_)(K(F.value.ngay_cap_nhat)),1)]),_:1})]),_:1}),(0,n.bF)(te,null,{default:(0,n.k6)(()=>[...i[17]||(i[17]=[(0,n.eW)("Chi tiết các khoản chi phí",-1)])]),_:1}),(0,n.bF)(J,{data:F.value.items,border:"",stripe:""},{default:(0,n.k6)(()=>[(0,n.bF)(G,{type:"index",label:"STT",width:"60"}),(0,n.bF)(G,{prop:"ngay",label:"Ngày",width:"120"},{default:(0,n.k6)(({row:e})=>[(0,n.eW)((0,n.v_)(K(e.ngay)),1)]),_:1}),(0,n.bF)(G,{prop:"danh_muc",label:"Danh mục",width:"140"},{default:(0,n.k6)(({row:e})=>[(0,n.eW)((0,n.v_)(e.danh_muc||"-"),1)]),_:1}),(0,n.bF)(G,{prop:"mo_ta",label:"Mô tả","min-width":"200"},{default:(0,n.k6)(({row:e})=>[(0,n.eW)((0,n.v_)(e.mo_ta||"-"),1)]),_:1}),(0,n.bF)(G,{prop:"so_tien",label:"Số tiền",width:"140",align:"right"},{default:(0,n.k6)(({row:e})=>[(0,n.eW)((0,n.v_)(N(e.so_tien)),1)]),_:1})]),_:1},8,["data"])])):(0,n.Q3)("",!0)]),_:2},[F.value&&"Submitted"===F.value.trang_thai?{name:"footer",fn:(0,n.k6)(()=>[(0,n.bF)(r,{onClick:i[4]||(i[4]=e=>k.value=!1)},{default:(0,n.k6)(()=>[...i[18]||(i[18]=[(0,n.eW)("Đóng",-1)])]),_:1}),(0,n.bF)(r,{type:"success",icon:(0,n.R1)(l.Check),onClick:$},{default:(0,n.k6)(()=>[...i[19]||(i[19]=[(0,n.eW)(" Phê duyệt ",-1)])]),_:1},8,["icon"]),(0,n.bF)(r,{type:"danger",icon:(0,n.R1)(l.Close),onClick:I},{default:(0,n.k6)(()=>[...i[20]||(i[20]=[(0,n.eW)(" Từ chối ",-1)])]),_:1},8,["icon"])]),key:"0"}:void 0]),1032,["modelValue"]),(0,n.bF)(ae,{modelValue:w.value,"onUpdate:modelValue":i[8]||(i[8]=e=>w.value=e),title:"Từ chối yêu cầu bồi hoàn",width:"500px"},{footer:(0,n.k6)(()=>[(0,n.bF)(r,{onClick:i[7]||(i[7]=e=>w.value=!1)},{default:(0,n.k6)(()=>[...i[21]||(i[21]=[(0,n.eW)("Hủy",-1)])]),_:1}),(0,n.bF)(r,{type:"danger",loading:f.value,onClick:j},{default:(0,n.k6)(()=>[...i[22]||(i[22]=[(0,n.eW)(" Xác nhận từ chối ",-1)])]),_:1},8,["loading"])]),default:(0,n.k6)(()=>[(0,n.bF)(q,{"label-position":"top"},{default:(0,n.k6)(()=>[(0,n.bF)(Q,{label:"Lý do từ chối",required:""},{default:(0,n.k6)(()=>[(0,n.bF)(ne,{modelValue:A.value,"onUpdate:modelValue":i[6]||(i[6]=e=>A.value=e),type:"textarea",rows:4,placeholder:"Nhập lý do từ chối..."},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}}),y=a(6262);const f=(0,y.A)(m,[["__scopeId","data-v-1b332c62"]]);var k=f},6262:function(e,t){t.A=(e,t)=>{const a=e.__vccOpts||e;for(const[n,l]of t)a[n]=l;return a}},6604:function(e,t,a){var n=a(1114),l=a(1526);class i{constructor(){(0,n.A)(this,"BASE_URL","/nhanvien")}async getAll(e){const t=await l.A.get(this.BASE_URL,{params:e});return t.data}async getById(e){const t=await l.A.get(`${this.BASE_URL}/${e}`);return t.data}async create(e){const t=await l.A.post(this.BASE_URL,e);return t.data}async update(e,t){const a=await l.A.put(`${this.BASE_URL}/${e}`,t);return a.data}async delete(e){await l.A.delete(`${this.BASE_URL}/${e}`)}}t.A=new i}}]);
//# sourceMappingURL=2948.2f3da7e9.js.map