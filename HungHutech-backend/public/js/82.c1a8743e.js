"use strict";(self["webpackChunkHungHutech"]=self["webpackChunkHungHutech"]||[]).push([[82],{82:function(e,t,a){a.r(t),a.d(t,{default:function(){return y}});var n=a(1431),l=a(163),i=a(7918),r=a(8548),o=a(7927);const u={class:"page-container"},c={class:"page-header"},s={class:"employee-cell"},d={class:"pagination"};var g=(0,n.pM)({__name:"OvertimeApproval",setup(e){const t=(0,n.KR)([]),a=(0,n.KR)(!1),g=(0,n.KR)(""),h=(0,n.Kh)({page:1,limit:10,total:0}),p=(0,n.Kh)({trang_thai:"",range:[],q:""}),y=async(e=!1)=>{e&&(h.page=1),a.value=!0;try{const e={page:h.page,limit:h.limit,trang_thai:p.trang_thai||void 0,q:p.q||void 0};2===p.range?.length&&(e.from=p.range[0],e.to=p.range[1]);const a=await o.A.getAll(e);t.value=a.data,h.total=a.pagination.total}catch(n){l.nk.error(n.response?.data?.msg||"Không thể tải yêu cầu tăng ca")}finally{a.value=!1}},_=()=>{h.page=1,y()},m=e=>{h.page=e,y()},b=e=>{h.limit=e,h.page=1,y()},f=e=>{const t=e.nhan_vien_id;return t&&"object"===typeof t?`${t.ho_dem||""} ${t.ten||""}`.trim():"---"},v=e=>{switch(e){case"Da duyet":return"Đã duyệt";case"Bi tu choi":return"Bị từ chối";case"Da huy":return"Đã hủy";default:return"Chờ duyệt"}},k=e=>"Da duyet"===e?"success":"Bi tu choi"===e?"danger":"Da huy"===e?"info":"warning",w=e=>{if(!e)return"Ngày thường";switch(e){case"holiday":return"Lễ/Tết";case"holiday_night":return"Lễ/Tết đêm";case"weekend":return"Ngày nghỉ";case"weekend_night":return"Ngày nghỉ đêm";case"weekday_night":return"Ngày thường đêm";default:return"Ngày thường"}},F=e=>e?new Date(e).toLocaleDateString("vi-VN"):"---",A=e=>{const t=e.thoi_gian_bat_dau?new Date(e.thoi_gian_bat_dau).toLocaleTimeString("vi-VN",{hour:"2-digit",minute:"2-digit"}):"--:--",a=e.thoi_gian_ket_thuc?new Date(e.thoi_gian_ket_thuc).toLocaleTimeString("vi-VN",{hour:"2-digit",minute:"2-digit"}):"--:--";return`${t} - ${a}`},S=async(e,t)=>{try{const a="Da duyet"===t?"Phê duyệt":"Từ chối",{value:n}=await i.s.prompt("Nhập ghi chú gửi nhân viên (tùy chọn)",a,{confirmButtonText:a,cancelButtonText:"Hủy",inputPlaceholder:"Ghi chú"});g.value=e._id,await o.A.updateStatus(e._id,{trang_thai:t,ghi_chu_quan_ly:n}),l.nk.success("Da duyet"===t?"Đã phê duyệt yêu cầu tăng ca":"Đã từ chối yêu cầu"),y()}catch(a){if("cancel"===a)return;l.nk.error(a.response?.data?.msg||"Không thể cập nhật trạng thái")}finally{g.value=""}};return y(),(e,l)=>{const i=(0,n.g2)("el-button"),o=(0,n.g2)("el-option"),L=(0,n.g2)("el-select"),C=(0,n.g2)("el-form-item"),D=(0,n.g2)("el-col"),T=(0,n.g2)("el-date-picker"),x=(0,n.g2)("el-input"),B=(0,n.g2)("el-row"),N=(0,n.g2)("el-form"),R=(0,n.g2)("el-card"),I=(0,n.g2)("el-table-column"),U=(0,n.g2)("el-tag"),V=(0,n.g2)("el-space"),$=(0,n.g2)("el-table"),W=(0,n.g2)("el-pagination"),E=(0,n.gN)("loading");return(0,n.uX)(),(0,n.CE)("div",u,[(0,n.Lk)("div",c,[l[6]||(l[6]=(0,n.Lk)("div",null,[(0,n.Lk)("h2",null,"Duyệt yêu cầu tăng ca"),(0,n.Lk)("p",null,"Theo dõi hạn mức và phê duyệt các đề nghị OT")],-1)),(0,n.bF)(i,{icon:(0,n.R1)(r.Refresh),type:"primary",loading:a.value,onClick:l[0]||(l[0]=e=>y(!0))},{default:(0,n.k6)(()=>[...l[5]||(l[5]=[(0,n.eW)(" Làm mới ",-1)])]),_:1},8,["icon","loading"])]),(0,n.bF)(R,{class:"filter-card",shadow:"never"},{default:(0,n.k6)(()=>[(0,n.bF)(N,{model:p,"label-position":"top",onSubmit:l[4]||(l[4]=(0,n.D$)(()=>{},["prevent"]))},{default:(0,n.k6)(()=>[(0,n.bF)(B,{gutter:16},{default:(0,n.k6)(()=>[(0,n.bF)(D,{xs:24,sm:12,md:6},{default:(0,n.k6)(()=>[(0,n.bF)(C,{label:"Trạng thái"},{default:(0,n.k6)(()=>[(0,n.bF)(L,{modelValue:p.trang_thai,"onUpdate:modelValue":l[1]||(l[1]=e=>p.trang_thai=e),placeholder:"Tất cả",onChange:_},{default:(0,n.k6)(()=>[(0,n.bF)(o,{label:"Tất cả",value:""}),(0,n.bF)(o,{label:"Chờ duyệt",value:"Cho duyet"}),(0,n.bF)(o,{label:"Đã duyệt",value:"Da duyet"}),(0,n.bF)(o,{label:"Bị từ chối",value:"Bi tu choi"}),(0,n.bF)(o,{label:"Đã hủy",value:"Da huy"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),(0,n.bF)(D,{xs:24,sm:12,md:6},{default:(0,n.k6)(()=>[(0,n.bF)(C,{label:"Khoảng thời gian"},{default:(0,n.k6)(()=>[(0,n.bF)(T,{modelValue:p.range,"onUpdate:modelValue":l[2]||(l[2]=e=>p.range=e),type:"daterange","unlink-panels":"","range-separator":"Đến","start-placeholder":"Từ ngày","end-placeholder":"Đến ngày",format:"DD/MM/YYYY","value-format":"YYYY-MM-DD",onChange:_},null,8,["modelValue"])]),_:1})]),_:1}),(0,n.bF)(D,{xs:24,sm:12,md:6},{default:(0,n.k6)(()=>[(0,n.bF)(C,{label:"Nhân viên"},{default:(0,n.k6)(()=>[(0,n.bF)(x,{modelValue:p.q,"onUpdate:modelValue":l[3]||(l[3]=e=>p.q=e),placeholder:"Tìm mã NV/ghi chú",clearable:"",onKeyup:(0,n.jR)(_,["enter"]),onClear:_},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),(0,n.bF)(R,{shadow:"never"},{default:(0,n.k6)(()=>[(0,n.bo)(((0,n.uX)(),(0,n.Wv)($,{data:t.value,border:"","empty-text":"Chưa có yêu cầu"},{default:(0,n.k6)(()=>[(0,n.bF)(I,{label:"Nhân viên","min-width":"220"},{default:(0,n.k6)(({row:e})=>[(0,n.Lk)("div",s,[(0,n.Lk)("strong",null,(0,n.v_)(f(e)),1),(0,n.Lk)("small",null,(0,n.v_)(e.nhan_vien_id?.ma_nhan_vien),1)])]),_:1}),(0,n.bF)(I,{label:"Ngày",width:"140"},{default:(0,n.k6)(({row:e})=>[(0,n.eW)((0,n.v_)(F(e.ngay)),1)]),_:1}),(0,n.bF)(I,{label:"Thời gian","min-width":"180"},{default:(0,n.k6)(({row:e})=>[(0,n.eW)((0,n.v_)(A(e)),1)]),_:1}),(0,n.bF)(I,{prop:"so_gio",label:"Số giờ",width:"100"},{default:(0,n.k6)(({row:e})=>[(0,n.eW)((0,n.v_)(e.so_gio?.toFixed(2))+"h ",1)]),_:1}),(0,n.bF)(I,{label:"Loại",width:"150"},{default:(0,n.k6)(({row:e})=>[(0,n.eW)((0,n.v_)(w(e.loai_ngay)),1)]),_:1}),(0,n.bF)(I,{label:"Trạng thái",width:"140",align:"center"},{default:(0,n.k6)(({row:e})=>[(0,n.bF)(U,{type:k(e.trang_thai)},{default:(0,n.k6)(()=>[(0,n.eW)((0,n.v_)(v(e.trang_thai)),1)]),_:2},1032,["type"])]),_:1}),(0,n.bF)(I,{label:"Hành động",width:"220",align:"center"},{default:(0,n.k6)(({row:e})=>[(0,n.bF)(V,null,{default:(0,n.k6)(()=>["Cho duyet"===e.trang_thai?((0,n.uX)(),(0,n.Wv)(i,{key:0,type:"success",size:"small",loading:g.value===e._id,onClick:t=>S(e,"Da duyet")},{default:(0,n.k6)(()=>[...l[7]||(l[7]=[(0,n.eW)(" Phê duyệt ",-1)])]),_:1},8,["loading","onClick"])):(0,n.Q3)("",!0),"Cho duyet"===e.trang_thai?((0,n.uX)(),(0,n.Wv)(i,{key:1,type:"danger",size:"small",loading:g.value===e._id,onClick:t=>S(e,"Bi tu choi")},{default:(0,n.k6)(()=>[...l[8]||(l[8]=[(0,n.eW)(" Từ chối ",-1)])]),_:1},8,["loading","onClick"])):(0,n.Q3)("",!0)]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[E,a.value]]),(0,n.Lk)("div",d,[(0,n.bF)(W,{background:"",layout:"total, sizes, prev, pager, next",total:h.total,"current-page":h.page,"page-size":h.limit,onCurrentChange:m,onSizeChange:b},null,8,["total","current-page","page-size"])])]),_:1})])}}}),h=a(6262);const p=(0,h.A)(g,[["__scopeId","data-v-0c6c980a"]]);var y=p},1114:function(e,t,a){function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function l(e,t){if("object"!=n(e)||!e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var l=a.call(e,t||"default");if("object"!=n(l))return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function i(e){var t=l(e,"string");return"symbol"==n(t)?t:t+""}function r(e,t,a){return(t=i(t))in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}a.d(t,{A:function(){return r}})},1526:function(e,t,a){var n=a(1114),l=a(4335);const i=window?.appGlobal?.baseUrl&&`${window.appGlobal.baseUrl}/api`,r=i||"http://192.168.88.50:5000/api";console.log("API Base URL:",r);class o{constructor(){(0,n.A)(this,"axiosInstance",void 0),this.axiosInstance=l.A.create({baseURL:r,headers:{"Content-Type":"application/json"}}),this.axiosInstance.interceptors.request.use(e=>{const t=localStorage.getItem("token");return t&&(e.headers.Authorization=`Bearer ${t}`),e},e=>Promise.reject(e)),this.axiosInstance.interceptors.response.use(e=>e,e=>(401===e.response?.status&&(localStorage.removeItem("token"),localStorage.removeItem("user"),window.location.href="/login"),Promise.reject(e)))}get(e,t){return this.axiosInstance.get(e,t)}post(e,t,a){return this.axiosInstance.post(e,t,a)}put(e,t,a){return this.axiosInstance.put(e,t,a)}delete(e,t){return this.axiosInstance.delete(e,t)}patch(e,t,a){return this.axiosInstance.patch(e,t,a)}}t.A=new o},6262:function(e,t){t.A=(e,t)=>{const a=e.__vccOpts||e;for(const[n,l]of t)a[n]=l;return a}},7927:function(e,t,a){var n=a(1114),l=a(1526);class i{constructor(){(0,n.A)(this,"BASE_URL","/overtime-requests")}async getAll(e){const t=await l.A.get(this.BASE_URL,{params:e});return t.data}async getMy(e){const t=await l.A.get(`${this.BASE_URL}/my`,{params:e});return t.data}async create(e){const t=await l.A.post(this.BASE_URL,e);return t.data}async updateStatus(e,t){const a=await l.A.put(`${this.BASE_URL}/${e}/status`,t);return a.data}async cancel(e){const t=await l.A.put(`${this.BASE_URL}/${e}/cancel`);return t.data}async getAlerts(){const e=await l.A.get(`${this.BASE_URL}/alerts`);return e.data}}t.A=new i}}]);
//# sourceMappingURL=82.c1a8743e.js.map