"use strict";(self["webpackChunkHungHutech"]=self["webpackChunkHungHutech"]||[]).push([[407],{407:function(e,a,n){n.r(a),n.d(a,{default:function(){return b}});var t=n(1431),l=n(163),o=n(7918),i=n(8548),u=n(503),r=n(6604);const d={class:"contract-page"},c={class:"page-header"},h={class:"emp-info"},s={class:"pagination"};var _=(0,t.pM)({__name:"ContractList",setup(e){const a=(0,t.Kh)({nhan_vien_id:"",trang_thai:"",q:""}),n=[{label:"Nháp",value:"Draft"},{label:"Chờ duyệt",value:"Cho_duyet"},{label:"Đã ký",value:"Da_ky"},{label:"Đã hủy",value:"Da_huy"}],_=(0,t.KR)([]),g=(0,t.KR)([]),p=(0,t.KR)(!1),b=(0,t.KR)(!1),v=(0,t.Kh)({page:1,limit:10,total:0}),m=(0,t.KR)(!1),f=(0,t.KR)(),k=(0,t.Kh)({so_hop_dong:"",nhan_vien_id:"",loai_hop_dong:"Co_thoi_han",dateRange:[],luong_co_ban:0,file_url:"",ghi_chu:""}),y={so_hop_dong:[{required:!0,message:"Nhập số hợp đồng",trigger:"blur"}],nhan_vien_id:[{required:!0,message:"Chọn nhân viên",trigger:"change"}],luong_co_ban:[{required:!0,message:"Nhập lương cơ bản",trigger:"blur"}]},w=async()=>{const e=await r.A.getAll({page:1,limit:200});g.value=e.data||[]},F=async()=>{p.value=!0;try{const e={page:v.page,limit:v.limit,q:a.q||void 0,nhan_vien_id:a.nhan_vien_id||void 0,trang_thai:a.trang_thai||void 0},n=await u.A.getAll(e);_.value=n.data||[],v.total=n.pagination?.total||0}catch(e){l.nk.error(e.response?.data?.msg||"Không thể tải hợp đồng")}finally{p.value=!1}},A=()=>{v.page=1,F()},V=()=>{a.q="",a.trang_thai="",a.nhan_vien_id="",A()},C=e=>{v.page=e,F()},L=()=>{m.value=!0},R=()=>{m.value=!1,k.so_hop_dong="",k.nhan_vien_id="",k.loai_hop_dong="Co_thoi_han",k.dateRange=[],k.luong_co_ban=0,k.file_url="",k.ghi_chu=""},S=async()=>{f.value&&await f.value.validate(async e=>{if(e){b.value=!0;try{await u.A.create({so_hop_dong:k.so_hop_dong,nhan_vien_id:k.nhan_vien_id,loai_hop_dong:k.loai_hop_dong,hieu_luc_tu:k.dateRange[0],hieu_luc_den:k.dateRange[1],luong_co_ban:k.luong_co_ban,file_url:k.file_url,ghi_chu:k.ghi_chu}),l.nk.success("Đã tạo hợp đồng"),R(),F()}catch(a){l.nk.error(a.response?.data?.msg||"Không thể tạo hợp đồng")}finally{b.value=!1}}})},U=async(e,a)=>{try{await u.A.updateStatus(e._id,a),l.nk.success("Đã cập nhật trạng thái"),F()}catch(n){l.nk.error(n.response?.data?.msg||"Không thể cập nhật trạng thái")}},$=async e=>{try{await o.s.confirm("Xóa hợp đồng này?","Xác nhận",{type:"warning"}),await u.A.delete(e),l.nk.success("Đã xóa hợp đồng"),F()}catch(a){if("cancel"===a)return;l.nk.error(a.response?.data?.msg||"Không thể xóa hợp đồng")}},x=e=>e&&"string"!==typeof e?`${e.ho_dem||""} ${e.ten||""}`.trim():"",K=e=>e?new Date(e).toLocaleDateString("vi-VN"):"",E=e=>e?`${e.toLocaleString("vi-VN")} VND`:"0 VND",I=e=>{switch(e){case"Thu_viec":return"Thử việc";case"Khong_thoi_han":return"Không thời hạn";case"Cong_tac":return"Công tác";default:return"Có thời hạn"}},B=e=>n.find(a=>a.value===e)?.label||e,T=e=>"Da_ky"===e?"success":"Cho_duyet"===e?"warning":"Da_huy"===e?"danger":"info";return(0,t.sV)(()=>{w(),F()}),(e,l)=>{const o=(0,t.g2)("el-button"),u=(0,t.g2)("el-option"),r=(0,t.g2)("el-select"),w=(0,t.g2)("el-form-item"),F=(0,t.g2)("el-input"),W=(0,t.g2)("el-form"),D=(0,t.g2)("el-card"),N=(0,t.g2)("el-table-column"),X=(0,t.g2)("el-tag"),H=(0,t.g2)("arrow-down"),q=(0,t.g2)("el-icon"),j=(0,t.g2)("el-dropdown-item"),P=(0,t.g2)("el-dropdown-menu"),z=(0,t.g2)("el-dropdown"),Y=(0,t.g2)("el-space"),G=(0,t.g2)("el-table"),M=(0,t.g2)("el-pagination"),O=(0,t.g2)("el-date-picker"),Q=(0,t.g2)("el-input-number"),J=(0,t.g2)("el-dialog"),Z=(0,t.gN)("loading");return(0,t.uX)(),(0,t.CE)("div",d,[(0,t.Lk)("div",c,[l[12]||(l[12]=(0,t.Lk)("div",null,[(0,t.Lk)("h1",null,"Quản lý hợp đồng"),(0,t.Lk)("p",null," Theo dõi vòng đời hợp đồng lao động và tự động cập nhật lương cơ bản. ")],-1)),(0,t.bF)(o,{type:"primary",icon:(0,t.R1)(i.Plus),onClick:L},{default:(0,t.k6)(()=>[...l[11]||(l[11]=[(0,t.eW)("Tạo hợp đồng",-1)])]),_:1},8,["icon"])]),(0,t.bF)(D,{class:"filter-card",shadow:"never"},{default:(0,t.k6)(()=>[(0,t.bF)(W,{inline:""},{default:(0,t.k6)(()=>[(0,t.bF)(w,{label:"Nhân viên"},{default:(0,t.k6)(()=>[(0,t.bF)(r,{modelValue:a.nhan_vien_id,"onUpdate:modelValue":l[0]||(l[0]=e=>a.nhan_vien_id=e),placeholder:"Tất cả",filterable:"",style:{width:"220px"}},{default:(0,t.k6)(()=>[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(g.value,e=>((0,t.uX)(),(0,t.Wv)(u,{key:e._id,label:`${e.ma_nhan_vien} - ${e.ho_dem} ${e.ten}`,value:e._id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),(0,t.bF)(w,{label:"Trạng thái"},{default:(0,t.k6)(()=>[(0,t.bF)(r,{modelValue:a.trang_thai,"onUpdate:modelValue":l[1]||(l[1]=e=>a.trang_thai=e),placeholder:"Tất cả",style:{width:"180px"}},{default:(0,t.k6)(()=>[((0,t.uX)(),(0,t.CE)(t.FK,null,(0,t.pI)(n,e=>(0,t.bF)(u,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),(0,t.bF)(w,{label:"Từ khóa"},{default:(0,t.k6)(()=>[(0,t.bF)(F,{modelValue:a.q,"onUpdate:modelValue":l[2]||(l[2]=e=>a.q=e),placeholder:"Số HĐ, ghi chú...",clearable:"","prefix-icon":(0,t.R1)(i.Search),onKeyup:(0,t.jR)(A,["enter","native"])},null,8,["modelValue","prefix-icon"])]),_:1}),(0,t.bF)(w,null,{default:(0,t.k6)(()=>[(0,t.bF)(o,{type:"primary",onClick:A},{default:(0,t.k6)(()=>[...l[13]||(l[13]=[(0,t.eW)("Lọc",-1)])]),_:1}),(0,t.bF)(o,{onClick:V},{default:(0,t.k6)(()=>[...l[14]||(l[14]=[(0,t.eW)("Xóa lọc",-1)])]),_:1})]),_:1})]),_:1})]),_:1}),(0,t.bF)(D,{shadow:"never"},{default:(0,t.k6)(()=>[(0,t.bo)(((0,t.uX)(),(0,t.Wv)(G,{data:_.value,stripe:""},{default:(0,t.k6)(()=>[(0,t.bF)(N,{label:"Số HĐ",prop:"so_hop_dong","min-width":"140"}),(0,t.bF)(N,{label:"Nhân viên","min-width":"200"},{default:(0,t.k6)(({row:e})=>[(0,t.Lk)("div",h,[(0,t.Lk)("strong",null,(0,t.v_)(e.nhan_vien_id?.ma_nhan_vien),1),(0,t.Lk)("span",null,(0,t.v_)(x(e.nhan_vien_id)),1)])]),_:1}),(0,t.bF)(N,{label:"Loại hợp đồng","min-width":"160"},{default:(0,t.k6)(({row:e})=>[(0,t.eW)((0,t.v_)(I(e.loai_hop_dong)),1)]),_:1}),(0,t.bF)(N,{label:"Hiệu lực","min-width":"200"},{default:(0,t.k6)(({row:e})=>[(0,t.eW)((0,t.v_)(K(e.hieu_luc_tu))+" - "+(0,t.v_)(K(e.hieu_luc_den)||"Không xác định"),1)]),_:1}),(0,t.bF)(N,{label:"Lương cơ bản",width:"150"},{default:(0,t.k6)(({row:e})=>[(0,t.eW)((0,t.v_)(E(e.luong_co_ban)),1)]),_:1}),(0,t.bF)(N,{label:"Trạng thái",width:"140"},{default:(0,t.k6)(({row:e})=>[(0,t.bF)(X,{type:T(e.trang_thai)},{default:(0,t.k6)(()=>[(0,t.eW)((0,t.v_)(B(e.trang_thai)),1)]),_:2},1032,["type"])]),_:1}),(0,t.bF)(N,{label:"Hành động",width:"200",fixed:"right"},{default:(0,t.k6)(({row:e})=>[(0,t.bF)(Y,null,{default:(0,t.k6)(()=>[(0,t.bF)(z,{onCommand:a=>U(e,a)},{dropdown:(0,t.k6)(()=>[(0,t.bF)(P,null,{default:(0,t.k6)(()=>[((0,t.uX)(),(0,t.CE)(t.FK,null,(0,t.pI)(n,e=>(0,t.bF)(j,{key:e.value,command:e.value},{default:(0,t.k6)(()=>[(0,t.eW)((0,t.v_)(e.label),1)]),_:2},1032,["command"])),64))]),_:1})]),default:(0,t.k6)(()=>[(0,t.bF)(o,{size:"small"},{default:(0,t.k6)(()=>[l[15]||(l[15]=(0,t.eW)(" Trạng thái ",-1)),(0,t.bF)(q,null,{default:(0,t.k6)(()=>[(0,t.bF)(H)]),_:1})]),_:1})]),_:1},8,["onCommand"]),(0,t.bF)(o,{size:"small",icon:(0,t.R1)(i.Delete),type:"danger",onClick:a=>$(e._id)},{default:(0,t.k6)(()=>[...l[16]||(l[16]=[(0,t.eW)(" Xóa ",-1)])]),_:1},8,["icon","onClick"])]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[Z,p.value]]),(0,t.Lk)("div",s,[(0,t.bF)(M,{layout:"total, prev, pager, next",total:v.total,"page-size":v.limit,"current-page":v.page,onCurrentChange:C},null,8,["total","page-size","current-page"])])]),_:1}),(0,t.bF)(J,{modelValue:m.value,"onUpdate:modelValue":l[10]||(l[10]=e=>m.value=e),title:"Tạo hợp đồng lao động",width:"620px","close-on-click-modal":!1},{footer:(0,t.k6)(()=>[(0,t.bF)(o,{onClick:R},{default:(0,t.k6)(()=>[...l[17]||(l[17]=[(0,t.eW)("Hủy",-1)])]),_:1}),(0,t.bF)(o,{type:"primary",loading:b.value,onClick:S},{default:(0,t.k6)(()=>[...l[18]||(l[18]=[(0,t.eW)(" Lưu hợp đồng ",-1)])]),_:1},8,["loading"])]),default:(0,t.k6)(()=>[(0,t.bF)(W,{ref_key:"formRef",ref:f,model:k,rules:y,"label-width":"150px"},{default:(0,t.k6)(()=>[(0,t.bF)(w,{label:"Số hợp đồng",prop:"so_hop_dong"},{default:(0,t.k6)(()=>[(0,t.bF)(F,{modelValue:k.so_hop_dong,"onUpdate:modelValue":l[3]||(l[3]=e=>k.so_hop_dong=e),placeholder:"VD: HD/2025/001"},null,8,["modelValue"])]),_:1}),(0,t.bF)(w,{label:"Nhân viên",prop:"nhan_vien_id"},{default:(0,t.k6)(()=>[(0,t.bF)(r,{modelValue:k.nhan_vien_id,"onUpdate:modelValue":l[4]||(l[4]=e=>k.nhan_vien_id=e),filterable:"",placeholder:"Chọn nhân viên"},{default:(0,t.k6)(()=>[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(g.value,e=>((0,t.uX)(),(0,t.Wv)(u,{key:e._id,label:`${e.ma_nhan_vien} - ${e.ho_dem} ${e.ten}`,value:e._id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),(0,t.bF)(w,{label:"Loại hợp đồng",prop:"loai_hop_dong"},{default:(0,t.k6)(()=>[(0,t.bF)(r,{modelValue:k.loai_hop_dong,"onUpdate:modelValue":l[5]||(l[5]=e=>k.loai_hop_dong=e)},{default:(0,t.k6)(()=>[(0,t.bF)(u,{label:"Thử việc",value:"Thu_viec"}),(0,t.bF)(u,{label:"Có thời hạn",value:"Co_thoi_han"}),(0,t.bF)(u,{label:"Không thời hạn",value:"Khong_thoi_han"}),(0,t.bF)(u,{label:"Công tác",value:"Cong_tac"})]),_:1},8,["modelValue"])]),_:1}),(0,t.bF)(w,{label:"Hiệu lực"},{default:(0,t.k6)(()=>[(0,t.bF)(O,{modelValue:k.dateRange,"onUpdate:modelValue":l[6]||(l[6]=e=>k.dateRange=e),type:"daterange","value-format":"YYYY-MM-DD","range-separator":"Đến","start-placeholder":"Từ ngày","end-placeholder":"Đến ngày",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),(0,t.bF)(w,{label:"Lương cơ bản",prop:"luong_co_ban"},{default:(0,t.k6)(()=>[(0,t.bF)(Q,{modelValue:k.luong_co_ban,"onUpdate:modelValue":l[7]||(l[7]=e=>k.luong_co_ban=e),min:0,step:5e5,controls:!1,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),(0,t.bF)(w,{label:"Tập tin hợp đồng"},{default:(0,t.k6)(()=>[(0,t.bF)(F,{modelValue:k.file_url,"onUpdate:modelValue":l[8]||(l[8]=e=>k.file_url=e),placeholder:"Đường dẫn file scan hoặc e-contract"},null,8,["modelValue"])]),_:1}),(0,t.bF)(w,{label:"Ghi chú"},{default:(0,t.k6)(()=>[(0,t.bF)(F,{modelValue:k.ghi_chu,"onUpdate:modelValue":l[9]||(l[9]=e=>k.ghi_chu=e),type:"textarea",rows:"3"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}}),g=n(6262);const p=(0,g.A)(_,[["__scopeId","data-v-090c6e41"]]);var b=p},503:function(e,a,n){var t=n(1114),l=n(1526);class o{constructor(){(0,t.A)(this,"BASE_URL","/contracts")}async getAll(e){const a=await l.A.get(this.BASE_URL,{params:e});return a.data}async getById(e){const a=await l.A.get(`${this.BASE_URL}/${e}`);return a.data}async create(e){const a=await l.A.post(this.BASE_URL,e);return a.data}async update(e,a){const n=await l.A.put(`${this.BASE_URL}/${e}`,a);return n.data}async updateStatus(e,a,n){const t=await l.A.patch(`${this.BASE_URL}/${e}/status`,{trang_thai:a,ghi_chu:n});return t.data}async delete(e){await l.A.delete(`${this.BASE_URL}/${e}`)}async getExpiring(e){const a=await l.A.get(`${this.BASE_URL}/expiring`,{params:e});return a.data.data||[]}}a.A=new o},1114:function(e,a,n){function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t(e)}function l(e,a){if("object"!=t(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var l=n.call(e,a||"default");if("object"!=t(l))return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===a?String:Number)(e)}function o(e){var a=l(e,"string");return"symbol"==t(a)?a:a+""}function i(e,a,n){return(a=o(a))in e?Object.defineProperty(e,a,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[a]=n,e}n.d(a,{A:function(){return i}})},1526:function(e,a,n){var t=n(1114),l=n(4335);const o=window?.appGlobal?.baseUrl&&`${window.appGlobal.baseUrl}/api`,i=o||"http://192.168.88.50:5000/api";console.log("API Base URL:",i);class u{constructor(){(0,t.A)(this,"axiosInstance",void 0),this.axiosInstance=l.A.create({baseURL:i,headers:{"Content-Type":"application/json"}}),this.axiosInstance.interceptors.request.use(e=>{const a=localStorage.getItem("token");return a&&(e.headers.Authorization=`Bearer ${a}`),e},e=>Promise.reject(e)),this.axiosInstance.interceptors.response.use(e=>e,e=>(401===e.response?.status&&(localStorage.removeItem("token"),localStorage.removeItem("user"),window.location.href="/login"),Promise.reject(e)))}get(e,a){return this.axiosInstance.get(e,a)}post(e,a,n){return this.axiosInstance.post(e,a,n)}put(e,a,n){return this.axiosInstance.put(e,a,n)}delete(e,a){return this.axiosInstance.delete(e,a)}patch(e,a,n){return this.axiosInstance.patch(e,a,n)}}a.A=new u},6262:function(e,a){a.A=(e,a)=>{const n=e.__vccOpts||e;for(const[t,l]of a)n[t]=l;return n}},6604:function(e,a,n){var t=n(1114),l=n(1526);class o{constructor(){(0,t.A)(this,"BASE_URL","/nhanvien")}async getAll(e){const a=await l.A.get(this.BASE_URL,{params:e});return a.data}async getById(e){const a=await l.A.get(`${this.BASE_URL}/${e}`);return a.data}async create(e){const a=await l.A.post(this.BASE_URL,e);return a.data}async update(e,a){const n=await l.A.put(`${this.BASE_URL}/${e}`,a);return n.data}async delete(e){await l.A.delete(`${this.BASE_URL}/${e}`)}}a.A=new o}}]);
//# sourceMappingURL=407.c2327583.js.map