"use strict";(self["webpackChunkHungHutech"]=self["webpackChunkHungHutech"]||[]).push([[4136],{1114:function(t,a,e){function l(t){return l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},l(t)}function s(t,a){if("object"!=l(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var s=e.call(t,a||"default");if("object"!=l(s))return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===a?String:Number)(t)}function n(t){var a=s(t,"string");return"symbol"==l(a)?a:a+""}function o(t,a,e){return(a=n(a))in t?Object.defineProperty(t,a,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[a]=e,t}e.d(a,{A:function(){return o}})},1526:function(t,a,e){var l=e(1114),s=e(4335);const n=window?.appGlobal?.baseUrl&&`${window.appGlobal.baseUrl}/api`,o=n||"http://192.168.88.50:5000/api";console.log("API Base URL:",o);class i{constructor(){(0,l.A)(this,"axiosInstance",void 0),this.axiosInstance=s.A.create({baseURL:o,headers:{"Content-Type":"application/json"}}),this.axiosInstance.interceptors.request.use(t=>{const a=localStorage.getItem("token");return a&&(t.headers.Authorization=`Bearer ${a}`),t},t=>Promise.reject(t)),this.axiosInstance.interceptors.response.use(t=>t,t=>(401===t.response?.status&&(localStorage.removeItem("token"),localStorage.removeItem("user"),window.location.href="/login"),Promise.reject(t)))}get(t,a){return this.axiosInstance.get(t,a)}post(t,a,e){return this.axiosInstance.post(t,a,e)}put(t,a,e){return this.axiosInstance.put(t,a,e)}delete(t,a){return this.axiosInstance.delete(t,a)}patch(t,a,e){return this.axiosInstance.patch(t,a,e)}}a.A=new i},4136:function(t,a,e){e.r(a),e.d(a,{default:function(){return gt}});var l=e(1431),s=e(1114),n=e(1526);class o{constructor(){(0,s.A)(this,"BASE_URL","/audit-logs")}async getAll(t){const a=await n.A.get(this.BASE_URL,{params:t});return a.data}async getById(t){const a=await n.A.get(`${this.BASE_URL}/${t}`);return a.data}async getStats(t,a){const e=await n.A.get(`${this.BASE_URL}/stats`,{params:{startDate:t,endDate:a}});return e.data}async getByUser(t,a){const e=await n.A.get(`${this.BASE_URL}/user/${t}`,{params:a});return e.data}async getByIP(t,a){const e=await n.A.get(`${this.BASE_URL}/ip/${t}`,{params:a});return e.data}async delete(t){await n.A.delete(`${this.BASE_URL}/${t}`)}async cleanup(t){const a=await n.A.post(`${this.BASE_URL}/cleanup`,{daysOld:t});return a.data}}var i=new o;const u={class:"audit-logs-container"},d={key:0,class:"stats-grid"},c={class:"stat-card"},r={class:"stat-content"},v={class:"stat-value"},k={class:"stat-card"},L={class:"stat-content"},p={class:"stat-value"},g={class:"stat-card"},h={class:"stat-content"},m={class:"stat-value"},b={class:"stat-card"},y={class:"stat-content"},E={class:"stat-value"},C={class:"filters-section"},T={class:"filters-row"},f={key:1,class:"loading"},_={key:2,class:"empty-state"},A={key:3,class:"table-container"},D={class:"audit-table"},I={key:0,class:"user-info"},S={class:"user-name"},R={class:"user-email"},P={key:1,class:"text-muted"},U={class:"endpoint-cell"},w=["onClick"],X={key:0,class:"pagination"},O=["disabled"],B={class:"page-info"},$=["disabled"],x={class:"modal-content modal-large"},K={class:"modal-header"},H={class:"modal-body"},G={key:0,class:"details-grid"},N={class:"detail-item"},F={class:"detail-item"},j={key:0},Q={key:1},V={class:"detail-item"},J={class:"detail-item"},M={class:"detail-item"},q={class:"detail-item"},z={class:"detail-item"},W={class:"detail-item"},Y={class:"text-small"},Z={class:"detail-item"},tt={class:"detail-item"},at={key:0,class:"detail-item full-width"},et={class:"json-viewer"},lt={class:"modal-content modal-large"},st={class:"modal-header"},nt={class:"modal-body"},ot={key:0,class:"stats-details"},it={class:"stats-section"},ut={class:"stats-table"},dt={class:"stats-section"},ct={class:"stats-table"},rt={class:"stats-section"},vt={class:"stats-table"};var kt=(0,l.pM)({__name:"AuditLogs",setup(t){const a=(0,l.KR)([]),e=(0,l.KR)(null),s=(0,l.KR)(!1),n=(0,l.KR)(!1),o=(0,l.KR)(!1),kt=(0,l.KR)(null),Lt=(0,l.KR)({search:"",action:"",method:"",startDate:"",endDate:"",page:1,limit:20}),pt=(0,l.KR)({total:0,page:1,limit:20,totalPages:1});let gt;async function ht(){s.value=!0;try{const t={page:Lt.value.page,limit:Lt.value.limit};Lt.value.search&&(t.search=Lt.value.search),Lt.value.action&&(t.action=Lt.value.action),Lt.value.method&&(t.method=Lt.value.method),Lt.value.startDate&&(t.startDate=Lt.value.startDate),Lt.value.endDate&&(t.endDate=Lt.value.endDate);const e=await i.getAll(t);a.value=e.data,pt.value=e.pagination}catch(t){alert("âŒ Lá»—i: "+(t.response?.data?.message||t.message))}finally{s.value=!1}}async function mt(){try{const t={};Lt.value.startDate&&(t.startDate=Lt.value.startDate),Lt.value.endDate&&(t.endDate=Lt.value.endDate),e.value=await i.getStats(t.startDate,t.endDate)}catch(t){console.error("Error fetching stats:",t)}}function bt(){clearTimeout(gt),gt=setTimeout(()=>{Lt.value.page=1,ht()},500)}function yt(){Lt.value={search:"",action:"",method:"",startDate:"",endDate:"",page:1,limit:20},ht(),mt()}function Et(t){Lt.value.page=t,ht()}function Ct(t){kt.value=t,n.value=!0}function Tt(t){const a=new Date(t);return a.toLocaleString("vi-VN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})}function ft(t){const a={LOGIN:"badge-success",LOGOUT:"badge-info",CREATE:"badge-primary",READ:"badge-secondary",UPDATE:"badge-warning",DELETE:"badge-danger",EXPORT:"badge-info"};return a[t]||"badge-secondary"}function _t(t){const a={GET:"method-get",POST:"method-post",PUT:"method-put",PATCH:"method-patch",DELETE:"method-delete"};return a[t]||""}function At(t){return t>=200&&t<300?"status-success":t>=300&&t<400?"status-redirect":t>=400&&t<500?"status-client-error":t>=500?"status-server-error":""}return(0,l.sV)(()=>{ht(),mt()}),(t,i)=>((0,l.uX)(),(0,l.CE)("div",u,[i[43]||(i[43]=(0,l.Lk)("div",{class:"page-header"},[(0,l.Lk)("h1",null,"ðŸ“Š Lá»‹ch sá»­ Truy cáº­p Website"),(0,l.Lk)("p",{class:"subtitle"},"Theo dÃµi vÃ  giÃ¡m sÃ¡t hoáº¡t Ä‘á»™ng truy cáº­p há»‡ thá»‘ng")],-1)),e.value?((0,l.uX)(),(0,l.CE)("div",d,[(0,l.Lk)("div",c,[i[13]||(i[13]=(0,l.Lk)("div",{class:"stat-icon"},"ðŸ“",-1)),(0,l.Lk)("div",r,[(0,l.Lk)("div",v,(0,l.v_)((e.value.totalLogs||0).toLocaleString()),1),i[12]||(i[12]=(0,l.Lk)("div",{class:"stat-label"},"Tá»•ng lÆ°á»£t truy cáº­p",-1))])]),(0,l.Lk)("div",k,[i[15]||(i[15]=(0,l.Lk)("div",{class:"stat-icon"},"ðŸ‘¥",-1)),(0,l.Lk)("div",L,[(0,l.Lk)("div",p,(0,l.v_)((e.value.totalUsers||0).toLocaleString()),1),i[14]||(i[14]=(0,l.Lk)("div",{class:"stat-label"},"NgÆ°á»i dÃ¹ng hoáº¡t Ä‘á»™ng",-1))])]),(0,l.Lk)("div",g,[i[17]||(i[17]=(0,l.Lk)("div",{class:"stat-icon"},"âš¡",-1)),(0,l.Lk)("div",h,[(0,l.Lk)("div",m,(0,l.v_)((e.value.avgResponseTime||0).toFixed(0))+"ms ",1),i[16]||(i[16]=(0,l.Lk)("div",{class:"stat-label"},"Thá»i gian pháº£n há»“i TB",-1))])]),(0,l.Lk)("div",b,[i[19]||(i[19]=(0,l.Lk)("div",{class:"stat-icon"},"âŒ",-1)),(0,l.Lk)("div",y,[(0,l.Lk)("div",E,(0,l.v_)((e.value.errorRate||0).toFixed(2))+"%",1),i[18]||(i[18]=(0,l.Lk)("div",{class:"stat-label"},"Tá»· lá»‡ lá»—i",-1))])])])):(0,l.Q3)("",!0),(0,l.Lk)("div",C,[(0,l.Lk)("div",T,[(0,l.bo)((0,l.Lk)("input",{"onUpdate:modelValue":i[0]||(i[0]=t=>Lt.value.search=t),placeholder:"ðŸ” TÃ¬m kiáº¿m theo endpoint, IP, user...",class:"search-input",onInput:bt},null,544),[[l.Jo,Lt.value.search]]),(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":i[1]||(i[1]=t=>Lt.value.action=t),class:"filter-select",onChange:ht},[...i[20]||(i[20]=[(0,l.Fv)('<option value="" data-v-78bea1b4>Táº¥t cáº£ hÃ nh Ä‘á»™ng</option><option value="LOGIN" data-v-78bea1b4>LOGIN</option><option value="LOGOUT" data-v-78bea1b4>LOGOUT</option><option value="CREATE" data-v-78bea1b4>CREATE</option><option value="READ" data-v-78bea1b4>READ</option><option value="UPDATE" data-v-78bea1b4>UPDATE</option><option value="DELETE" data-v-78bea1b4>DELETE</option><option value="EXPORT" data-v-78bea1b4>EXPORT</option>',8)])],544),[[l.u1,Lt.value.action]]),(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":i[2]||(i[2]=t=>Lt.value.method=t),class:"filter-select",onChange:ht},[...i[21]||(i[21]=[(0,l.Fv)('<option value="" data-v-78bea1b4>Táº¥t cáº£ methods</option><option value="GET" data-v-78bea1b4>GET</option><option value="POST" data-v-78bea1b4>POST</option><option value="PUT" data-v-78bea1b4>PUT</option><option value="PATCH" data-v-78bea1b4>PATCH</option><option value="DELETE" data-v-78bea1b4>DELETE</option>',6)])],544),[[l.u1,Lt.value.method]]),(0,l.bo)((0,l.Lk)("input",{"onUpdate:modelValue":i[3]||(i[3]=t=>Lt.value.startDate=t),type:"date",class:"date-input",placeholder:"Tá»« ngÃ y",onChange:ht},null,544),[[l.Jo,Lt.value.startDate]]),(0,l.bo)((0,l.Lk)("input",{"onUpdate:modelValue":i[4]||(i[4]=t=>Lt.value.endDate=t),type:"date",class:"date-input",placeholder:"Äáº¿n ngÃ y",onChange:ht},null,544),[[l.Jo,Lt.value.endDate]]),(0,l.Lk)("button",{class:"btn-secondary",onClick:yt},"ðŸ”„ Reset"),(0,l.Lk)("button",{class:"btn-info",onClick:i[5]||(i[5]=t=>o.value=!0)}," ðŸ“Š Thá»‘ng kÃª ")])]),s.value?((0,l.uX)(),(0,l.CE)("div",f,"Äang táº£i dá»¯ liá»‡u...")):0===a.value.length?((0,l.uX)(),(0,l.CE)("div",_,[...i[22]||(i[22]=[(0,l.Lk)("div",{class:"empty-icon"},"ðŸ“‹",-1),(0,l.Lk)("p",null,"KhÃ´ng cÃ³ dá»¯ liá»‡u lá»‹ch sá»­ truy cáº­p",-1)])])):((0,l.uX)(),(0,l.CE)("div",A,[(0,l.Lk)("table",D,[i[23]||(i[23]=(0,l.Lk)("thead",null,[(0,l.Lk)("tr",null,[(0,l.Lk)("th",null,"Thá»i gian"),(0,l.Lk)("th",null,"NgÆ°á»i dÃ¹ng"),(0,l.Lk)("th",null,"HÃ nh Ä‘á»™ng"),(0,l.Lk)("th",null,"Method"),(0,l.Lk)("th",null,"Endpoint"),(0,l.Lk)("th",null,"IP Address"),(0,l.Lk)("th",null,"Status"),(0,l.Lk)("th",null,"Response Time"),(0,l.Lk)("th",null,"Thao tÃ¡c")])],-1)),(0,l.Lk)("tbody",null,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(a.value,t=>((0,l.uX)(),(0,l.CE)("tr",{key:t._id,class:(0,l.C4)({"error-row":t.statusCode>=400})},[(0,l.Lk)("td",null,(0,l.v_)(Tt(t.timestamp)),1),(0,l.Lk)("td",null,[t.userId?((0,l.uX)(),(0,l.CE)("div",I,[(0,l.Lk)("div",S,(0,l.v_)(t.userId.name),1),(0,l.Lk)("div",R,(0,l.v_)(t.userId.email),1)])):((0,l.uX)(),(0,l.CE)("span",P,"System"))]),(0,l.Lk)("td",null,[(0,l.Lk)("span",{class:(0,l.C4)(["badge",ft(t.action)])},(0,l.v_)(t.action),3)]),(0,l.Lk)("td",null,[(0,l.Lk)("span",{class:(0,l.C4)(["method-badge",_t(t.method)])},(0,l.v_)(t.method),3)]),(0,l.Lk)("td",U,(0,l.v_)(t.endpoint),1),(0,l.Lk)("td",null,(0,l.v_)(t.ipAddress),1),(0,l.Lk)("td",null,[(0,l.Lk)("span",{class:(0,l.C4)(["status-badge",At(t.statusCode)])},(0,l.v_)(t.statusCode),3)]),(0,l.Lk)("td",null,(0,l.v_)(t.responseTime)+"ms",1),(0,l.Lk)("td",null,[(0,l.Lk)("button",{class:"btn-icon",title:"Xem chi tiáº¿t",onClick:a=>Ct(t)}," ðŸ‘ï¸ ",8,w)])],2))),128))])]),pt.value.totalPages>1?((0,l.uX)(),(0,l.CE)("div",X,[(0,l.Lk)("button",{disabled:1===pt.value.page,class:"btn-page",onClick:i[6]||(i[6]=t=>Et(pt.value.page-1))}," â† TrÆ°á»›c ",8,O),(0,l.Lk)("span",B," Trang "+(0,l.v_)(pt.value.page)+" / "+(0,l.v_)(pt.value.totalPages)+" ("+(0,l.v_)(pt.value.total)+" báº£n ghi) ",1),(0,l.Lk)("button",{disabled:pt.value.page===pt.value.totalPages,class:"btn-page",onClick:i[7]||(i[7]=t=>Et(pt.value.page+1))}," Sau â†’ ",8,$)])):(0,l.Q3)("",!0)])),n.value?((0,l.uX)(),(0,l.CE)("div",{key:4,class:"modal-overlay",onClick:i[9]||(i[9]=(0,l.D$)(t=>n.value=!1,["self"]))},[(0,l.Lk)("div",x,[(0,l.Lk)("div",K,[i[24]||(i[24]=(0,l.Lk)("h2",null,"ðŸ“„ Chi tiáº¿t Log",-1)),(0,l.Lk)("button",{class:"btn-close",onClick:i[8]||(i[8]=t=>n.value=!1)},"âœ•")]),(0,l.Lk)("div",H,[kt.value?((0,l.uX)(),(0,l.CE)("div",G,[(0,l.Lk)("div",N,[i[25]||(i[25]=(0,l.Lk)("strong",null,"Thá»i gian:",-1)),(0,l.Lk)("span",null,(0,l.v_)(Tt(kt.value.timestamp)),1)]),(0,l.Lk)("div",F,[i[26]||(i[26]=(0,l.Lk)("strong",null,"NgÆ°á»i dÃ¹ng:",-1)),kt.value.userId?((0,l.uX)(),(0,l.CE)("span",j,(0,l.v_)(kt.value.userId.name)+" ("+(0,l.v_)(kt.value.userId.email)+") ",1)):((0,l.uX)(),(0,l.CE)("span",Q,"System"))]),(0,l.Lk)("div",V,[i[27]||(i[27]=(0,l.Lk)("strong",null,"HÃ nh Ä‘á»™ng:",-1)),(0,l.Lk)("span",{class:(0,l.C4)(["badge",ft(kt.value.action)])},(0,l.v_)(kt.value.action),3)]),(0,l.Lk)("div",J,[i[28]||(i[28]=(0,l.Lk)("strong",null,"Method:",-1)),(0,l.Lk)("span",{class:(0,l.C4)(["method-badge",_t(kt.value.method)])},(0,l.v_)(kt.value.method),3)]),(0,l.Lk)("div",M,[i[29]||(i[29]=(0,l.Lk)("strong",null,"Endpoint:",-1)),(0,l.Lk)("code",null,(0,l.v_)(kt.value.endpoint),1)]),(0,l.Lk)("div",q,[i[30]||(i[30]=(0,l.Lk)("strong",null,"Resource:",-1)),(0,l.Lk)("span",null,(0,l.v_)(kt.value.resource),1)]),(0,l.Lk)("div",z,[i[31]||(i[31]=(0,l.Lk)("strong",null,"IP Address:",-1)),(0,l.Lk)("span",null,(0,l.v_)(kt.value.ipAddress),1)]),(0,l.Lk)("div",W,[i[32]||(i[32]=(0,l.Lk)("strong",null,"User Agent:",-1)),(0,l.Lk)("span",Y,(0,l.v_)(kt.value.userAgent||"N/A"),1)]),(0,l.Lk)("div",Z,[i[33]||(i[33]=(0,l.Lk)("strong",null,"Status Code:",-1)),(0,l.Lk)("span",{class:(0,l.C4)(["status-badge",At(kt.value.statusCode)])},(0,l.v_)(kt.value.statusCode),3)]),(0,l.Lk)("div",tt,[i[34]||(i[34]=(0,l.Lk)("strong",null,"Response Time:",-1)),(0,l.Lk)("span",null,(0,l.v_)(kt.value.responseTime)+"ms",1)]),kt.value.details?((0,l.uX)(),(0,l.CE)("div",at,[i[35]||(i[35]=(0,l.Lk)("strong",null,"Chi tiáº¿t:",-1)),(0,l.Lk)("pre",et,(0,l.v_)(JSON.stringify(kt.value.details,null,2)),1)])):(0,l.Q3)("",!0)])):(0,l.Q3)("",!0)])])])):(0,l.Q3)("",!0),o.value?((0,l.uX)(),(0,l.CE)("div",{key:5,class:"modal-overlay",onClick:i[11]||(i[11]=(0,l.D$)(t=>o.value=!1,["self"]))},[(0,l.Lk)("div",lt,[(0,l.Lk)("div",st,[i[36]||(i[36]=(0,l.Lk)("h2",null,"ðŸ“Š Thá»‘ng kÃª Chi tiáº¿t",-1)),(0,l.Lk)("button",{class:"btn-close",onClick:i[10]||(i[10]=t=>o.value=!1)},"âœ•")]),(0,l.Lk)("div",nt,[e.value?((0,l.uX)(),(0,l.CE)("div",ot,[(0,l.Lk)("div",it,[i[38]||(i[38]=(0,l.Lk)("h3",null,"ðŸ‘¥ Top NgÆ°á»i dÃ¹ng Hoáº¡t Ä‘á»™ng",-1)),(0,l.Lk)("table",ut,[i[37]||(i[37]=(0,l.Lk)("thead",null,[(0,l.Lk)("tr",null,[(0,l.Lk)("th",null,"TÃªn"),(0,l.Lk)("th",null,"Email"),(0,l.Lk)("th",null,"Sá»‘ lÆ°á»£t")])],-1)),(0,l.Lk)("tbody",null,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(e.value.topUsers,t=>((0,l.uX)(),(0,l.CE)("tr",{key:t._id},[(0,l.Lk)("td",null,(0,l.v_)(t.name),1),(0,l.Lk)("td",null,(0,l.v_)(t.email),1),(0,l.Lk)("td",null,[(0,l.Lk)("strong",null,(0,l.v_)(t.count),1)])]))),128))])])]),(0,l.Lk)("div",dt,[i[40]||(i[40]=(0,l.Lk)("h3",null,"ðŸŒ Top IP Addresses",-1)),(0,l.Lk)("table",ct,[i[39]||(i[39]=(0,l.Lk)("thead",null,[(0,l.Lk)("tr",null,[(0,l.Lk)("th",null,"IP Address"),(0,l.Lk)("th",null,"Sá»‘ lÆ°á»£t truy cáº­p")])],-1)),(0,l.Lk)("tbody",null,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(e.value.topIPs,t=>((0,l.uX)(),(0,l.CE)("tr",{key:t._id},[(0,l.Lk)("td",null,(0,l.v_)(t._id),1),(0,l.Lk)("td",null,[(0,l.Lk)("strong",null,(0,l.v_)(t.count),1)])]))),128))])])]),(0,l.Lk)("div",rt,[i[42]||(i[42]=(0,l.Lk)("h3",null,"âš¡ Top HÃ nh Ä‘á»™ng",-1)),(0,l.Lk)("table",vt,[i[41]||(i[41]=(0,l.Lk)("thead",null,[(0,l.Lk)("tr",null,[(0,l.Lk)("th",null,"HÃ nh Ä‘á»™ng"),(0,l.Lk)("th",null,"Sá»‘ láº§n thá»±c hiá»‡n")])],-1)),(0,l.Lk)("tbody",null,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(e.value.topActions,t=>((0,l.uX)(),(0,l.CE)("tr",{key:t._id},[(0,l.Lk)("td",null,[(0,l.Lk)("span",{class:(0,l.C4)(["badge",ft(t._id)])},(0,l.v_)(t._id),3)]),(0,l.Lk)("td",null,[(0,l.Lk)("strong",null,(0,l.v_)(t.count),1)])]))),128))])])])])):(0,l.Q3)("",!0)])])])):(0,l.Q3)("",!0)]))}}),Lt=e(6262);const pt=(0,Lt.A)(kt,[["__scopeId","data-v-78bea1b4"]]);var gt=pt},6262:function(t,a){a.A=(t,a)=>{const e=t.__vccOpts||t;for(const[l,s]of a)e[l]=s;return e}}}]);
//# sourceMappingURL=4136.fcf9bcd4.js.map