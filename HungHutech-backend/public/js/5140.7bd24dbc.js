"use strict";(self["webpackChunkHungHutech"]=self["webpackChunkHungHutech"]||[]).push([[5140],{116:function(e,t,a){var n=a(6518),r=a(9565),l=a(2652),s=a(9306),i=a(8551),o=a(1767),c=a(9539),u=a(4549),d=u("find",TypeError);n({target:"Iterator",proto:!0,real:!0,forced:d},{find:function(e){i(this);try{s(e)}catch(n){c(this,"throw",n)}if(d)return r(d,this,e);var t=o(this),a=0;return l(t,function(t,n){if(e(t,a++))return n(t)},{IS_RECORD:!0,INTERRUPTED:!0}).result}})},1526:function(e,t,a){var n=a(1114),r=a(4335);const l=window?.appGlobal?.baseUrl&&`${window.appGlobal.baseUrl}/api`,s=l||"http://192.168.88.50:5000/api";console.log("API Base URL:",s);class i{constructor(){(0,n.A)(this,"axiosInstance",void 0),this.axiosInstance=r.A.create({baseURL:s,headers:{"Content-Type":"application/json"}}),this.axiosInstance.interceptors.request.use(e=>{const t=localStorage.getItem("token");return t&&(e.headers.Authorization=`Bearer ${t}`),e},e=>Promise.reject(e)),this.axiosInstance.interceptors.response.use(e=>e,e=>(401===e.response?.status&&(localStorage.removeItem("token"),localStorage.removeItem("user"),window.location.href="/login"),Promise.reject(e)))}get(e,t){return this.axiosInstance.get(e,t)}post(e,t,a){return this.axiosInstance.post(e,t,a)}put(e,t,a){return this.axiosInstance.put(e,t,a)}delete(e,t){return this.axiosInstance.delete(e,t)}patch(e,t,a){return this.axiosInstance.patch(e,t,a)}}t.A=new i},1637:function(e,t,a){var n=a(1114),r=a(1526);class l{constructor(){(0,n.A)(this,"BASE_URL","/consents")}async getMyConsents(){const e=await r.A.get(`${this.BASE_URL}/my`);return{items:e.data.data||[],pendingRequired:Boolean(e.data.pending_required)}}async getPurposes(){const e=await r.A.get(`${this.BASE_URL}/purposes`);return e.data.data||[]}async saveConsents(e){const t=await r.A.post(this.BASE_URL,{consents:e});return{items:t.data.data||[],pendingRequired:Boolean(t.data.pending_required)}}async getOverview(){const e=await r.A.get(`${this.BASE_URL}/overview`);return e.data.data||[]}async getTracking(e){const t=await r.A.get(`${this.BASE_URL}/tracking`,{params:e});return t.data}}t.A=new l},5140:function(e,t,a){a.r(t),a.d(t,{default:function(){return m}});a(8111),a(116),a(8237);var n=a(1431),r=a(163),l=a(8548),s=a(1637),i=a(5916);const o={class:"consent-hub-page"},c={class:"page-header"},u={class:"card-header"},d={class:"overview-card__title"},h={class:"overview-card__stats"},p={class:"card-header"},g={class:"card-filters"},v={class:"employee-cell"},k={class:"table-pagination"};var _=(0,n.pM)({__name:"ConsentHub",setup(e){const t=(0,n.KR)([]),a=(0,n.KR)([]),_=(0,n.KR)([]),w=(0,n.KR)(!1),f=(0,n.Kh)({phong_ban_id:"",q:""}),m=(0,n.Kh)({page:1,limit:10,total:0}),y=(0,n.EW)(()=>t.value.length?t.value.reduce((e,t)=>e+t.accepted+t.pending+t.withdrawn,0)/t.value.length:0),b=e=>{switch(e){case"Accepted":return"Đồng ý";case"Withdrawn":return"Đã rút";case"Pending":default:return"Chưa phản hồi"}},L=e=>{switch(e){case"Accepted":return"success";case"Withdrawn":return"danger";default:return"info"}},A=e=>`${e.ho_dem||""} ${e.ten||""}`.trim(),R=(e,t)=>{const a=e.purposes.find(e=>e.key===t);return a?.status||"Pending"},E=async()=>{try{t.value=await s.A.getOverview()}catch(e){console.error("loadOverview error",e),r.nk.error(e.response?.data?.msg||"Không thể tải tổng quan consent")}},I=async()=>{try{const e=await i.A.getAll({limit:200});_.value=e.data||[]}catch{_.value=[]}},C=async()=>{w.value=!0;try{const e=await s.A.getTracking({page:m.page,limit:m.limit,phong_ban_id:f.phong_ban_id||void 0,q:f.q||void 0});a.value=e.data||[],m.total=e.pagination.total}catch(e){console.error("loadTracking error",e),r.nk.error(e.response?.data?.msg||"Không thể tải danh sách consent")}finally{w.value=!1}},U=()=>{m.page=1,C()},B=e=>{m.page=e,C()},S=()=>{E(),C()};return(0,n.sV)(()=>{I(),S()}),(e,r)=>{const s=(0,n.g2)("el-button"),i=(0,n.g2)("el-tag"),E=(0,n.g2)("el-card"),I=(0,n.g2)("el-col"),C=(0,n.g2)("el-row"),F=(0,n.g2)("el-option"),x=(0,n.g2)("el-select"),$=(0,n.g2)("el-input"),q=(0,n.g2)("el-table-column"),W=(0,n.g2)("el-table"),T=(0,n.g2)("el-pagination"),K=(0,n.gN)("loading");return(0,n.uX)(),(0,n.CE)("div",o,[(0,n.Lk)("div",c,[r[3]||(r[3]=(0,n.Lk)("div",null,[(0,n.Lk)("h2",null,"Consent Hub"),(0,n.Lk)("p",null,"Theo dõi tình trạng đồng ý dữ liệu cá nhân theo Nghị định 13.")],-1)),(0,n.bF)(s,{icon:(0,n.R1)(l.Refresh),onClick:S},{default:(0,n.k6)(()=>[...r[2]||(r[2]=[(0,n.eW)("Làm mới",-1)])]),_:1},8,["icon"])]),(0,n.bF)(E,{shadow:"never"},{header:(0,n.k6)(()=>[(0,n.Lk)("div",u,[r[4]||(r[4]=(0,n.Lk)("h3",null,"Tổng quan",-1)),(0,n.Lk)("small",null,(0,n.v_)(y.value)+" nhân viên đã cập nhật consent",1)])]),default:(0,n.k6)(()=>[(0,n.bF)(C,{gutter:16},{default:(0,n.k6)(()=>[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(t.value,e=>((0,n.uX)(),(0,n.Wv)(I,{key:e.key,xs:24,sm:12,md:8},{default:(0,n.k6)(()=>[(0,n.bF)(E,{class:"overview-card","body-style":{padding:"16px"}},{default:(0,n.k6)(()=>[(0,n.Lk)("div",d,[(0,n.Lk)("strong",null,(0,n.v_)(e.name),1),e.required?((0,n.uX)(),(0,n.Wv)(i,{key:0,size:"small",type:"danger"},{default:(0,n.k6)(()=>[...r[5]||(r[5]=[(0,n.eW)(" Bắt buộc ",-1)])]),_:1})):(0,n.Q3)("",!0)]),(0,n.Lk)("div",h,[(0,n.Lk)("div",null,[r[6]||(r[6]=(0,n.Lk)("span",null,"Đồng ý",-1)),(0,n.Lk)("strong",null,(0,n.v_)(e.accepted),1)]),(0,n.Lk)("div",null,[r[7]||(r[7]=(0,n.Lk)("span",null,"Từ chối",-1)),(0,n.Lk)("strong",null,(0,n.v_)(e.withdrawn),1)]),(0,n.Lk)("div",null,[r[8]||(r[8]=(0,n.Lk)("span",null,"Chưa phản hồi",-1)),(0,n.Lk)("strong",null,(0,n.v_)(e.pending),1)])])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),(0,n.bF)(E,{shadow:"never"},{header:(0,n.k6)(()=>[(0,n.Lk)("div",p,[r[10]||(r[10]=(0,n.Lk)("h3",null,"Danh sách nhân viên & trạng thái đồng ý",-1)),(0,n.Lk)("div",g,[(0,n.bF)(x,{modelValue:f.phong_ban_id,"onUpdate:modelValue":r[0]||(r[0]=e=>f.phong_ban_id=e),placeholder:"Phòng ban",clearable:"",size:"small"},{default:(0,n.k6)(()=>[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(_.value,e=>((0,n.uX)(),(0,n.Wv)(F,{key:e._id,label:e.ten,value:e._id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),(0,n.bF)($,{modelValue:f.q,"onUpdate:modelValue":r[1]||(r[1]=e=>f.q=e),placeholder:"Tìm theo mã hoặc tên",size:"small",clearable:""},null,8,["modelValue"]),(0,n.bF)(s,{size:"small",icon:(0,n.R1)(l.Search),onClick:U},{default:(0,n.k6)(()=>[...r[9]||(r[9]=[(0,n.eW)(" Lọc ",-1)])]),_:1},8,["icon"])])])]),default:(0,n.k6)(()=>[(0,n.bo)(((0,n.uX)(),(0,n.Wv)(W,{data:a.value,"empty-text":w.value?"Đang tải...":"Chưa có dữ liệu"},{default:(0,n.k6)(()=>[(0,n.bF)(q,{label:"Nhân viên","min-width":"200"},{default:(0,n.k6)(({row:e})=>[(0,n.Lk)("div",v,[(0,n.Lk)("strong",null,(0,n.v_)(A(e.nhan_vien)),1),(0,n.Lk)("span",null,(0,n.v_)(e.nhan_vien.ma_nhan_vien),1)])]),_:1}),(0,n.bF)(q,{label:"Phòng ban","min-width":"160"},{default:(0,n.k6)(({row:e})=>[(0,n.eW)((0,n.v_)(e.phong_ban?.ten||"--"),1)]),_:1}),((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(t.value,e=>((0,n.uX)(),(0,n.Wv)(q,{key:e.key,label:e.name,"min-width":"160"},{default:(0,n.k6)(({row:t})=>[(0,n.bF)(i,{size:"small",type:L(R(t,e.key))},{default:(0,n.k6)(()=>[(0,n.eW)((0,n.v_)(b(R(t,e.key))),1)]),_:2},1032,["type"])]),_:2},1032,["label"]))),128))]),_:1},8,["data","empty-text"])),[[K,w.value]]),(0,n.Lk)("div",k,[(0,n.bF)(T,{background:"",layout:"total, prev, pager, next",total:m.total,"current-page":m.page,"page-size":m.limit,onCurrentChange:B},null,8,["total","current-page","page-size"])])]),_:1})])}}}),w=a(6262);const f=(0,w.A)(_,[["__scopeId","data-v-47ed809c"]]);var m=f},5916:function(e,t,a){var n=a(1114),r=a(1526);class l{constructor(){(0,n.A)(this,"BASE_URL","/phongban")}async getAll(e){const t=await r.A.get(this.BASE_URL,{params:e});return t.data}async getById(e){const t=await r.A.get(`${this.BASE_URL}/${e}`);return t.data}async create(e){const t=await r.A.post(this.BASE_URL,e);return t.data}async update(e,t){const a=await r.A.put(`${this.BASE_URL}/${e}`,t);return a.data}async delete(e){await r.A.delete(`${this.BASE_URL}/${e}`)}}t.A=new l},8237:function(e,t,a){var n=a(6518),r=a(2652),l=a(9306),s=a(8551),i=a(1767),o=a(9539),c=a(4549),u=a(8745),d=a(9039),h=TypeError,p=d(function(){[].keys().reduce(function(){},void 0)}),g=!p&&c("reduce",h);n({target:"Iterator",proto:!0,real:!0,forced:p||g},{reduce:function(e){s(this);try{l(e)}catch(d){o(this,"throw",d)}var t=arguments.length<2,a=t?void 0:arguments[1];if(g)return u(g,this,t?[e]:[e,a]);var n=i(this),c=0;if(r(n,function(n){t?(t=!1,a=n):a=e(a,n,c),c++},{IS_RECORD:!0}),t)throw new h("Reduce of empty iterator with no initial value");return a}})},8745:function(e,t,a){var n=a(616),r=Function.prototype,l=r.apply,s=r.call;e.exports="object"==typeof Reflect&&Reflect.apply||(n?s.bind(l):function(){return s.apply(l,arguments)})}}]);
//# sourceMappingURL=5140.7bd24dbc.js.map