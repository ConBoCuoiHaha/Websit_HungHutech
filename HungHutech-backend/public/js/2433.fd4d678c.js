"use strict";(self["webpackChunkHungHutech"]=self["webpackChunkHungHutech"]||[]).push([[2433],{1114:function(e,t,a){function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function l(e,t){if("object"!=n(e)||!e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var l=a.call(e,t||"default");if("object"!=n(l))return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function o(e){var t=l(e,"string");return"symbol"==n(t)?t:t+""}function i(e,t,a){return(t=o(t))in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}a.d(t,{A:function(){return i}})},1526:function(e,t,a){var n=a(1114),l=a(4335);const o=window?.appGlobal?.baseUrl&&`${window.appGlobal.baseUrl}/api`,i=o||"http://192.168.88.50:5000/api";console.log("API Base URL:",i);class r{constructor(){(0,n.A)(this,"axiosInstance",void 0),this.axiosInstance=l.A.create({baseURL:i,headers:{"Content-Type":"application/json"}}),this.axiosInstance.interceptors.request.use(e=>{const t=localStorage.getItem("token");return t&&(e.headers.Authorization=`Bearer ${t}`),e},e=>Promise.reject(e)),this.axiosInstance.interceptors.response.use(e=>e,e=>(401===e.response?.status&&(localStorage.removeItem("token"),localStorage.removeItem("user"),window.location.href="/login"),Promise.reject(e)))}get(e,t){return this.axiosInstance.get(e,t)}post(e,t,a){return this.axiosInstance.post(e,t,a)}put(e,t,a){return this.axiosInstance.put(e,t,a)}delete(e,t){return this.axiosInstance.delete(e,t)}patch(e,t,a){return this.axiosInstance.patch(e,t,a)}}t.A=new r},2433:function(e,t,a){a.r(t),a.d(t,{default:function(){return y}});var n=a(1431),l=a(163),o=a(7918),i=a(8548),r=a(8487);const u={class:"page-container"},s={class:"page-header"},c={class:"employee-cell"},d={class:"employee-id"},p={key:2,class:"action-placeholder"},h={class:"pagination"};var g=(0,n.pM)({__name:"ProfileRequestApproval",setup(e){const t=(0,n.KR)([]),a=(0,n.KR)(!1),g=(0,n.KR)(null),b=(0,n.Kh)({page:1,limit:10,total:0}),m=(0,n.Kh)({status:"Pending",type:"",keyword:""}),y=async(e=!1)=>{if(!a.value){e&&(b.page=1),a.value=!0;try{const e={page:b.page,limit:b.limit};m.status&&(e.status=m.status),m.type&&(e.type=m.type),m.keyword&&(e.q=m.keyword);const a=await r.A.list(e);t.value=a.items,b.total=a.total}catch(n){console.error("Error loading profile requests:",n),l.nk.error(n.response?.data?.msg||"Không thể tải yêu cầu")}finally{a.value=!1}}},v=e=>{switch(e){case"personal":return"Thong tin ca nhan";case"contact":return"Liên hệ & địa chỉ";case"dependents":return"Người phụ thuộc";default:return e}},f=e=>"Pending"===e?"Chờ duyệt":"Approved"===e?"Đã duyệt":"Rejected"===e?"Từ chối":e,k=e=>"Approved"===e?"success":"Rejected"===e?"danger":"warning",_=e=>e?new Date(e).toLocaleString("vi-VN"):"---",w=e=>{const t=e.nhan_vien_id;return t&&"object"===typeof t&&`${t.ho_dem||""} ${t.ten||""}`.trim()||"---"},F=e=>{const t=e.nhan_vien_id;return t&&"object"===typeof t&&t.ma_nhan_vien||""},A=e=>{b.limit=e,b.page=1,y()},L=e=>{b.page=e,y()},S=()=>{b.page=1,y()},T=async(e,t)=>{try{const a="Approved"===t?"Phe duyet":"Tu choi",{value:n}=await o.s.prompt("Nhap ghi chu gui nhan vien (tuy chon)",a,{confirmButtonText:a,cancelButtonText:"Huy",inputPlaceholder:"Ghi chu",inputValue:""});g.value=e._id,await r.A.updateStatus(e._id,{status:t,approver_note:n}),l.nk.success("Approved"===t?"Da phe duyet yeu cau":"Da tu choi yeu cau"),y()}catch(a){if("cancel"===a)return;console.error("Error updating request status:",a),l.nk.error(a.response?.data?.msg||"Không thể cập nhật trạng thái")}finally{g.value=null}};return(0,n.sV)(()=>{y()}),(e,l)=>{const o=(0,n.g2)("el-button"),r=(0,n.g2)("el-option"),C=(0,n.g2)("el-select"),R=(0,n.g2)("el-form-item"),x=(0,n.g2)("el-col"),P=(0,n.g2)("el-input"),I=(0,n.g2)("el-row"),j=(0,n.g2)("el-form"),U=(0,n.g2)("el-card"),V=(0,n.g2)("el-table-column"),E=(0,n.g2)("el-tag"),z=(0,n.g2)("el-space"),B=(0,n.g2)("el-table"),W=(0,n.g2)("el-pagination"),K=(0,n.gN)("loading");return(0,n.uX)(),(0,n.CE)("div",u,[(0,n.Lk)("div",s,[l[6]||(l[6]=(0,n.Lk)("div",null,[(0,n.Lk)("h2",null,"Yêu cầu cập nhật hồ sơ"),(0,n.Lk)("p",null,"Theo dõi và phê duyệt các yêu cầu thay đổi thông tin nhân viên")],-1)),(0,n.bF)(o,{type:"primary",icon:(0,n.R1)(i.Refresh),loading:a.value,onClick:l[0]||(l[0]=e=>y(!0))},{default:(0,n.k6)(()=>[...l[5]||(l[5]=[(0,n.eW)(" Làm mới ",-1)])]),_:1},8,["icon","loading"])]),(0,n.bF)(U,{class:"filter-card",shadow:"never"},{default:(0,n.k6)(()=>[(0,n.bF)(j,{model:m,"label-position":"top",onSubmit:l[4]||(l[4]=(0,n.D$)(()=>{},["prevent"]))},{default:(0,n.k6)(()=>[(0,n.bF)(I,{gutter:16},{default:(0,n.k6)(()=>[(0,n.bF)(x,{xs:24,sm:12,md:8},{default:(0,n.k6)(()=>[(0,n.bF)(R,{label:"Trạng thái"},{default:(0,n.k6)(()=>[(0,n.bF)(C,{modelValue:m.status,"onUpdate:modelValue":l[1]||(l[1]=e=>m.status=e),placeholder:"Tất cả",onChange:S},{default:(0,n.k6)(()=>[(0,n.bF)(r,{label:"Tất cả",value:""}),(0,n.bF)(r,{label:"Chờ duyệt",value:"Pending"}),(0,n.bF)(r,{label:"Đã duyệt",value:"Approved"}),(0,n.bF)(r,{label:"Từ chối",value:"Rejected"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),(0,n.bF)(x,{xs:24,sm:12,md:8},{default:(0,n.k6)(()=>[(0,n.bF)(R,{label:"Loại yêu cầu"},{default:(0,n.k6)(()=>[(0,n.bF)(C,{modelValue:m.type,"onUpdate:modelValue":l[2]||(l[2]=e=>m.type=e),placeholder:"Tất cả",onChange:S},{default:(0,n.k6)(()=>[(0,n.bF)(r,{label:"Tất cả",value:""}),(0,n.bF)(r,{label:"Thông tin cá nhân",value:"personal"}),(0,n.bF)(r,{label:"Liên hệ & địa chỉ",value:"contact"}),(0,n.bF)(r,{label:"Người phụ thuộc",value:"dependents"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),(0,n.bF)(x,{xs:24,sm:24,md:8},{default:(0,n.k6)(()=>[(0,n.bF)(R,{label:"Từ khóa"},{default:(0,n.k6)(()=>[(0,n.bF)(P,{modelValue:m.keyword,"onUpdate:modelValue":l[3]||(l[3]=e=>m.keyword=e),placeholder:"Tìm theo ghi chú",clearable:"",onKeyup:(0,n.jR)(S,["enter"]),onClear:S},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),(0,n.bF)(U,{shadow:"never"},{default:(0,n.k6)(()=>[(0,n.bo)(((0,n.uX)(),(0,n.Wv)(B,{data:t.value,border:"",style:{width:"100%"},"empty-text":"Chưa có yêu cầu"},{default:(0,n.k6)(()=>[(0,n.bF)(V,{label:"Nhân viên","min-width":"220"},{default:(0,n.k6)(({row:e})=>[(0,n.Lk)("div",c,[(0,n.Lk)("strong",null,(0,n.v_)(w(e)),1),(0,n.Lk)("span",d,(0,n.v_)(F(e)),1)])]),_:1}),(0,n.bF)(V,{label:"Loại yêu cầu","min-width":"180"},{default:(0,n.k6)(({row:e})=>[(0,n.eW)((0,n.v_)(v(e.type)),1)]),_:1}),(0,n.bF)(V,{label:"Ngày gửi","min-width":"180"},{default:(0,n.k6)(({row:e})=>[(0,n.eW)((0,n.v_)(_(e.ngay_tao)),1)]),_:1}),(0,n.bF)(V,{label:"Trạng thái",width:"140",align:"center"},{default:(0,n.k6)(({row:e})=>[(0,n.bF)(E,{type:k(e.status),size:"small"},{default:(0,n.k6)(()=>[(0,n.eW)((0,n.v_)(f(e.status)),1)]),_:2},1032,["type"])]),_:1}),(0,n.bF)(V,{prop:"note",label:"Ghi chú","min-width":"200","show-overflow-tooltip":""}),(0,n.bF)(V,{prop:"approver_note",label:"Phản hồi từ HR","min-width":"200","show-overflow-tooltip":""}),(0,n.bF)(V,{label:"Thao tác",width:"220",align:"center"},{default:(0,n.k6)(({row:e})=>[(0,n.bF)(z,null,{default:(0,n.k6)(()=>["Pending"===e.status?((0,n.uX)(),(0,n.Wv)(o,{key:0,type:"success",size:"small",loading:g.value===e._id,onClick:t=>T(e,"Approved")},{default:(0,n.k6)(()=>[...l[7]||(l[7]=[(0,n.eW)(" Phê duyệt ",-1)])]),_:1},8,["loading","onClick"])):(0,n.Q3)("",!0),"Pending"===e.status?((0,n.uX)(),(0,n.Wv)(o,{key:1,type:"danger",size:"small",loading:g.value===e._id,onClick:t=>T(e,"Rejected")},{default:(0,n.k6)(()=>[...l[8]||(l[8]=[(0,n.eW)(" Từ chối ",-1)])]),_:1},8,["loading","onClick"])):((0,n.uX)(),(0,n.CE)("span",p,"Đã xử lý"))]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[K,a.value]]),(0,n.Lk)("div",h,[(0,n.bF)(W,{background:"",layout:"total, prev, pager, next, sizes","page-size":b.limit,"current-page":b.page,total:b.total,"page-sizes":[10,20,50],onSizeChange:A,onCurrentChange:L},null,8,["page-size","current-page","total"])])]),_:1})])}}}),b=a(6262);const m=(0,b.A)(g,[["__scopeId","data-v-1c96eeea"]]);var y=m},6262:function(e,t){t.A=(e,t)=>{const a=e.__vccOpts||e;for(const[n,l]of t)a[n]=l;return a}},8487:function(e,t,a){var n=a(1114),l=a(1526);class o{constructor(){(0,n.A)(this,"BASE_URL","/profile-requests")}async create(e){const t=await l.A.post(this.BASE_URL,e);return t.data}async getMy(){const e=await l.A.get(`${this.BASE_URL}/my`);return e.data?.data||[]}async list(e){const t=await l.A.get(this.BASE_URL,{params:e}),a=t.data.pagination||{total:0,page:1,limit:e?.limit||20};return{items:t.data.data||[],total:a.total||0,page:a.page||1,limit:a.limit||e?.limit||20}}async updateStatus(e,t){const a=await l.A.patch(`${this.BASE_URL}/${e}/status`,t);return a.data}}t.A=new o}}]);
//# sourceMappingURL=2433.fd4d678c.js.map